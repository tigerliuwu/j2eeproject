// Copyright (c) Microsoft Corporation. All rights reserved.

var L_Loading_Text="Loading...";

var L_Error_Text="Unable to retrieve data, please try again.";

var L_RemoveModule_Text="Remove module";

var L_NotAvailableShort_Text="N/A";

var L_FirefoxSupportComing_Text="<B>Firefox Users</B><BR>Firefox support is coming soon. Please be patient :-)";

var L_AddButton_Text="add";

var L_AddContentHeading_Text="Add Content";

var L_SettingsLabel_Text="settings";

var L_PreferencesLabel_Text="preferences";

var L_Plus_Text="+";

var L_Minus_Text="-";

var L_PlusTooltip_Text="display more headlines";

var L_MinusTooltip_Text="display fewer headlines";

var L_SearchLabel_Text="Search";

var L_HelpLabel_Text="help";

var L_GetStartedLabel_Text="get started";

var L_HowToPersonalizeLabel_Text="how to personalize start";

var L_GetStartedIntro_Text="You can customize your start page through feeds, gadgets and more.";

var L_GetStartedBulletIntro_Text="Add content to start through:";

var L_GetStartedBulletPoint01_Text="Search: subscribe to feeds from the 'feeds' tab in search results";

var L_GetStartedBulletPoint02_Text="Adding a feed URL on the 'add content' module";

var L_GetStartedBulletPoint03_Text="Importing OPML on the 'add content' module";

var L_GetStartedBulletPoint04_Text="Drag and drop from sidebar to start page";

var L_GetStartedWrapUp_Text="Further customize your start page through drag and drop, theme and column settings and by adding gadgets such as weather and stocks.";

var L_AddAdvanced_Text="Advanced";

var L_AddBySearch_Text="Search for feeds: ";

var L_AddSearchButton_Text="Search";

var L_AddByUrl_Text="Add feed or gadget by URL (find out more about how to build your own Gadgets at <a href='http://www.start.com/developer'>start.com/developer</a>)";

var L_AddSubscribeButton_Text="Subscribe";

var L_AddImportOpml_Text="Import OPML file: ";

var L_AddImportButton_Text="Import";

var L_ExportFeedByOPMLHdr_Text="Export feeds to OPML";

var L_ExportFeedByOPMLStr1_Text="Click ";

var L_ExportFeedByOPMLStr2_Text="here";

var L_ExportFeedByOPMLStr3_Text=" to export your feed subscriptions to OPML.";

var L_ExportFeedByOPMLTitle_Text="OPML Export";

var L_ImportFavoritesHdr_Text="Import IE Favorites";

var L_ImportFavorites_Text="Click here to import your IE Favorites.";

var L_AddFeedByOPMLHdr_Text="Import feeds using OPML";

var L_AddFeedByOPML_Text="Import your feed subscriptions from an OPML file by entering the path to the file below.";

var L_AddFeedsByDragging_Text="Add feeds from start menu by dragging and dropping onto your page.";

var L_AddSearchPopup_Text="Search: ";

var L_AddFeedVerifyText_Text="Verifying feed...";

var L_AddDiscoverTagText_Text="Checking for autodiscover tag...";

var L_UnableToDownloadDef_Text="Unable to download definition file: ";

var L_ErrorLoadingDef_Text="Error loading definition file: ";

var L_InvalidDef_Text="Invalid definition download: ";

var L_FolderRemove_Text="Remove \"";

var L_FolderItem_Text="\" item";

var L_FolderDeleteConfirm_Text="This will delete the entire folder and all of its contents. Are you sure you want to do this?";

var L_CreateButton_Text="Create";

var L_CancelButton_Text="cancel";

var L_CreateFolder_Text="[create folder]";

var L_AddToPage_Text="add to my page";

var L_AddToPageTip_Text="add this module to your page";

var L_AddModuleHdrDup_Text="this module is already on your page";

var L_CloseWindow_Text="Close window";

var L_NoRecentSearches_Text="(no recent searches)";

var L_MoreLink_Text="more";

var L_OpenNewBrowser_Text="Open article in new browser";

var L_Expand_Text="expand";

var L_Collapse_Text="collapse";

var L_Previous_Text="Previous";

var L_Next_Text="Next";

var L_NoResults_Text="Your search did not produce any results.";

var L_InlineAnswer_Text="Answer:";

var L_EncartaAnswers_Text="Encarta Answers";

var L_ResultsNofMFirst_Text="Results";

var L_ResultsNOfMMiddle_Text="of";

var L_ResultsNOfMEnd_Text=".";

var L_ResultsFirst_Text="Results";

var L_ResultsEnd_Text=".";

var L_WebResults_Text="Web";

var L_NewsResults_Text="News";

var L_RssResults_Text="Feeds";

var L_SubscribeFeedText_Text="Subscribe to this RSS feed";

var L_SubscribeFeed_Text="Subscribe";

var L_FeedbackLink_Text="feedback";

var L_BlogLink_Text="start.com blog";

var L_Disclaimer1_Text="this site is not an officially supported site. it is an incubation experiment and doesn't represent any particular strategy or policy. for other incubation experiments, see ";

var L_Disclaimer2_Text="enjoy!";

var L_MicrosoftFooter_Text="&#xA9;2005 Microsoft";

var L_PrivacyFooter_Text="privacy";

var L_PreviewFooter_Text="why preview?";

var L_PreviewText_Text="preview";

var L_AddContentText_Text="add feeds and gadgets";

var L_ClickToAddContentText_Text="(click above to add content)";

var L_MyFeedsGroup_Text="My Web";

var L_RecentSearchesGroup_Text="My Recent Searches";

var L_PopularFeedsGroup_Text="Top Feeds";

var L_StaffPicks_Text="Staff Picks";

var L_Startlets_Text="Gadgets";

var L_CategoriesGroup_Text="Categories";

var L_MyFavoritesGroup_Text="My Favorite Sites";

var L_CloseSidebar_Text="close";

var L_PinSidebar_Text="pin";

var L_SignOutText_Text="sign out";

var L_SignInText_Text="sign in";

var L_AgoText_Text="ago";

var L_DaySingular_Text="day";

var L_DayPlural_Text="days";

var L_HourSingular_Text="hour";

var L_HourPlural_Text="hours";

var L_About_Text="About";

var L_QuestionMark_Text="?";

var L_MissingAboutInfo_Text="No information is available.";

var L_ChangeThemeText_Text="Switch theme";

var L_ColumnsText_Text="columns: ";

var L_RemoveColumn_Text="Remove a column";

var L_AddColumn_Text="Add a column";

var L_HideShowDash_Text="Hide/Show dashboard modules";

var L_HideText_Text="hide";

var L_ShowText_Text="show";

var L_Language_Text="language";

var L_SelectLanguage_Text="Select a different language";

var L_AddPage_Text="[Add New Page]";

var L_AddPageByNameHdr_Text="Add a New Page";

var L_AddPageByName_Text="Add a new page by entering the name of the page below. You can add modules to the newly-created page by &lt;insert instructions here&gt;.";

var L_AddBtn_Text="Add";

var L_DeletePage_Text="Delete this page";

var L_AddPageByOpmlHdr_Text="Add Page by OPML";

var L_AddPageByOpml_Text="Create a page from an OPML subscription by entering the URL or the path to the file below. Creating a page from OPML will automatically add a page with all your subscription modules on the page.";

var L_ImportOpmlBtn_Text="Add";

var L_SidebarShowBtn_Text="show";

var L_SidebarHideBtn_Text="hide";

var L_MyPagesGroup_Text="My Pages";

var L_EmptyFolder_Text="This folder is empty.";

var L_DeletePageConfirm_Text="This will delete this page along with all the modules on it. Are you sure you want to do this?";

var L_AddFeedByUrlHdr_Text="Add feed by URL";

var L_AddFeedByUrl_Text="Add a specific RSS or ATOM feed by entering the URL below. If you don't know the URL of the feed, try using the URL of the web page.";

var L_AddFeedBySearchHdr_Text="Search";

var L_AddCustomModuleByUrlHdr_Text="Add a Gadget";

var L_AddCustomModuleByUrl_Text="Enter the URL of the Gadget you want to add. This URL should point to an XML file (e.g. http://localhost/startlets/hello/hello.xml).";

var L_WeatherTitle_Text="Weather Forecasts";

var L_BlogMapTitle_Text="MSN Bloggers Map";

var L_HelloTitle_Text="Hello, World";

var L_LanguageTitle_Text="Language Preference";

var L_MyHelloTitle_Text="Derived Hello, World";

var L_RssListTitle_Text="RSS Summary - Most Recent Articles";

var L_RumorCityTitle_Text="Rumor City";

var L_FolksonomyTitle_Text="Favorites";

var L_ClockTitle_Text="Ticking Clock";

var L_PreviewTitle_Text="start.com Preview";

var L_SampleRssTitle_Text="Rumor City";

var L_StockTitle_Text="Stock Quotes";

var L_HoroscopeTitle_Text="Astrocenter Horoscopes";

var L_BusinessTitle_Text="Business";

var L_EntertainmentTitle_Text="Entertainment";

var L_HealthTitle_Text="Health";

var L_NewsTitle_Text="News";

var L_ScienceTechTitle_Text="Science & Tech";

var L_SportsTitle_Text="Sports";

var L_BlogMapProvider_Text="Powered by <A HREF=\"http://virtualearth.msn.com\" target=\"_blank\">MSN Virtual Earth</A>";

var L_HoroscopeDates01_Text="March 21 - April 19";

var L_HoroscopeDates02_Text="April 20 - May 20";

var L_HoroscopeDates03_Text="May 21 - June 21";

var L_HoroscopeDates04_Text="June 22 - July 22";

var L_HoroscopeDates05_Text="July 23 - August 22";

var L_HoroscopeDates06_Text="August 23 - September 22";

var L_HoroscopeDates07_Text="September 23 - October 23";

var L_HoroscopeDates08_Text="October 24 - November 21";

var L_HoroscopeDates09_Text="November 22 - December 21";

var L_HoroscopeDates10_Text="December 22 - January 19";

var L_HoroscopeDates11_Text="January 20 - February 18";

var L_HoroscopeDates12_Text="February 19 - March 20";

var L_HoroscopeIDs01_Text="Aries";

var L_HoroscopeIDs02_Text="Taurus";

var L_HoroscopeIDs03_Text="Gemini";

var L_HoroscopeIDs04_Text="Cancer";

var L_HoroscopeIDs05_Text="Leo";

var L_HoroscopeIDs06_Text="Virgo";

var L_HoroscopeIDs07_Text="Libra";

var L_HoroscopeIDs08_Text="Scorpio";

var L_HoroscopeIDs09_Text="Sagittarius";

var L_HoroscopeIDs10_Text="Capricorn";

var L_HoroscopeIDs11_Text="Aquarius";

var L_HoroscopeIDs12_Text="Pisces";

var L_HoroscopeProvider_Text="<br>Astrology & Horoscopes provided by <a href='http://www.astrocenter.com/' target='new'>Astrocenter</a>.";

var L_WeatherPrompt_Text="enter a city name";

var L_WeatherDegreesBefore_Text="";

var L_WeatherDegreesAfter_Text="&deg;";

var L_WeatherDegreesCelsius_Text="&deg;C";

var L_WeatherDegreesFarenheit_Text="&deg;F";

var L_WeatherNotFound_Text="City not found. Please check the city name and try again.";

var L_WeatherInstructions_Text="Add city forecasts to your list by entering a city name above and clicking add.";

var L_WeatherRemove_Text="Remove city";

var L_WeatherProviderBefore_Text="Powered by: ";

var L_WeatherProviderAfter_Text="";

var L_WeatherSeparator_Text="/";

var L_RumorCityNoRumors_Text="No Current Rumors.... Why not start one?";

var L_RumorCityPrompt_Text="Start a Rumor...";

var L_Preview01_Text="Start.com/myw3b is currently a preview release. This means that you may experience some glitches from time to time or features that may not be fully polished or complete. But we're hoping you're willing to bear a few glitches and partial features in exchange for seeing your thoughts and ideas implemented in this space as fast as we can. These ideas come directly from your feedback, so keep it coming! It's been awesome so far, and we're definitely listening. Stay tuned to see what's coming :)<br><br>";

var L_Preview02_Text="Here are some of the things we're currently working on:";

var L_Preview03_Text="<ul style='margin-left:20px'>";

var L_Preview04_Text="<li>Firefox support<br>rest assured we haven't abandoned our firefox users and are working on the issues continuously</li>";

var L_Preview05_Text="<li>OPML import/export<br>yes, we have this in our previous versions and we'll be adding it to myw3b soon... we've just got a few loose ends to tie up with the user experience</li>";

var L_Preview06_Text="<li>better default experience</li>";

var L_Preview07_Text="<li>drag/drop management of the sidebar and folder creation</li>";

var L_Preview08_Text="<li>import your favorites/bookmarks</li>";

var L_Preview09_Text="<li>roaming</li>";

var L_Preview10_Text="<li>UI fit and finish</li>";

var L_Preview11_Text="</ul>";

var L_Preview12_Text="<br><br>Thanks!<br>";

var L_Preview13_Text=" - the Start.com team<br>";

var L_MyHelloMessage_Text=" MSN is Great!";

var L_DemoMessage_Text="Hello, World!!";

var L_LanguagePrompt_Text="Select your language preference:";

var L_FolksonomyInfoStrUrl_Text="URL";

var L_FolksonomyInfoStrUrlTitle_Text="example: http://www.start.com";

var L_FolksonomyInfoStrTags_Text="tags (comma separated)";

var L_FolksonomyInfoStrTitle_Text="optional title";

var L_FolksonomyInfoStrTagIt_Text="Add";

var L_FolksonomyInfoStrCancelAdd_Text="Cancel";

var L_FolksonomyInfoStrSearch_Text="filter";

var L_FolksonomyInfoStrSearchTitle_Text="enter tags (comma separated";

var L_FolksonomyInfoStrMyLabels_Text="my labels";

var L_FolksonomyMyWebTag_Text="default";

var L_FolksonomyAddUrlLink_Text="Add url";

var L_FolksonomyImportLink_Text="Import";

var L_FolksonomyDeleteUrlLink_Text="Delete Selected";

var L_FolksonomyImportFavorites_Text="Import Favorites (Bookmarks)";

var L_FolksonomyImportFavoritesShort_Text="Import Favorites";

var L_FolksonomyImportFavText_Text="You can export your favorites from your browser into a file using the File Import/Export option. Once you have exported the file import them using this form.";

var L_StocksPrompt_Text="enter symbol";

var L_StocksQuotesDelay_Text="Quotes delayed 20 minutes";

var L_StocksRemove_Text="Remove quote";

var L_StocksNotFound_Text="Symbol not found. Please check the symbol and try again.";

var L_StocksInstructions_Text="Add stocks to your list by entering one or more symbols above and clicking Go.";

var L_Theme01Name_Text="ocean";

var L_Theme02Name_Text="granite";

var L_Theme03Name_Text="ice";



registerNamespace("Start.AddContentModule");



Start.AddContentModule=function(b,c,e)

{

    Start.AddContentModule.initializeBase(this,arguments);

    var m_el=b;

    var m_this=this;

    var m_module=c.module;

    var m_contentContainer=null;

    var m_isOpen=false;

    var m_searchForm=null;

    var m_directForm=null;

    var m_advText=null;

    this.initialize=function(g)

    {

        Start.AddContentModule.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,g);

        m_el.innerHTML="";

        m_module.SetTitleText(L_AddContentHeading_Text);

        var text=document.createElement("div");

        text.innerHTML=L_AddBySearch_Text;

        text.className="addContentText";

        m_el.appendChild(text);

        m_searchForm=document.createElement("form");

        m_searchForm.className="addFeedBySearchForm";

        m_searchForm.attachEvent("onsubmit",j);

        var inpt=document.createElement("input");

        inpt.className="addContentSearchEdit";

        inpt.type="text";

        m_searchForm.appendChild(inpt);

        var btn=document.createElement("input");

        btn.className="addContentSearchButton";

        btn.type="submit";

        btn.value=L_AddSearchButton_Text;

        m_searchForm.appendChild(btn);

        m_el.appendChild(m_searchForm);

        m_directForm=document.createElement("form");

        m_directForm.className="addFeedByUrlForm";

        m_directForm.attachEvent("onsubmit",n);

        var text=document.createElement("div");

        text.innerHTML=L_AddByUrl_Text;

        text.className="addContentText";

        m_directForm.appendChild(text);

        var inpt=document.createElement("input");

        inpt.className="addFeedByUrlEdit";

        inpt.type="text";

        m_directForm.appendChild(inpt);

        var btn=document.createElement("input");

        btn.className="addFeedByUrlButton";

        btn.type="submit";

        btn.value=L_AddSubscribeButton_Text;

        m_directForm.appendChild(btn);

        m_el.appendChild(m_directForm);

        m_advText=document.createElement("div");

        m_advText.innerHTML=L_AddAdvanced_Text;

        m_advText.className="MoreContentText";

        m_advText.attachEvent("onclick",l);

        m_el.appendChild(m_advText);

        m_contentContainer=document.createElement("div");

        m_contentContainer.style.display="none";

        var frm=document.createElement("form");

        frm.className="addFeedByOPMLForm";

        frm.action=Start.Const.StartService+"/UploadOPML3";

        frm.encoding="multipart/form-data";

        frm.method="post";

        var text=document.createElement("div");

        text.className="addContentText";

        text.innerHTML=L_AddImportOpml_Text;

        frm.appendChild(text);

        var inpt=document.createElement("input");

        inpt.className="addFeedByOPMLEdit";

        inpt.type="file";

        inpt.maxlength="1024";

        inpt.name="file";

        frm.appendChild(inpt);

        var btn=document.createElement("input");

        btn.className="addFeedByOPMLButton";

        btn.type="submit";

        btn.value=L_AddImportButton_Text;

        frm.appendChild(btn);

        m_contentContainer.appendChild(frm);

        var inpt=document.createElement("input");

        inpt.type="hidden";

        inpt.name="redirectUrl";

        inpt.value=window.location.href;

        frm.appendChild(inpt);

        text=document.createElement("div");

        text.style.paddingTop="20px";

        text.innerHTML=L_ExportFeedByOPMLStr1_Text;

        var elLink=document.createElement("a");

        elLink.href=Start.Const.StartService+"/ExportOPML";

        elLink.target="_blank";

        elLink.innerText=L_ExportFeedByOPMLStr2_Text;

        elLink.title=L_ExportFeedByOPMLTitle_Text;

        text.appendChild(elLink);

        text.appendChild(document.createTextNode(L_ExportFeedByOPMLStr3_Text));

        m_contentContainer.appendChild(text);

        m_el.appendChild(m_contentContainer);

    };

	

    this.dispose=function(h)

    {

        Start.AddContentModule.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,h);

        m_searchForm.detachEvent("onsubmit",j);

        m_directForm.detachEvent("onsubmit",n);

        m_advText.detachEvent("onclick",l);

        m_searchForm=m_searchForm=m_el=m_advText=null;

    };

	

function j(k)

{

    var editBox=k.srcElement.firstChild;

    if(editBox.value!="")

    {

        var title=editBox.value;

        var clientData="{type:1,binding:'Start.SearchModule',params:{query:'"+editBox.value.replace(/\'/g,"\\'")+"', defaultTab:2    }    ,isExpanded:true}";

		

		Start.BookmarkService.AddBookmark(title,"",Start.Const.RecentSearchesFolderIdStr,clientData);

		var params={    "query":editBox.value,"defaultTab":2};

		theApp.DisplayPopupModule(L_AddSearchPopup_Text+title,null,Start.Const.BindingType.Internal,Start.SearchModule,params);

		var bookmark=new Start.Struct.Bookmark.Item(title,null,null,clientData);

		if(theApp.GetSidebar().GetRecentSearchesGroup()&&theApp.GetSidebar().GetRecentSearchesGroup().IsExpanded())theApp.GetSidebar().GetRecentSearchesGroup().AddItem(bookmark,true,true,true);

	}

	event.returnValue=false;

	return false;

}



function l(m)

{

    m_isOpen=!m_isOpen;

    m_contentContainer.style.display=m_isOpen?"":"none";

    return false;

}

function n(o)

{

    var editBox=o.srcElement.childNodes[1];

    if(editBox.value!="")

    {

        var feedUrl=editBox.value.replace(/&/g,"%26");

        if(feedUrl.substring(0,7)!="http://")feedUrl="http://"+feedUrl;

        var r=Web.Network.createRequest(Web.Network.Type.XML,feedUrl,

        {

            "numItems":1,"feedUrl":feedUrl,"editBox":editBox,"initialQuery":true

        }

        ,p);

        r.execute();

        editBox.style.color="gray";

        editBox.value=L_AddFeedVerifyText_Text;

    }

    event.returnValue=false;

    return false;

}

function p(q,s)

{

    var rssInfo=Start.Parser.ParseRssResponse(q);

    if(rssInfo)

    {

        if(rssInfo.channels.length>0)

        {

            s.editBox.style.color="#000000";

            s.editBox.value="";

            w(s.feedUrl,rssInfo.channels[0]);

            return;

        }

    }

    if(s.initialQuery)

    {

        s.editBox.value=L_AddDiscoverTagText_Text;

function t(q,u,v)

{

    if(v&&v.length>0)

    {

        var feedUrl=v[0].url.replace(/&/g,"%26");

        if(feedUrl.substring(0,7)!="http://")feedUrl="http://"+feedUrl;

        s.feedUrl=feedUrl;

        s.initialQuery=false;

        s.numItems=1;

        var r=Web.Network.createRequest(Web.Network.Type.XML,feedUrl,s,p);

        r.execute();

        s.editBox.value=L_AddFeedVerifyText_Text;

    }

    else

    {

        s.editBox.style.color="#000000";

        s.editBox.value="";

    }

}

Start.StartService.EnumRssFeeds(s.feedUrl,t);

}

else

{

s.editBox.style.color="#000000";

s.editBox.value="";

}

}

function w(x,y)

{

    var item=null;

    theApp.GetSidebar().Expand();

    theApp.GetSidebar().Pin();

    var myFeedsGroup=theApp.GetSidebar().GetMyFeedsGroup();

    var data=new Object();

    data.type=parseInt(Start.Const.BindingType.Internal,10);

    data.binding="Start.RssReader";

    data.params=

    {

        "feedUrl":x,"numItems":5

    };

    data.isExpanded=true;

    var bookmark=new Start.Struct.Bookmark.Item(y.title,null,y.link,Start.Util.ObjectToString(data));

    if(myFeedsGroup.IsExpanded())item=myFeedsGroup.AddItem(bookmark,true,false,true);

function z()

{

    myFeedsGroup.Expand();

    myFeedsGroup.FlashItem(bookmark.name,true);

}

if(item||!myFeedsGroup.IsExpanded())Start.Store.AddFeedToMyFeedsFolder(bookmark,z);

else z();

}

};

Start.AddContentModule.registerClass("Start.AddContentModule","Web.Bindings.Base");

registerNamespace("Start.App");

var theApp=null;

Start.App=function(A,B,C)

{

Start.App.initializeBase(this,arguments);

var m_el=A;

var m_this=this;

var m_sheet=null;

var m_sidebar=null;

var m_readerContainer=null;

var m_reader=null;

var m_readerTds=null;

var m_toolbar=null;

var m_lastSheetWidth=0;

var m_readerRightMargin=15;

var m_prefs=null;

var m_useDefaultContent=false;

var m_attemptedLogin=false;

var mc_readerTdOffset=60;

var mc_minModuleWidth=350;

var mc_maxCols=9;

var m_market=null;

var m_language=null;

var m_locale=null;

this.GetSheet=function()

{

return m_sheet;

};

this.GetSidebar=function()

{

return m_sidebar;

};

this.GetToolbar=function()

{

return m_toolbar;

};

this.GetMarket=function()

{

return m_market;

};

this.GetLanguage=function()

{

return m_language;

};

this.GetLocale=function()

{

return m_locale;

};

this.initialize=function(D)

{

Start.App.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,D);

Web.Network.onrequest.attach(G);

document.attachEvent("onkeydown",Jb);

Eb();

theApp=this;

Start.StartService.GetPreferences(Start.Const.PrefPrefix,gb);

};

this.dispose=function(E)

{

Start.App.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,E);

document.detachEvent("onkeydown",Jb);

Web.Network.onrequest.detach(G);

if(m_sidebar)

{

    m_sidebar.detachEvent("onSidebarExpandedEvent",T);

    m_sidebar.detachEvent("onSidebarCollapsedEvent",U);

}

if(m_reader)

{

    S();

    for(var i=0;

    i<m_readerTds.length;

    i++)

    {

        Web.Bindings.removeBindings(m_readerTds[i].GetEl());

    }

}

window.detachEvent("onresize",cb);

m_sidebar=m_sheet=m_toolbar=m_el=A=theApp=null;

};

function F()

{

    var btn=document.getElementById("searchButton");

    if(btn&&btn.value!=L_SearchLabel_Text)btn.value=L_SearchLabel_Text;

    var isSidebarExpanded=m_this.GetPreference(Start.Const.PrefPrefix+"showsidebar")=="true"?true:false;

    var div=document.createElement("div");

    m_el.appendChild(div);

    m_sidebar=Web.Bindings.attachElementBindingSync(div,Start.Sidebar,m_this,

    {

        "isExpanded":isSidebarExpanded

    }

    );

    m_sidebar.attachEvent("onSidebarExpandedEvent",T);

    m_sidebar.attachEvent("onSidebarCollapsedEvent",U);

    var div=document.createElement("div");

    m_el.appendChild(div);

    m_sheet=Web.Bindings.attachElementBindingSync(div,Start.Sheet,m_this);

    if(isSidebarExpanded)Z(true);

    var div=document.createElement("div");

    m_el.appendChild(div);

    m_toolbar=Web.Bindings.attachElementBindingSync(div,Start.Toolbar,m_this);

    var q=Start.Util.ReadQS("q");

    if(q)

    {

        var qf=document.getElementById("sf");

        qf.q.value=q;

        sf();

    }

    window.attachEvent("onresize",cb);

    m_sheet.AddPage("default",Start.Const.DefaultPageId);

    m_sheet.SetActivePage(0);

    var useDefaultContent=m_this.GetPreference(Start.Const.PrefPrefix+"skipdefaultcontent")=="true"?false:true;

    if(useDefaultContent)

    {

        m_sheet.GetCurrentPage().ShowDefaultContent();

        m_this.SetPreference(Start.Const.PrefPrefix+"skipdefaultcontent",true);

        m_sidebar.Pin();

    }

}

function G(H)

{

    if(H.type==Web.Network.Type.XML||H.type==Web.Network.Type.XMLGet)

    {

        var strDomain=Web.Utility.extractHost(H.url);

        if(strDomain!="localhost"&&strDomain!=Web.Utility.extractHost(document.location)&&strDomain!="www.start.com")

        {

            var n=H.context&&H.context.numItems||5;

            var encFeedUrl=H.url.replace(/&/g,"%26");

            H.url=Start.Const.FetchUrlApi+"?returnheadlines="+n+"&fetchurl="+encFeedUrl+"&rand="+Math.random();

        }

    }

}

this.DisplayPopupModule=function(I,J,K,L,M)

{

    scrollTo(0,0);

    if(m_reader)S();

    if(!m_readerContainer)m_readerContainer=V();

    m_reader=Web.Bindings.attachSelectorBindingSync(".rssReader",Start.PopupModule,m_this,

    {

        "title":I,"link":J,"bindingType":K,"binding":L,"bindingParams":M

    }

    )[0];

    m_reader.attachEvent("onReaderClosedEvent",R);

    X(m_sidebar.IsExpanded()&&!m_sidebar.IsPinned());

    if(m_lastSheetWidth==0)window.setTimeout(X,1);

    m_readerContainer.style.display="";

};



this.ClosePopupModule=function()

{

    if(m_reader)S();

};

this.GetPreference=function(N)

{

    if(m_prefs)return m_prefs[N];

    return null;

};

this.SetPreference=function(O,P,Q)

{

    if(m_prefs)

    {

        m_prefs[O]=P;

        Start.StartService.SetPreference(O,P,Q);

    }

};

function R()

{

    S();

}

function S()

{

    if(m_reader)

    {

        m_readerContainer.style.display="none";

        m_reader.detachEvent("onReaderClosedEvent",R);

        Web.Bindings.removeBindings(m_reader.GetEl());

        var nodes=m_reader.GetEl().childNodes;

        for(var i=nodes.length-1;

        i>=0;

        i--)

        {

            nodes[i].removeNode(true);

        }

        m_reader=null;

    }

}

function T()

{

    Z(true);

    X(false);

    m_this.SetPreference(Start.Const.PrefPrefix+"showsidebar",true);

}

function U()

{

    Z(false);

    X(false);

    m_this.SetPreference(Start.Const.PrefPrefix+"showsidebar",false);

}

function V()

{

    var container=document.createElement("div");

    container.className="shadowedBox";

    if(Web.Browser.isMozilla())m_sheet.GetEl().insertAdjacentElement("afterBegin",container);

    else m_el.insertAdjacentElement("afterBegin",container);

    var htm="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";

    htm+="<tr valign=\"top\">";

    htm+="<td class=\"drop a\"></td>";

    htm+="<td class=\"drop b\"></td>";

    htm+="<td class=\"drop c ckWidth\"";

    if(m_lastSheetWidth>0)htm+=" style=\"width: "+(m_lastSheetWidth-(m_readerRightMargin+mc_readerTdOffset))+"px\"";

    htm+="></td>";

    htm+="<td class=\"drop d\"></td>";

    htm+="<td class=\"drop e\"></td>";

    htm+="</tr>";

    htm+="</table>";

    htm+="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";

    htm+="<tr valign=\"top\">";

    htm+="<td class=\"drop p\"><div>&nbsp;    </div></td>";

    htm+="<td class=\"rssReader\" rowspan=\"3\"";

    if(m_lastSheetWidth>0)htm+=" style=\"width: "+(m_lastSheetWidth-m_readerRightMargin)+"px\"";

    htm+=">";

    htm+="</td>";

    htm+="<td class=\"drop f\"><div>&nbsp;    </div></td>";

    htm+="</tr>";

    htm+="<tr valign=\"top\">";

    htm+="<td class=\"drop o\"><div>&nbsp;    </div></td>";

    htm+="<td class=\"drop g\"><div>&nbsp;    </div></td>";

    htm+="</tr>";

    htm+="<tr valign=\"top\">";

    htm+="<td class=\"drop n\"><div>&nbsp;    </div></td>";

    htm+="<td class=\"drop h\"><div>&nbsp;    </div></td>";

    htm+="</tr>";

    htm+="</table>";

    htm+="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";

    htm+="<tr valign=\"top\">";

    htm+="<td class=\"drop m\"></td>";

    htm+="<td class=\"drop l\"></td>";

    htm+="<td class=\"drop k ckWidth\"";

    if(m_lastSheetWidth>0)htm+=" style=\"width: "+(m_lastSheetWidth-(m_readerRightMargin+mc_readerTdOffset))+"px\"";

    htm+="></td>";

    htm+="<td class=\"drop j\"></td>";

    htm+="<td class=\"drop i\"></td>";

    htm+="</tr>";

    htm+="</table>";

    container.innerHTML=htm;

    m_readerTds=Web.Bindings.attachSelectorBindingSync(".ckWidth",DropTd,m_this);

    return container;

}

DropTd=function(A,B,C)

{

    DropTd.initializeBase(this,arguments);

    this.GetEl=function()

    {

        return A;

    };

    this.Resize=function(W)

    {

        A.style.width=W+"px";

    };

};

DropTd.registerClass("DropTd","Web.Bindings.Base");

function X(Y)

{

    m_lastSheetWidth=m_sheet?m_sheet.GetEl().offsetWidth:0;

    if(m_reader)

    {

        var sidebarOffset=0;

        if(Y)sidebarOffset=214;

        m_reader.Resize(m_lastSheetWidth-m_readerRightMargin-sidebarOffset);

        for(var i=0;

        i<m_readerTds.length;

        i++)

        {

            m_readerTds[i].Resize(m_lastSheetWidth-(m_readerRightMargin+mc_readerTdOffset)-sidebarOffset);

        }

    }

}

function Z(ab)

{

    m_sheet.GetEl().style.marginLeft=ab?"230px":"";

}

this.MovePopup=function(bb)

{

    if(m_readerContainer)

    {

        m_readerContainer.style.marginLeft=bb?"194px":"";

        X(bb);

    }

};

function cb(eb)

{

    X(false);

}

function gb(hb,jb,kb)

{

    if(!jb.error)

    {

        m_prefs=kb;

        var market=theApp.GetPreference(Start.Const.PrefPrefix+"market");

        var qs_market=Start.Util.ReadQS("market");

        if(!market)market=qs_market;

        if(!market)market=Hb(navigator.language?navigator.language.toLowerCase():navigator.userLanguage);

        if(market&&Fb(market))

        {

            m_market=market.toLowerCase();

            tmp=market.split("-");

            m_language=tmp[0].toLowerCase();

            m_locale=tmp[1].toLowerCase();

function lb()

{

    F();

    return;

}

function mb()

{

    var h=location.href.split("?")[0];

}

if(qs_market)m_this.SetPreference(Start.Const.PrefPrefix+"market",market,mb);

var isLanguageSet=false;

var isMarketSet=false;

function nb()

{

    isLanguageSet=true;

    if(isMarketSet)lb();

}

function ob()

{

    isMarketSet=true;

    if(isLanguageSet)lb();

}

tb(m_language,nb);

yb(m_language,m_locale,ob);

return;

}

else

{

m_market="en-us";

m_language="en";

m_locale="us";

}

F();

}

else

{

if(jb.code==-200&&jb.message=="InvalidSession"&&!m_attemptedLogin)

{

m_attemptedLogin=true;

function pb(qb,rb,sb)

{

    Start.StartService.GetPreferences(Start.Const.PrefPrefix,gb);

}

Start.StartService.Login(pb);

}

}

}

function tb(ub,vb)

{

function wb(xb)

{

    Web.Utility.Script.attachScript(xb,document.body);

    vb(xb);

}

var r=Web.Network.createRequest(Web.Network.Type.Script,"loc/"+ub+"/loc.js",null,wb);

r.execute();

}

function yb(zb,Ab,Bb)

{

function Cb(Db)

{

    Web.Utility.Script.attachScript(Db,document.body);

    Bb(Db);

}

var r=Web.Network.createRequest(Web.Network.Type.Script,"loc/"+zb+"/"+Ab+"/market.js",null,Cb);

r.execute();

}

function Eb()

{

    m_marketConfig=["de-de","en-au","en-gb","en-us","es-es","es-us","fr-fr","it-it","ja-jp"];

}

function Fb(Gb)

{

    var m=Gb.toLowerCase();

    for(var i=0;

    i<m_marketConfig.length;

    i++)

    {

        if(m_marketConfig[i]==m)return true;

    }

    return false;

}

function Hb(Ib)

{

    switch(Ib)

    {

        case "de":return "de-de";

        case "en":return "en-us";

        case "es":return "es-es";

        case "fr":return "fr-fr";

        case "it":return "it-it";

        case "ja":return "ja-jp";

    }

    return Ib;

}

function Jb(Kb)

{

    var s=event.srcElement;

    var tgt=document.getElementById("searchEdit");

    if(s&&tgt&&!event.ctrlKey&&!event.altKey&&!event.metaKey)

    {

        var k=event.keyCode;

        if(s==tgt)

        {

            if(32<k&&k<35||!tgt.value&&36<k&&k<41)tgt.blur();

        }

        else

        {

            if(s.type!="text"&&s.type!="textarea"&&(47<k&&k<91||95<k&&k<112||185<k&&k<193||218<k&&k<231))

            {

                tgt.value="";

                tgt.focus();

            }

        }

    }

}

};

Start.App.registerClass("Start.App","Web.Bindings.Base");

registerNamespace("Start.BindingManager");

Start.BindingManager=new function()

{

    var m_secureList=new Object();

    var m_blnInit=false;

    var m_views=Web.Enum.create("Standard","Custom","Insecure","Security");

    this.getViewState=function(p_strUrl)

    {

        return m_secureList[p_strUrl];

    };

function ExtendList(p_ev)

{

    for(var i in p_ev.Package.list)

    {

        m_secureList[i]=p_ev.Package.list[i];

    }

}

this.Downloader=function(p_el,p_owner,p_view)

{

    var m_objBM=this;

    var m_intDefinitions=0;

    var m_objRequests=new Object();

    var m_arrBindingSources=new Array();

    var m_arrCSSSources=new Array();

    var m_blnFirst=true;

    var m_strLink;

    var m_strTitle;

    var m_strType;

    var m_strBehavior;

    var m_blnSkip=false;

    var m_objCacheFeed=null;

    var m_strSources=null;

    var m_bindingParams=null;

    var m_resecure=null;

    var m_ok;

    var m_cancel;

    var m_url;

    var m_save;

    var m_description;

    var m_gadgetonly=false;

    var m_autosave=false;

    var m_secure=true;

function AbortRequests()

{

    for(var i in m_objRequests)

    {

        try

        {

            m_objRequests[i].Abort();

            m_objRequests[i]=null;

        }

        catch(ex)

        {

        }

    }

}

function DisposeSecure()

{

    if(m_resecure)

    {

        m_resecure.onclick=null;

        m_resecure.removeNode(true);

        m_resecure=null;

    }

}

function DoDefault()

{

    Web.Bindings.removeBindings(p_el);

    var objBinding=Web.Bindings.attachElementBindingSync(p_el,m_default,null,m_objCacheFeed);

    m_callback(objBinding);

}

function DisplayStandardUx()

{

    DisposeSecure();

    m_secureList[m_url]=m_secure?m_views.Standard:m_views.Insecure;

    m_resecure=document.createElement("DIV");

    m_resecure.className="Start_BindingManager_Custom";

    m_resecure.innerHTML="Switch to Custom Experience";

    p_el.insertAdjacentElement("afterEnd",m_resecure);

    m_resecure.onclick=ResetCustom;

}

function DisplayCustomUx()

{

    DisposeSecure();

    m_secureList[m_url]=m_views.Custom;

    if(!m_gadgetonly)

    {

        m_resecure=document.createElement("DIV");

        m_resecure.className="Start_BindingManager_Custom";

        m_resecure.innerHTML="Switch to Standard Experience";

        p_el.insertAdjacentElement("afterEnd",m_resecure);

        m_resecure.onclick=ResetDefault;

    }

}

function ResetDefault()

{

    DisplayStandardUx();

    DoDefault();

    DoSave();

}

function ResetCustom()

{

    m_secureList[m_url]=m_secure?m_views.Custom:m_views.Security;

    DisplaySecurity();

}

function DoSave()

{

    if(m_autosave||m_save&&m_save.checked)m_objBM.onsavestate.fire(m_secureList[m_url]);

}

function DoCustom()

{

    m_secure=true;

    m_secureList[m_url]=m_views.Custom;

    DoSave();

    if(m_objCacheFeed.feed)DisplayCustomUx();

    p_el.innerHTML="";

    Web.Bindings.removeBindings(p_el);

    Web.Bindings.attachElementBinding(p_el,m_strType,null,m_objCacheFeed,null,m_callback,m_arrBindingSources,m_arrCSSSources,null);

    if(m_ok)m_ok.onclick=m_cancel.onclick=null;

}

function DisplaySecurity()

{

    if(m_secure&&!m_secureList[m_url])m_secureList[m_url]=m_views.Custom;

    if(m_secureList[m_url])switch(m_secureList[m_url])

    {

        case m_views.Insecure:case m_views.Standard:ResetDefault();

        return;

        break;

        case m_views.Custom:DoCustom();

        return;

        break;

    }

    m_secureList[m_url]=m_views.Security;

    var elMessage=document.createElement("div");

    m_cancel=document.createElement("input");

    DisposeSecure();

    if(!m_gadgetonly)

    {

        elMessage.innerHTML="<P><B class='Start_BindingManager_Warning'>Only install Gadgets from trusted sites.</B><P>This RSS feed loaded from <EM>"+m_url.replace("<","&lt;        ")+"</EM> wants to load a custom gadget. The Gadget presents a customized experience for this feed. Below is a description of the feed: <P class='Start_BindingManager_Desc'>"+(m_description||"No Description")+"<P><B>Do you trust this site and want to install the Gadget</B>? If you are not sure, display the feed using the Standard View. Installed Gadgets will have access to all information in the Start.com experience.";

        m_cancel.value="Standard View";

    }

    else

    {

        elMessage.innerHTML="<P><B class='Start_BindingManager_Warning'>Only install Gadgets from trusted sites.</B><P>This a custom Gadget from <EM>"+m_url.replace("<","&lt;        ")+"</EM>. Below is a description of the Gadget: <P class='Start_BindingManager_Desc'>"+(m_description||"No Description")+"<P><B>Do you trust this site and want to install this Gadget</B>? The installed Gadget will have access to information in the Start.com experience.";

        m_cancel.value="Remove";

    }

    m_cancel.onclick=function()

    {

        if(!m_gadgetonly)

        {

            DisplayStandardUx();

            DoDefault();

            DoSave();

        }

        else m_callback(null);

    };

    m_ok=document.createElement("input");

    m_ok.value="Install Gadget";

    m_ok.type=m_cancel.type="button";

    var elSaving=document.createElement("div");

    m_save=document.createElement("input");

    m_save.type="checkbox";

    var elLabel=document.createElement("span");

    elLabel.innerText=" Save as long as I use this Gadget";

    elSaving.appendChild(m_save);

    elSaving.appendChild(elLabel);

    m_ok.onclick=function()

    {

        DoCustom();

    };

    p_el.innerHTML="";

    p_el.appendChild(elMessage);

    p_el.appendChild(m_ok);

    p_el.appendChild(m_cancel);

    p_el.appendChild(elSaving);

    m_save.checked=m_autosave;

}

function OnDefinitionReceived(p_xmlResponse,p_strUrl)

{

    delete m_objRequests[p_strUrl];

    if(p_xmlResponse.status!=200)

    {

        p_el.innerHTML=L_UnableToDownloadDef_Text+p_strUrl;

        AbortRequests();

        return;

    }

    var rssInfo=Start.Parser.ParseRssResponse(p_xmlResponse);

    var channel=rssInfo.channels[0];

    var bContinue=true;

    if(!rssInfo)

    {

        p_el.innerHTML=L_ErrorLoadingDef_Text+p_strUrl;

        bContinue=false;

    }

    if(rssInfo.channels.length==0||rssInfo.channels[0].items.length==0)

    {

        p_el.innerHTML=L_InvalidDef_Text+p_strUrl;

        bContinue=false;

    }

    if(m_blnFirst&&bContinue)

    {

        m_strType=channel.binding.type;

        m_strBehavior=channel.binding.manifest;

        m_description=channel.description;

        if(m_strBehavior)

        {

            m_objCacheFeed=

            {

                "feed":rssInfo

            };

            m_intDefinitions--;

            bContinue=true;

            m_blnSkip=true;

        }

        else

        {

            if(channel.link)m_strLink=channel.link;

            if(channel.title)m_strTitle=channel.title;

            var title=window[channel.titleResourceID];

            if(null!=title)m_strTitle=title;

            if(!m_objCacheFeed)

            {

                m_objCacheFeed=

                {

                    "feed":rssInfo

                };

                m_gadgetonly=true;

            }

            m_blnFirst=false;

        }

    }

    if(!bContinue)AbortRequests();

    else

    {

        if(!m_blnSkip)

        {

            var arrInherit=new Array();

            for(var i=0;

            i<channel.items.length;

            i++)

            {

                m_strSources=channel.items[i].link;

                if(m_strSources)switch(m_strSources.type)

                {

                    case "css":m_arrCSSSources.queue(m_strSources);

                    break;

                    case "inherit":arrInherit.push(m_strSources);

                    break;

                    default:m_arrBindingSources.push(m_strSources);

                }

            }

            while(arrInherit.length>0)

            {

                m_objBM.RequestDefinition(arrInherit.dequeue());

            }

            m_intDefinitions--;

            if(m_intDefinitions==0)

            {

                p_el.innerHTML="";

                p_owner.SetTitleLink(m_strLink);

                p_owner.SetTitleText(m_strTitle);

                if(!m_objCacheFeed)m_objCacheFeed=new Object();

                for(var i in m_bindingParams)

                {

                    m_objCacheFeed[i]=m_bindingParams[i];

                }

                m_objCacheFeed.xml=p_xmlResponse;

                m_objCacheFeed.uri=p_strUrl;

                if(m_strType)DisplaySecurity();

                else DoDefault();

            }

        }

        else

        {

            m_blnSkip=false;

            m_objBM.RequestDefinition(m_strBehavior);

        }

    }

}

var m_default;

var m_callback;

this.onsavestate=Web.Event.create();

this.RequestDefinition=function(url,params,defaultBinding,defCb)

{

    if(!m_objRequests[url])

    {

        var strHost=Web.Utility.extractHost(url);

        m_secure=m_secure&&(strHost==""||Web.Utility.extractHost(document.location)==Web.Utility.extractHost(url));

        m_intDefinitions++;

        if(m_blnFirst&&!m_default)

        {

            m_bindingParams=params;

            m_default=defaultBinding;

            m_callback=defCb;

            m_url=url;

            if(p_view)

            {

                m_secureList[m_url]=Web.Enum.getValue(m_views,p_view);

                m_autosave=true;

            }

        }

        var r=Web.Network.createRequest(Web.Network.Type.XML,url,params&&params.numItems?

        {

            "numItems":params.numItems

        }

        :null,OnDefinitionReceived);

        m_objRequests[url]=r;

        r.execute();

    }

};

this.dispose=function()

{

    m_objBM.onsavestate.dispose();

    if(m_cancel)m_save=p_el=m_cancel=m_ok=m_cancel.onclick=m_ok.onclick=null;

    if(m_resecure)

    {

        m_resecure.onclick=null;

        m_resecure=null;

    }

    AbortRequests();

    m_callback=null;

    for(var item in m_bindingParams)

    {

        m_bindingParams[item]=null;

    }

    m_bindingParams=null;

};

};

}

();

registerNamespace("Start.CategoriesGroup");

Start.CategoriesGroup=function(Lb,Mb,Nb)

{

Start.CategoriesGroup.initializeBase(this,arguments);

var m_el=Lb;

var m_this=this;

this.initialize=function(Ob)

{

Start.CategoriesGroup.getBaseMethod(this,"initialize","Start.Group").call(this,Ob);

};

this.dispose=function(Pb)

{

Start.CategoriesGroup.getBaseMethod(this,"dispose","Start.Group").call(this,Pb);

m_el=Lb=Mb=null;

};

this.RenderContent=function()

{

m_this.GetBodyEl().innerText=L_Loading_Text;

Start.Store.FetchCategoryFeeds(Qb);

};

function Qb(Rb,Sb,Tb)

{

    m_this.GetBodyEl().innerHTML="";

    if(!Sb.error)

    {

        for(var i=0;

        i<Tb.folders.length;

        i++)

        {

            m_this.AddFolder(Tb.folders[i],false,null,false);

        }

        for(var i=0;

        i<Tb.bookmarks.length;

        i++)

        {

            m_this.AddItem(Tb.bookmarks[i],false);

        }

    }

}

};

Start.CategoriesGroup.registerClass("Start.CategoriesGroup","Start.Group");

registerNamespace("Start.Const");

Start.Const=new function()

{

    var svcHost;

    var cfwHost;

    var fetchUrlApi;

    switch(window.location.hostname)

    {

        case "start.com":case "www.start.com":svcHost="www.start.com";

        cfwHost="www.start.com";

        fetchUrlApi="http://"+svcHost+"/startservice/startservice.asmx/FetchUrl";

        break;

        case "samsnwbe16":svcHost="samsnwbe16";

        cfwHost="samsnwbe16";

        fetchUrlApi="http://"+cfwHost+"/feeds/news-dyn.xml";

        break;

        case "localhost":svcHost="www.start.com";

        cfwHost="www.start.com";

        fetchUrlApi="http://"+svcHost+"/startservice/startservice.asmx/FetchUrl";

        break;

        default:svcHost="www.start.com";

        cfwHost="www.start.com";

        fetchUrlApi="http://"+svcHost+"/startservice/startservice.asmx/FetchUrl";

        break;

    }

    this.StartService="http://"+svcHost+"/startservice/startservice.asmx";

    this.CfwService="http://"+cfwHost+"/cfw";

    this.FetchUrlApi=fetchUrlApi;

    this.MyPagesFolderIdStr="00000000-0000-0000-0000-000000000001";

    this.MyFeedsFolderIdStr="00000000-0000-0000-0000-000000000002";

    this.MyBookmarksFolderIdStr="00000000-0000-0000-0000-000000000003";

    this.RecentSearchesFolderIdStr="00000000-0000-0000-0000-000000000004";

    this.PopularFeedsIdStr="00000000-0000-0000-0000-000000000009";

    this.DefaultPageId=this.MyPagesFolderIdStr;

    this.FolderPageId=0;

    this.SortOrderKey="__sortorder";

    this.SortOrderKey3Col="__sortorder3col";

    this.PrefPrefix="S3:";

    this.UseStaticPopularFeeds=true;

    this.UseStaticStaffFeeds=true;

    this.BindingType=Web.Flags.create("External",0,"Internal",1);

}

();

registerNamespace("Start.ExpandableContainer");

Start.ExpandableContainer=function(Ub,Vb,Wb)

{

    Start.ExpandableContainer.initializeBase(this,arguments);

    var m_el=Ub;

    var m_this=this;

    var m_titleBarContainer=null;

    var m_bodyContainer=null;

    var m_openCloseBtn=null;

    var m_isExpanded=Vb.isExpanded;

    var m_isInitialized=false;

    this.GetTitleBarEl=function()

    {

        return m_titleBarContainer;

    };

    this.GetBodyEl=function()

    {

        return m_bodyContainer;

    };

    this.IsExpanded=function()

    {

        return m_isExpanded;

    };

    this.initialize=function(Xb)

    {

        Start.ExpandableContainer.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Xb);

        m_titleBarContainer=document.createElement("div");

        m_el.appendChild(m_titleBarContainer);

        m_bodyContainer=document.createElement("div");

        m_bodyContainer.style.display="none";

        m_el.appendChild(m_bodyContainer);

    };

    Start.ExpandableContainer.registerBaseMethod(this,"initialize");

    this.dispose=function(Yb)

    {

        Start.ExpandableContainer.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Yb);

        m_openCloseBtn.detachEvent("onExpandedEvent",ec);

        m_openCloseBtn.detachEvent("onCollapsedEvent",gc);

        m_titleBarContainer=m_bodyContainer=m_el=m_openCloseBtn=null;

    };

    Start.ExpandableContainer.registerBaseMethod(this,"dispose");

    this.SetExpandCollapseButton=function(Zb,ac,bc,cc)

    {

        m_openCloseBtn=Web.Bindings.attachElementBindingSync(Zb,Start.ExpandableContainer.Button,m_this,

        {

            "container":m_bodyContainer,"isExpanded":m_isExpanded,"elExpand":ac,"elCollapse":bc,"ownerHandleButtonClick":cc

        }

        );

        m_openCloseBtn.attachEvent("onExpandedEvent",ec);

        m_openCloseBtn.attachEvent("onCollapsedEvent",gc);

        if(m_isExpanded)m_openCloseBtn.Expand();

        else m_openCloseBtn.Collapse();

    };

    this.Expand=function()

    {

        if(!m_isExpanded)m_openCloseBtn.Expand();

    };

    this.Collapse=function()

    {

        if(m_isExpanded)m_openCloseBtn.Collapse();

    };

    this.RenderContent=function()

    {

    };

    this.OnExpanded=function()

    {

    };

    this.OnCollapsed=function()

    {

    };

function ec()

{

    m_isExpanded=true;

    if(!m_isInitialized)

    {

        m_this.RenderContent();

        m_isInitialized=true;

    }

    m_this.OnExpanded();

}

function gc()

{

    m_isExpanded=false;

    m_this.OnCollapsed();

}

};

Start.ExpandableContainer.registerClass("Start.ExpandableContainer","Web.Bindings.Base");

Start.ExpandableContainer.Button=function(hc,jc,kc)

{

Start.ExpandableContainer.Button.initializeBase(this,arguments);

var m_el=hc;

var m_this=this;

var m_container=jc.container;

var m_isExpanded=jc.isExpanded;

var m_elExpand=jc.elExpand;

var m_elCollapse=jc.elCollapse;

var m_ownerHandleButtonClick=jc.ownerHandleButtonClick;

this.initialize=function(lc)

{

    Start.ExpandableContainer.Button.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,lc);

    if(m_elExpand&&m_elCollapse)

    {

        m_elExpand.style.display="none";

        m_el.appendChild(m_elExpand);

        m_elCollapse.style.display="none";

        m_el.appendChild(m_elCollapse);

    }

    if(!m_ownerHandleButtonClick)m_el.attachEvent("onmousedown",nc);

};

this.dispose=function(mc)

{

    Start.ExpandableContainer.Button.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,mc);

    if(!m_ownerHandleButtonClick)m_el.detachEvent("onmousedown",nc);

    m_el=m_elExpand=m_elCollapse=null;

};

this.Expand=function()

{

    oc(true);

};

this.Collapse=function()

{

    oc(false);

};

function nc()

{

    oc(!m_isExpanded);

    window.event.cancelBubble=true;

    return false;

}

function oc(pc)

{

    m_isExpanded=pc;

    if(m_elExpand&&m_elCollapse)

    {

        m_elExpand.style.display=m_isExpanded?"none":"";

        m_elCollapse.style.display=m_isExpanded?"":"none";

    }

    m_container.style.display=m_isExpanded?"":"none";

    if(m_isExpanded)m_this.fire("onExpandedEvent");

    else m_this.fire("onCollapsedEvent");

}

};

Start.ExpandableContainer.Button.registerClass("Start.ExpandableContainer.Button","Web.Bindings.Base");

Start.ExpandableContainer.Button.Events=Web.Enum.create("onExpandedEvent","onCollapsedEvent");

registerNamespace("Start.FolderItem");

Start.FolderItem=function(qc,rc,sc)

{

Start.FolderItem.initializeBase(this,arguments);

var m_el=qc;

var m_this=this;

var m_iconEl=null;

var m_titleEl=null;

var m_name=rc.name;

var m_url=rc.url;

var m_id=rc.id;

var m_bindingType=rc.bindingType;

var m_binding=rc.binding;

var m_bindingParams=rc.bindingParams;

var m_hideIcon=rc.hideIcon;

var m_isKillable=rc.isKillable;

var m_killBtn=null;

var m_isDragging=false;

var m_elDrag=null;

var m_origPos=null;

var m_modulePositions=null;

var m_origPos=null;

var m_curPos=null;

this.GetName=function()

{

    return m_name;

};

this.FlashItem=function()

{

    m_el.style.fontWeight="bold";

    if(!Web.Browser.isMozilla())m_el.focus();

    window.setTimeout(tc,1000);

};

function tc()

{

    m_el.style.fontWeight="normal";

}

this.initialize=function(uc)

{

    Start.FolderItem.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,uc);

    m_el.className="folderItem";

    if(m_isKillable)

    {

        m_el.attachEvent("onmouseover",wc);

        m_el.attachEvent("onmouseout",xc);

        m_killBtn=document.createElement("div");

        m_killBtn.className="folderItemKillBtn";

        m_killBtn.title=L_FolderRemove_Text+m_name+L_FolderItem_Text;

        m_killBtn.attachEvent("onclick",Ic);

        m_killBtn.style.display="none";

        m_el.appendChild(m_killBtn);

    }

    if(!m_hideIcon)

    {

        m_iconEl=document.createElement("div");

        m_iconEl.className="folderItemIcon ItemDefault";

        m_el.appendChild(m_iconEl);

        var r=Web.Network.createRequest(Web.Network.Type.Image,Web.Utility.extractHost(m_url,true)+"/favicon.ico",null,yc,Web.Utility.Prioritizer.Priorities.Low);

        r.execute();

    }

    m_titleEl=document.createElement("div");

    m_titleEl.className="folderItemTitle";

    m_titleEl.innerText=m_name;

    m_titleEl.title=m_name;

    m_el.appendChild(m_titleEl);

    m_titleEl.attachEvent("onmousedown",Ac);

    if(!m_hideIcon)m_iconEl.attachEvent("onmousedown",Ac);

};

this.dispose=function(vc)

{

    Start.FolderItem.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,vc);

    if(m_isKillable)

    {

        m_el.detachEvent("onmouseover",wc);

        m_el.detachEvent("onmouseout",xc);

    }

    if(!m_hideIcon)m_iconEl.detachEvent("onmousedown",Ac);

    m_titleEl.detachEvent("onmousedown",Ac);

    if(m_killBtn)m_killBtn.detachEvent("onclick",Ic);

    m_hideIcon=m_el=m_killBtn=m_titleEl=null;

};

function wc()

{

    m_killBtn.style.display="";

}

function xc()

{

    m_killBtn.style.display="none";

}

function yc(zc)

{

    if(zc&&!zc.blnError)

    {

        m_iconEl.className="folderItemIcon";

        var el=zc.cloneNode(true);

        el.height="16";

        el.width="16";

        m_iconEl.appendChild(el);

    }

}

function Ac(Bc)

{

    theApp.DisplayPopupModule(m_name,null,m_bindingType,m_binding,m_bindingParams);

    window.event.cancelBubble=true;

    return false;

}

function Cc(Dc)

{

    var scrollTop=document.documentElement.scrollTop;

    var scrollLeft=document.documentElement.scrollLeft;

    if(!m_origPos)m_origPos=Start.Util.Point(Dc.clientX+scrollLeft,Dc.clientY+scrollTop);

    else

    {

        if(!m_isDragging&&(m_origPos.x!=Dc.clientX+scrollLeft||m_origPos.y!=Dc.clientY+scrollTop))

        {

            m_isDragging=true;

            var div=m_el.cloneNode(true);

            div.style.cursor="move";

            div.style.backgroundColor="White";

            div.style.width=m_el.offsetWidth+"px";

            div.style.position="absolute";

            document.body.setCapture();

            document.body.appendChild(div);

            m_elDrag=div;

        }

        if(m_isDragging)

        {

            if(m_elDrag)

            {

                m_elDrag.style.pixelLeft=Dc.clientX-m_elDrag.offsetWidth/2+scrollLeft;

                m_elDrag.style.pixelTop=Dc.clientY-m_elDrag.offsetHeight/2+scrollTop;

            }

            var newPos=

            {

                "col":-1,"pos":-1

            };

            for(var i=0;

            i<m_modulePositions.length;

            i++)

            {

                var p=m_modulePositions[i].column;

                if(Dc.clientX+scrollLeft>=p.x&&Dc.clientX+scrollLeft<=p.x+p.cx)

                {

                    newPos.col=i;

                    for(var j=0;

                    j<m_modulePositions[i].positions.length;

                    j++)

                    {

                        var p=m_modulePositions[i].positions[j];

                        if(Dc.clientY+scrollTop>=p.y-5&&Dc.clientY+scrollTop<=p.y+p.cy+5)

                        {

                            newPos.pos=j;

                            break;

                        }

                    }

                    if(newPos.pos==-1)newPos.pos=m_modulePositions[i].positions.length;

                    break;

                }

            }

            if(newPos.col==-1)newPos.col=m_modulePositions.length-1;

            if(newPos.pos>=0&&newPos.col>=0&&(newPos.col!=m_curPos.col||newPos.pos!=m_curPos.pos))

            {

                theApp.ClosePopupModule();

                m_curPos=newPos;

            }

        }

    }

    event.returnValue=false;

    return false;

}

function Ec(Fc)

{

    m_isDragging=false;

    if(Fc.button==1||Fc.button==0)

    {

        document.attachEvent("onmouseup",Gc);

        document.attachEvent("onlosecapture",Gc);

        document.attachEvent("onmousemove",Cc);

        var page=theApp.GetSheet().GetCurrentPage();

        if(page)

        {

            m_modulePositions=page.GetModulePositions();

            m_origPos=

            {

                "col":null,"pos":null

            };

            m_curPos=m_origPos;

        }

    }

    event.returnValue=false;

    return false;

}

function Gc(Hc)

{

    document.detachEvent("onmousemove",Cc);

    document.detachEvent("onmouseup",Gc);

    document.detachEvent("onlosecapture",Gc);

    if(m_isDragging)

    {

        document.body.releaseCapture();

        m_elDrag.removeNode(true);

        m_elDrag=null;

        if(m_curPos.col>=0&&m_curPos.pos>=0)

        {

            var binding=m_binding;

            if(m_bindingType==Start.Const.BindingType.Internal&&m_binding==Start.RssReader)binding=Start.RssModule;

            var page=theApp.GetSheet().GetCurrentPage();

            if(page)

            {

                var m=page.AddModule(m_name,m_url,true,m_bindingType,binding,m_bindingParams,null,m_curPos.col,false,m_curPos.pos);

                if(m)m.Serialize(true);

            }

        }

        m_isDragging=false;

        m_origPos=null;

    }

    else

    {

        theApp.DisplayPopupModule(m_name,null,m_bindingType,m_binding,m_bindingParams);

        window.event.cancelBubble=true;

    }

    event.returnValue=false;

    return false;

}

function Ic()

{

    m_el.removeNode(true);

    m_killBtn.detachEvent("onclick",Ic);

    m_this.fire("onItemRemoved",true);

    Web.Bindings.removeBindings(m_el);

    Start.BookmarkService.RemoveBookmark(m_id);

}

};

Start.FolderItem.registerClass("Start.FolderItem","Web.Bindings.Base");

Start.FolderItem.Events=Web.Enum.create("onItemRemoved");

registerNamespace("Start.FolderMenu");

Start.FolderMenu=function(Jc,Kc,Lc)

{

Start.FolderMenu.initializeBase(this,arguments);

var m_el=Jc;

var m_this=this;

var m_name=Kc.name;

var m_id=Kc.id;

var m_bindingType=Kc.bindingType;

var m_isKillable=Kc.isKillable;

var m_killBtn=null;

var m_title=null;

this.GetName=function()

{

    return m_name;

};

this.GetId=function()

{

    return m_id;

};

this.initialize=function(Mc)

{

    Start.FolderMenu.getBaseMethod(this,"initialize","Start.ExpandableContainer").call(this,Mc);

    m_el.className="folderMenu";

    m_this.GetTitleBarEl().className="folderMenuTitleBar";

    m_this.GetBodyEl().className="folderMenuBody";

    if(m_isKillable)

    {

        m_killBtn=document.createElement("div");

        m_killBtn.className="folderItemKillBtn";

        m_killBtn.title=L_FolderRemove_Text+m_name+L_FolderItem_Text;

        m_killBtn.attachEvent("onclick",ae);

        m_killBtn.style.display="none";

        m_this.GetTitleBarEl().appendChild(m_killBtn);

        m_this.GetTitleBarEl().attachEvent("onmouseover",Oc);

        m_this.GetTitleBarEl().attachEvent("onmouseout",Pc);

    }

    var btn=document.createElement("div");

    m_this.GetTitleBarEl().appendChild(btn);

    var btnShow=document.createElement("div");

    btnShow.className="folderMenuBtn folderMenuBtnClosed";

    var btnHide=document.createElement("div");

    btnHide.className="folderMenuBtn folderMenuBtnOpen";

    m_this.SetExpandCollapseButton(btn,btnShow,btnHide);

    m_title=document.createElement("div");

    m_title.className="folderMenuTitle";

    m_title.innerText=m_name;

    m_title.title=m_name;

    m_title.attachEvent("onmousedown",Zc);

    m_this.GetTitleBarEl().appendChild(m_title);

};

Start.FolderMenu.registerBaseMethod(this,"initialize");

this.dispose=function(Nc)

{

    if(m_isKillable)

    {

        m_this.GetTitleBarEl().detachEvent("onmouseover",Oc);

        m_this.GetTitleBarEl().detachEvent("onmouseout",Pc);

    }

    Start.FolderMenu.getBaseMethod(this,"dispose","Start.ExpandableContainer").call(this,Nc);

    m_title.detachEvent("onmousedown",Zc);

    if(m_killBtn)m_killBtn.detachEvent("onclick",ae);

    m_title=m_el=m_killBtn=null;

};

Start.FolderMenu.registerBaseMethod(this,"dispose");

function Oc()

{

    if(m_killBtn)m_killBtn.style.display="";

}

function Pc()

{

    if(m_killBtn)m_killBtn.style.display="none";

}

this.RenderContent=function()

{

    m_this.GetBodyEl().innerText=L_Loading_Text;

    Start.Store.FetchSidebarFolder(m_id,Vc);

};

this.AddFolder=function(Qc,Rc,Sc)

{

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    var menu=Web.Bindings.attachElementBindingSync(div,m_bindingType,m_this,

    {

        "name":Qc.name,"id":Qc.id,"isExpanded":Rc,"bindingType":m_bindingType,"isKillable":Sc

    }

    );

};

Start.FolderMenu.registerBaseMethod(this,"AddFolder");

this.AddItem=function(Tc,Uc)

{

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    var data=null;

    if(Tc.data!="")data=Start.Util.StringToObject(Tc.data);

    else

    {

        data=new Object();

        data.type=Start.Const.BindingType.Internal;

        data.binding="Start.RssReader";

        data.params=

        {

            "feedUrl":Tc.url,"numItems":5

        };

        data.isExpanded=true;

    }

    if(data)

    {

        var binding=data.binding;

        if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

        var item=Web.Bindings.attachElementBindingSync(div,Start.FolderItem,m_this,

        {

            "name":Tc.name,"url":Tc.url,"id":Tc.id,"bindingType":data.type,"binding":binding,"bindingParams":data.params,"isKillable":Uc

        }

        );

    }

};

Start.FolderMenu.registerBaseMethod(this,"AddItem");

function Vc(Wc,Xc,Yc)

{

    m_this.GetBodyEl().innerHTML="";

    if(!Xc.error)

    {

        for(var i=0;

        i<Yc.folders.length;

        i++)

        {

            m_this.AddFolder(Yc.folders[i],false,m_isKillable);

        }

        for(var i=0;

        i<Yc.bookmarks.length;

        i++)

        {

            m_this.AddItem(Yc.bookmarks[i],m_isKillable);

        }

    }

}

function Zc()

{

    if(m_this.IsExpanded())m_this.Collapse();

    else m_this.Expand();

}

function ae()

{

    if(confirm(L_FolderDeleteConfirm_Text))

    {

        m_el.removeNode(true);

        m_killBtn.detachEvent("onclick",ae);

        Web.Bindings.removeBindings(m_el);

        Start.BookmarkService.RemoveBookmarkFolder(m_id);

    }

}

};

Start.FolderMenu.registerClass("Start.FolderMenu","Start.ExpandableContainer");

registerNamespace("Start.Group");

Start.Group=function(be,ce,ee)

{

Start.Group.initializeBase(this,arguments);

var m_el=be;

var m_this=this;

var m_title=ce.title;

var m_itemToFlash=null;

var m_itemList=new Array();

this.GetItemList=function()

{

    return m_itemList;

};

this.initialize=function(ge)

{

    Start.Group.getBaseMethod(this,"initialize","Start.ExpandableContainer").call(this,ge);

    m_el.className="group";

    m_this.GetTitleBarEl().className="groupTitleBar";

    m_this.GetBodyEl().className="groupBody";

    var ocBtn=document.createElement("div");

    m_this.GetTitleBarEl().appendChild(ocBtn);

    var t=document.createElement("div");

    t.className="groupTitle";

    t.innerText=m_title;

    t.attachEvent("onmousedown",ve);

    m_this.GetTitleBarEl().appendChild(t);

    var btnShow=document.createElement("div");

    btnShow.className="groupOCBtn groupOCBtnExpanded";

    var btnHide=document.createElement("div");

    btnHide.className="groupOCBtn groupOCBtnCollapsed";

    m_this.SetExpandCollapseButton(ocBtn,btnShow,btnHide);

};

Start.Group.registerBaseMethod(this,"initialize");

this.dispose=function(he)

{

    Start.Group.getBaseMethod(this,"dispose","Start.ExpandableContainer").call(this,he);

    for(var i=0;

    i<m_itemList.length;

    i++)

    {

        m_itemList[i].detachEvent("onItemRemoved",te);

    }

};

Start.Group.registerBaseMethod(this,"dispose");

this.RenderContent=function()

{

};

this.AddFolder=function(je,ke,le,me)

{

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    var bindingType=le?le:Start.FolderMenu;

    var menu=Web.Bindings.attachElementBindingSync(div,bindingType,m_this,

    {

        "name":je.name,"id":je.id,"isExpanded":ke,"bindingType":bindingType,"isKillable":me

    }

    );

};

this.FlashItem=function(ne,oe)

{

    if(oe)m_itemToFlash=ne;

    else for(var i=0;

    i<m_itemList.length;

    i++)

    {

        if(m_itemList[i].GetName()==ne)m_itemList[i].FlashItem();

    }

};

this.AddItem=function(pe,qe,re,se)

{

    if(m_itemToFlash&&m_itemToFlash==pe.name)

    {

        se=true;

        m_itemToFlash=null;

    }

    for(var i=0;

    i<m_itemList.length;

    i++)

    {

        if(m_itemList[i].GetName()==pe.name)

        {

            if(se)m_itemList[i].FlashItem();

            return false;

        }

    }

    var div=document.createElement("div");

    if(re)m_this.GetBodyEl().insertAdjacentElement("afterBegin",div);

    else m_this.GetBodyEl().appendChild(div);

    var data=null;

    if(pe.data!="")data=Start.Util.StringToObject(pe.data);

    else

    {

        data=new Object();

        data.type=Start.Const.BindingType.Internal;

        data.binding="Start.RssReader";

        data.params=

        {

            "feedUrl":pe.url,"numItems":5

        };

        data.isExpanded=true;

    }

    if(data)

    {

        var binding=data.binding;

        if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

        var item=Web.Bindings.attachElementBindingSync(div,Start.FolderItem,m_this,

        {

            "name":pe.name,"url":pe.url,"id":pe.id,"bindingType":data.type,"binding":binding,"bindingParams":data.params,"isKillable":qe

        }

        );

        item.attachEvent("onItemRemoved",te);

        m_itemList.push(item);

        if(se)item.FlashItem();

    }

    return item;

};

Start.Group.registerBaseMethod(this,"AddItem");

function te(ue)

{

    m_itemList.remove(ue.srcBinding);

}

function ve()

{

    if(m_this.IsExpanded())m_this.Collapse();

    else m_this.Expand();

}

};

Start.Group.registerClass("Start.Group","Start.ExpandableContainer");

M_PrivacyLinkHref_Text="http://g.msn.com/0PR_/enus";

M_CultureVariable_Text="en-us";

M_AstrologyLinkHref="http://www.astrocenter.com/msn/feeds/MyMsnDailyFile_Feed.aspx";

registerNamespace("Start.DashboardModule");

Start.DashboardModule=function(we,xe,ye)

{

Start.DashboardModule.initializeBase(this,arguments);

var m_el=we;

var m_this=this;

var m_title=xe.title;

var m_link=xe.link;

var m_bindingType=xe.bindingType;

var m_binding=xe.binding;

var m_bindingParams=xe.bindingParams;

var m_page=xe.page;

var m_id=xe.moduleId;

var m_MetaData=null;

var m_stateInitialized=false;

var m_contentModule=null;

var m_bindingManager=null;

var m_titleEl=null;

var m_killBtn=null;

var m_aboutBtn=null;

var m_iconEl=null;

var m_btnShowEl=null;

var m_btnHideEl=null;

var m_killBtnEl=null;

var m_isDragging=false;

var m_elDrag=null;

var m_modulePositions=null;

var m_origPos=null;

var m_curPos=null;

var m_origPos=null;

var m_offsetDragX=null;

var m_offsetDragY=null;

this.GetId=function()

{

    return m_id;

};

this.GetEl=function()

{

    return m_el;

};

this.GetTitle=function()

{

    return m_title;

};

this.GetLink=function()

{

    return m_link;

};

this.GetBindingType=function()

{

    return m_bindingType;

};

this.GetBinding=function()

{

    return m_binding;

};

this.GetBindingParams=function()

{

    return m_bindingParams;

};

this.GetContentModule=function()

{

    return m_contentModule;

};

this.initialize=function(ze)

{

    Start.DashboardModule.getBaseMethod(this,"initialize","Start.ExpandableContainer").call(this,ze);

    m_el.className="module";

    m_this.GetTitleBarEl().className="moduleTitleBar";

    m_this.GetBodyEl().className="moduleBody";

    m_bindingManager=new Start.BindingManager.Downloader(m_this.GetBodyEl(),this,xe.view);

    m_this.GetTitleBarEl().attachEvent("onmousedown",Te);

    document.attachEvent("onmouseup",ag);

    document.attachEvent("onlosecapture",ag);

    var ocBtn=document.createElement("div");

    m_this.GetTitleBarEl().appendChild(ocBtn);

    m_killBtnEl=document.createElement("div");

    m_this.GetTitleBarEl().appendChild(m_killBtnEl);

    m_killBtn=Web.Bindings.attachElementBindingSync(m_killBtnEl,KillBtn,null);

    m_killBtn.attachEvent("onClickedEvent",eg);

    m_iconEl=document.createElement("span");

    m_iconEl.className="moduleIcon";

    m_titleEl=document.createElement("a");

    if(m_link)m_titleEl.href=m_link;

    m_titleEl.target="new";

    m_titleEl.className="moduleTitle";

    m_this.SetTitleText(m_title);

    m_this.GetTitleBarEl().appendChild(m_iconEl);

    m_this.GetTitleBarEl().appendChild(m_titleEl);

    m_btnShowEl=document.createElement("div");

    m_btnShowEl.className="moduleOCBtn moduleOCBtnExpanded";

    m_btnHideEl=document.createElement("div");

    m_btnHideEl.className="moduleOCBtn moduleOCBtnCollapsed";

    m_this.SetExpandCollapseButton(ocBtn,m_btnShowEl,m_btnHideEl);

    m_el.attachEvent("onmouseover",hg);

    m_el.attachEvent("onmouseout",jg);

    jg();

};

Start.DashboardModule.registerBaseMethod(this,"initialize");

this.dispose=function(Ae)

{

    Start.DashboardModule.getBaseMethod(this,"dispose","Start.ExpandableContainer").call(this,Ae);

    m_bindingManager.dispose();

    try

    {

        m_this.GetTitleBarEl().detachEvent("onmousedown",Te);

    }

    catch(ex)

    {

    }

    document.detachEvent("onmouseup",ag);

    document.detachEvent("onlosecapture",ag);

    m_killBtn.detachEvent("onClickedEvent",eg);

    m_killBtn=null;

    m_aboutBtn=null;

    m_elAbout=null;

    m_bindingManager=null;

};

Start.DashboardModule.registerBaseMethod(this,"dispose");

function Be(Ce)

{

    if(Ce)m_contentModule=Ce;

    else gg();

}

var m_view=xe.view;

function De(Ee)

{

    m_view=Ee.toString();

    m_this.Serialize();

}

this.RenderContent=function()

{

    m_this.GetBodyEl().innerText=L_Loading_Text;

    if(m_bindingType==Start.Const.BindingType.External)m_bindingManager.RequestDefinition(m_binding,m_bindingParams,null,Be);

    else

    {

        var params=new Object();

        for(var i in m_bindingParams)

        {

            params[i]=m_bindingParams[i];

        }

        params.module=m_this;

        if(params.feedUrl)

        {

            m_bindingManager.RequestDefinition(params.feedUrl,params,m_binding,Be);

            m_bindingManager.onsavestate.attach(De);

        }

        else Web.Bindings.attachElementBindingSync(m_this.GetBodyEl(),m_binding,m_this,params);

    }

};

this.SetTitleText=function(Fe)

{

    m_titleEl.innerHTML=Fe;

    m_titleEl.title=Fe;

};

this.SetTitleLink=function(Ge)

{

    m_titleEl.href=Ge;

};

this.SetMetaData=function(He,Ie,Je,Ke,Le,Me,Ne)

{

    m_MetaData=

    {

        "title":He,"link":Ie,"desc":Je,"docs":Ke,"pubDate":Le,"email":Me,"image":Ne

    };

    var r=Web.Network.createRequest(Web.Network.Type.Image,Web.Utility.extractHost(Ie,true)+"/favicon.ico",null,bg,Web.Utility.Prioritizer.Priorities.Low);

    r.execute();

};

this.GetView=function()

{

    return m_view;

};

this.Serialize=function(Oe)

{

    if(m_page.GetId()!=0)

    {

        var data=new Object();

        data.type=parseInt(m_bindingType,10);

        if(m_bindingType==Start.Const.BindingType.Internal)data.binding=Start.Util.ModuleToString(m_binding);

        else data.binding=m_binding;

        data.params=m_bindingParams;

        data.isExpanded=this.IsExpanded();

        data.view=m_view;

function Pe(Qe,Re,Se)

{

    if(!Re.error&&Se)

    {

        m_id=Se.id;

        if(Oe)m_page.PersistSortOrder();

    }

}

if(m_id)Start.Store.UpdateModule(m_page.GetId(),m_id,m_title,m_link,Start.Util.ObjectToString(data));

else Start.Store.AddModuleToPage(m_page.GetId(),m_title,m_link,Start.Util.ObjectToString(data),Pe);

if(Oe&&m_id)m_page.PersistSortOrder();

}

};

this.OnExpanded=function()

{

if(m_id&&m_stateInitialized)m_this.Serialize();

m_stateInitialized=true;

};

this.OnCollapsed=function()

{

if(m_id&&m_stateInitialized)m_this.Serialize();

m_stateInitialized=true;

};

function Te(Ue)

{

    if(Ue.button==1||Ue.button==0)

    {

        document.attachEvent("onmousemove",Ye);

        m_modulePositions=m_page.GetModulePositions();

        m_origPos=null;

        for(var i=0;

        i<m_modulePositions.length&&!m_origPos;

        i++)

        {

            for(var j=0;

            j<m_modulePositions[i].positions.length;

            j++)

            {

                if(m_this==m_modulePositions[i].positions[j].m)

                {

                    m_origPos=

                    {

                        "col":i,"pos":j

                    };

                    break;

                }

            }

        }

        m_curPos=m_origPos;

    }

    event.returnValue=false;

    return false;

}

function Ve(We,Xe)

{

    for(var i=0;

    i<We.childNodes.length;

    i++)

    {

        if(We.childNodes[i].className&&We.childNodes[i].className.substring(0,12)=="toolMoreLess")

        {

            if(Xe)We.childNodes[i].style.display="none";

            else We.childNodes[i].style.display="";

        }

        Ve(We.childNodes[i],Xe);

    }

}

function Ye(Ze)

{

    if(!m_isDragging)

    {

        m_isDragging=true;

        var div=m_el.cloneNode(true);

        div.style.cursor="move";

        div.style.backgroundColor="White";

        div.style.width=m_el.offsetWidth+"px";

        div.style.position="absolute";

        document.body.setCapture();

        document.body.appendChild(div);

        m_elDrag=div;

        m_offsetDragX=Ze.clientX-m_modulePositions[m_origPos.col].column.x;

        m_offsetDragY=Ze.clientY-m_modulePositions[m_origPos.col].positions[m_origPos.pos].y+10;

        for(var i=0;

        i<m_el.childNodes.length;

        i++)

        {

            m_el.childNodes[i].style.visibility="hidden";

        }

        jg();

        if(m_binding==Start.RssModule)Ve(m_el,true);

        if(m_origPos.pos>0)

        {

            m_el.style.marginTop="8px";

            m_el.style.marginBottom="18px";

        }

        else

        {

            m_el.style.marginTop="9px";

            m_el.style.marginBottom="19px";

        }

        m_el.style.border="dotted 1px red";

    }

    var scrollTop=document.documentElement.scrollTop;

    var scrollLeft=document.documentElement.scrollLeft;

    if(m_elDrag)

    {

        m_elDrag.style.pixelLeft=Ze.clientX-m_offsetDragX;

        m_elDrag.style.pixelTop=Ze.clientY-m_offsetDragY;

    }

    var newPos=

    {

        "col":-1,"pos":-1

    };

    for(var i=0;

    i<m_modulePositions.length;

    i++)

    {

        var p=m_modulePositions[i].column;

        if(Ze.clientX+scrollLeft>=p.x&&Ze.clientX+scrollLeft<=p.x+p.cx)

        {

            newPos.col=i;

            for(var j=0;

            j<m_modulePositions[i].positions.length;

            j++)

            {

                var p=m_modulePositions[i].positions[j];

                if(Ze.clientY+scrollTop>=p.y-10&&Ze.clientY+scrollTop<=p.y+p.cy+10)

                {

                    newPos.pos=j;

                    break;

                }

            }

            if(newPos.pos==-1)newPos.pos=m_modulePositions[i].positions.length;

            break;

        }

    }

    if(newPos.col==-1)newPos.col=m_modulePositions.length-1;

    if(newPos.col!=m_curPos.col||newPos.pos!=m_curPos.pos)

    {

        m_page.RepositionModule(newPos,m_this);

        if(newPos.pos>0)

        {

            m_el.style.marginTop="8px";

            m_el.style.marginBottom="18px";

        }

        else

        {

            m_el.style.marginTop="9px";

            m_el.style.marginBottom="19px";

        }

        m_curPos=newPos;

    }

    event.returnValue=false;

    return false;

}

function ag()

{

    document.detachEvent("onmousemove",Ye);

    if(m_isDragging)

    {

        document.body.releaseCapture();

        m_elDrag.removeNode(true);

        m_elDrag=null;

        for(var i=0;

        i<m_el.childNodes.length;

        i++)

        {

            m_el.childNodes[i].style.visibility="visible";

        }

        m_el.style.border="";

        m_el.style.marginTop="10px";

        m_el.style.marginBottom="20px";

        if(m_binding==Start.RssModule)Ve(m_el,false);

        if(m_origPos.col!=m_curPos.col||m_origPos.pos!=m_curPos.pos)m_page.PersistSortOrder();

        m_isDragging=false;

    }

}

function bg(cg)

{

    if(cg&&!cg.blnError)

    {

        var el=cg.cloneNode(true);

        el.height="16";

        el.width="16";

        m_iconEl.appendChild(el);

    }

}

function eg()

{

    gg();

}

function gg()

{

    m_page.RemoveModule(m_this);

    if(m_id)Start.Store.DeleteModuleFromPage(m_id);

}

function hg()

{

    m_killBtnEl.style.visibility="visible";

}

function jg()

{

    m_killBtnEl.style.visibility="hidden";

}

var KillBtn=function(kg,lg,mg)

{

    KillBtn.initializeBase(this,arguments);

    var m_el=kg;

    var m_this=this;

    this.initialize=function(ng)

    {

        Start.Group.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,ng);

        m_el.title=L_RemoveModule_Text;

        m_el.className="moduleKillBtn";

        m_el.attachEvent("onmousedown",pg);

    };

    this.dispose=function(og)

    {

        Start.Group.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,og);

        m_el.detachEvent("onmousedown",pg);

    };

function pg()

{

    m_this.fire("onClickedEvent");

    return false;

}

};

KillBtn.registerClass("KillBtn","Web.Bindings.Base");

KillBtn.Events=Web.Enum.create("onClickedEvent");

var AboutBtn=function(qg,rg,sg)

{

AboutBtn.initializeBase(this,arguments);

var m_el=qg;

var m_this=this;

var m_elAbout=null;

this.initialize=function(tg)

{

    AboutBtn.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,tg);

    m_el.title=L_About_Text;

    m_el.className="moduleAboutBtn";

    m_el.innerText=L_QuestionMark_Text;

    m_el.attachEvent("onmousedown",vg);

};

this.dispose=function(ug)

{

    AboutBtn.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,ug);

    m_el.detachEvent("onmousedown",vg);

    m_el=null;

    m_elAbout=null;

};

function vg()

{

    if(m_MetaData)

    {

        if(!m_elAbout)m_elAbout=Start.DashboardModule.About.Generate(m_MetaData);

        var pnt=Start.Util.GetElementOffset(m_el);

        pnt.y+=m_el.offsetHeight;

        pnt.x+=m_el.offsetWidth;

        Start.DashboardModule.About.Display(m_elAbout,pnt);

        m_this.fire("onClickedEvent");

    }

    else alert(L_MissingAboutInfo_Text);

    return false;

}

};

AboutBtn.registerClass("AboutBtn","Web.Bindings.Base");

AboutBtn.Events=Web.Enum.create("onClickedEvent");

};

Start.DashboardModule.registerClass("Start.DashboardModule","Start.ExpandableContainer");

Start.DashboardModule.About=new function()

{

    var m_objCurrent=null;

    this.Generate=function(p_objMeta)

    {

        var el=document.createElement("div");

        var elImage;

        el.className="moduleAboutBox";

        el.style.display="none";

        for(var i in p_objMeta)

        {

            if(p_objMeta[i])

            {

                var elChild;

                if(i!="image")

                {

                    elChild=document.createElement("div");

                    elChild.className="moduleAboutItem";

                    elChild.innerText=p_objMeta[i];

                    el.appendChild(elChild);

                }

                else

                {

                    elChild=document.createElement("img");

                    elChild.src=p_objMeta[i].url;

                    elChild.title=p_objMeta[i].title;

                    elChild.className="moduleAboutImage";

                    if(p_objMeta[i].width)elChild.width=p_objMeta[i].width;

                    if(p_objMeta[i].height)elChild.height=p_objMeta[i].height;

                    el.insertAdjacentElement("afterBegin",elChild);

                }

            }

        }

        document.body.appendChild(el);

        return el;

    };

    this.Display=function(p_objEl,p_objPoint)

    {

        if(m_objCurrent==p_objEl)

        {

            p_objEl.style.display=p_objEl.style.display=="none"?"block":"none";

            m_objCurrent=null;

        }

        else

        {

            if(m_objCurrent)m_objCurrent.style.display="none";

            m_objCurrent=p_objEl;

            p_objEl.style.display="block";

            m_objCurrent.style.pixelLeft=0;

        }

        if(m_objCurrent)

        {

            m_objCurrent.style.pixelTop=p_objPoint.y;

            m_objCurrent.style.pixelLeft=p_objPoint.x-m_objCurrent.offsetWidth;

        }

    };

}

();

registerNamespace("Start.MyFeedsGroup");

Start.MyFeedsGroup=function(wg,xg,yg)

{

    Start.MyFeedsGroup.initializeBase(this,arguments);

    var m_el=wg;

    var m_this=this;

    var m_addFeedEl=null;

    var m_createFolderEl=null;

    this.initialize=function(zg)

    {

        Start.MyFeedsGroup.getBaseMethod(this,"initialize","Start.Group").call(this,zg);

    };

    this.dispose=function(Ag)

    {

        var list=m_this.GetItemList();

        for(var i=0;

        i<list.length;

        i++)

        {

            list[i].detachEvent("onItemRemoved",Fg);

        }

        Start.MyFeedsGroup.getBaseMethod(this,"dispose","Start.Group").call(this,Ag);

        if(null!=m_addFeedEl)m_addFeedEl.detachEvent("onmousedown",Mg);

    };

    this.RenderContent=function()

    {

        m_this.GetBodyEl().innerText=L_Loading_Text;

        Start.Store.FetchMyFeeds(Ig);

    };

    this.AddItem=function(Bg,Cg,Dg,Eg)

    {

        if(0==m_this.GetItemList().length)m_this.GetBodyEl().innerHTML="";

        var item=Start.MyFeedsGroup.getBaseMethod(this,"AddItem","Start.Group").call(this,Bg,Cg,Dg,Eg);

        if(item)item.attachEvent("onItemRemoved",Fg);

        return item;

    };

function Fg(Gg)

{

    Gg.srcBinding.detachEvent("onItemRemoved",Fg);

    if(0==m_this.GetItemList().length)Hg();

}

function Hg()

{

    m_this.GetBodyEl().innerHTML=L_ClickToAddContentText_Text;

}

function Ig(Jg,Kg,Lg)

{

    m_this.GetBodyEl().innerHTML="";

    if(!Kg.error)

    {

        if(0==Lg.folders.length&&0==Lg.bookmarks.length)Hg();

        else

        {

            for(var i=0;

            i<Lg.folders.length;

            i++)

            {

                m_this.AddFolder(Lg.folders[i],false,null,true);

            }

            for(var i=0;

            i<Lg.bookmarks.length;

            i++)

            {

                m_this.AddItem(Lg.bookmarks[i],true);

            }

        }

    }

    else m_this.GetBodyEl().innerHTML=L_Error_Text;

}

function Mg()

{

    theApp.DisplayPopupModule(L_AddContentHeading_Text,null,Start.Const.BindingType.Internal,Start.AddContentModule,null);

}

function Ng()

{

    m_createFolderEl.detachEvent("onmousedown",Ng);

    m_createFolderEl.innerHTML="";

    var frm=document.createElement("form");

    frm.className="createFolderForm";

    frm.attachEvent("onsubmit",Pg);

    var inpt=document.createElement("input");

    inpt.className="createFolderEdit";

    inpt.type="text";

    inpt.size="22";

    frm.appendChild(inpt);

    var btn=document.createElement("input");

    btn.className="createFolderButton";

    btn.type="submit";

    btn.value=L_CreateButton_Text;

    frm.appendChild(btn);

    var btn=document.createElement("input");

    btn.className="cancelCreateFolderButton";

    btn.type="submit";

    btn.value=L_CancelButton_Text;

    btn.attachEvent("onmousedown",Vg);

    frm.appendChild(btn);

    m_createFolderEl.appendChild(frm);

    setTimeout(Og,1);

function Og()

{

    inpt.focus();

}

}

function Pg(Qg)

{

    var editBox=Qg.srcElement.firstChild;

    if(editBox.value!="")

    {

function Rg(Sg,Tg,Ug)

{

}

Start.BookmarkService.AddBookmarkFolder(editBox.value,Start.Const.MyFeedsFolderIdStr,Rg);

}

event.returnValue=false;

return false;

}

function Vg()

{

    m_createFolderEl.innerHTML="";

    m_createFolderEl.innerText=L_CreateFolder_Text;

    m_createFolderEl.className="createFolderText";

    m_createFolderEl.attachEvent("onmousedown",Ng);

    m_this.GetBodyEl().appendChild(m_createFolderEl);

}

};

Start.MyFeedsGroup.registerClass("Start.MyFeedsGroup","Start.Group");

registerNamespace("Start.MyPagesGroup");

registerNamespace("Start.MyPagesFolderMenu");

Start.MyPagesGroup=function(Wg,Xg,Yg)

{

Start.MyPagesGroup.initializeBase(this,arguments);

var m_el=Wg;

var m_this=this;

this.initialize=function(Zg)

{

    Start.MyPagesGroup.getBaseMethod(this,"initialize","Start.Group").call(this,Zg);

    m_this.GetBodyEl().innerText=L_Loading_Text;

};

this.dispose=function(ah)

{

    Start.MyPagesGroup.getBaseMethod(this,"dispose","Start.Group").call(this,ah);

};

this.AddPages=function(bh)

{

    m_this.GetBodyEl().innerHTML="";

    for(var i=0;

    i<bh.length;

    i++)

    {

        m_this.AddFolder(bh[i],false,Start.MyPagesFolderMenu,false);

    }

};

};

Start.MyPagesGroup.registerClass("Start.MyPagesGroup","Start.Group");

Start.MyPagesFolderMenu=function(ch,eh,gh)

{

Start.MyPagesFolderMenu.initializeBase(this,arguments);

var m_el=ch;

var m_this=this;

var m_page=null;

var m_startedFetch=false;

this.initialize=function(hh)

{

    Start.MyPagesFolderMenu.getBaseMethod(this,"initialize","Start.FolderMenu").call(this,hh);

    var list=theApp.GetSheet().GetPageList();

    for(var i=0;

    i<list.length;

    i++)

    {

        if(m_this.GetId()==list[i].GetId())

        {

            m_page=list[i];

            break;

        }

    }

    if(m_page)

    {

        m_page.attachEvent("onModuleAddedEvent",lh);

        m_page.attachEvent("onModuleRemovedEvent",nh);

        m_page.attachEvent("onPageRemovedEvent",oh);

    }

};

this.dispose=function(jh)

{

    Start.MyPagesFolderMenu.getBaseMethod(this,"dispose","Start.FolderMenu").call(this,jh);

    if(m_page)

    {

        m_page.detachEvent("onModuleAddedEvent",lh);

        m_page.detachEvent("onModuleRemovedEvent",nh);

        m_page.detachEvent("onPageRemovedEvent",oh);

    }

};

this.RenderContent=function()

{

    if(m_page&&!m_page.IsInitialized())

    {

        m_this.GetBodyEl().innerText=L_Loading_Text;

        window.setTimeout(kh,1);

    }

};

function kh()

{

    m_startedFetch=true;

    m_page.RenderOnlyNoActivate();

}

function lh(mh)

{

    if(m_startedFetch)

    {

        m_this.GetBodyEl().innerText="";

        m_startedFetch=false;

    }

}

function nh()

{

}

function oh()

{

}

};

Start.MyPagesFolderMenu.registerClass("Start.MyPagesFolderMenu","Start.FolderMenu");

registerNamespace("Start.Page");

Start.Page=function(ph,qh,rh)

{

Start.Page.initializeBase(this,arguments);

var m_el=ph;

var m_this=this;

var m_name=qh.name;

var m_id=qh.id;

var m_sheet=qh.sheet;

var m_moduleList=new Array();

var m_columnEls=new Array();

var m_colContainer=null;

var m_sortOrderModuleId=null;

var m_numColumns=3;

var m_isInitialized=false;

this.GetId=function()

{

    return m_id;

};

this.GetEl=function()

{

    return m_el;

};

this.GetName=function()

{

    return m_name;

};

this.IsInitialized=function()

{

    return m_isInitialized;

};

this.GetNumColumns=function()

{

    return m_numColumns;

};

this.initialize=function(sh)

{

    Start.Page.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,sh);

    m_el.className="page";

    if(theApp.GetPreference(Start.Const.PrefPrefix+"numcolumns"))m_numColumns=parseInt(theApp.GetPreference(Start.Const.PrefPrefix+"numcolumns"),10);

};

Start.Page.registerBaseMethod(this,"initialize");

this.dispose=function(th)

{

    Start.Page.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,th);

    while(m_moduleList.length>0)

    {

        var o=m_moduleList.pop();

        o.m=null;

    }

};

Start.Page.registerBaseMethod(this,"dispose");

this.Activate=function(uh)

{

    m_el.className=uh?"page pageActive":"page";

    m_this.RenderOnlyNoActivate();

};

this.GetModules=function(vh,wh,xh)

{

    var arr=new Array();

    for(var i=0;

    i<m_moduleList.length;

    i++)

    {

        var m=m_moduleList[i].m;

        var add=false;

        if(!vh)add=true;

        else

        {

            if(vh==m.GetBindingType())

            {

                if(!wh)add=true;

                else

                {

                    if(wh==m.GetBinding())

                    {

                        if(!xh)add=true;

                        else

                        {

                            mParams=m.GetBindingParams();

                            var missingParam=false;

                            for(var p in xh)

                            {

                                if(mParams[p]!=xh[p])

                                {

                                    missingParam=true;

                                    break;

                                }

                            }

                            if(!missingParam)add=true;

                        }

                    }

                }

            }

        }

        if(add)arr.push(m);

    }

    return arr;

};

this.RenderOnlyNoActivate=function()

{

    if(!m_isInitialized)

    {

        m_this.RenderContent();

        m_isInitialized=true;

    }

};

this.AddModule=function(yh,zh,Ah,Bh,Ch,Dh,Eh,Fh,Gh,Hh,Ih)

{

    if(Fh==null&&m_columnEls.length>0)

    {

        var minHeight=m_columnEls[0].offsetHeight;

        Fh=0;

        for(var i=1;

        i<m_columnEls.length;

        i++)

        {

            if(m_columnEls[i].offsetHeight<minHeight)

            {

                minHeight=m_columnEls[i].offsetHeight;

                Fh=i;

            }

        }

    }

    if(Fh<m_columnEls.length)

    {

        var div=document.createElement("div");

        if(Gh||Hh==0)m_columnEls[Fh].insertAdjacentElement("afterBegin",div);

        else

        {

            if(Hh&&Hh<m_columnEls[Fh].childNodes.length)m_columnEls[Fh].insertBefore(div,m_columnEls[Fh].childNodes[Hh]);

            else m_columnEls[Fh].appendChild(div);

        }

        var m=Web.Bindings.attachElementBindingSync(div,Start.DashboardModule,m_this,

        {

            "title":yh?yh:"Unknown","link":zh,"isExpanded":Ah,"bindingType":Bh,"binding":Ch,"bindingParams":Dh,"page":m_this,"moduleId":Eh,"view":Ih

        }

        );

        if(Gh||Hh==0)m_moduleList.splice(0,0,

        {

            "col":Fh,"m":m

        }

        );

        else

        {

            if(Hh)m_moduleList.splice(Hh,0,

            {

                "col":Fh,"m":m

            }

            );

            else m_moduleList.push(

            {

                "col":Fh,"m":m

            }

            );

        }

        m_this.fire("onModuleAddedEvent",m);

        return m;

    }

};

this.RemoveModule=function(m)

{

    m_this.fire("onModuleRemovedEvent",m);

    Web.Bindings.removeBindings(m.GetEl());

    m.GetEl().removeNode(true);

    for(var i=0;

    i<m_moduleList.length;

    i++)

    {

        if(m_moduleList[i].m==m)

        {

            m_moduleList.removeAt(i);

            break;

        }

    }

};

this.RenderContent=function()

{

    m_colContainer=document.createElement("div");

    m_el.appendChild(m_colContainer);

    for(var i=0;

    i<m_numColumns;

    i++)

    {

        var col=document.createElement("div");

        col.className="column";

        col.style.width=100/m_numColumns+"%";

        m_colContainer.appendChild(col);

        col.style.display="none";

        col.style.display="";

        m_columnEls.push(col);

    }

    var clear=document.createElement("div");

    clear.className="columnClear";

    m_el.appendChild(clear);

    if(m_id!=0)Start.Store.FetchModulesForPage(m_id,Th);

};

this.ShowDefaultContent=function()

{

    Start.Store.FetchSidebarFolder("default.xml",bj);

};

this.FetchSidebarFolder=function(Jh)

{

    Start.Store.FetchSidebarFolder(Jh,Xh);

};

this.RepositionModule=function(Kh,m)

{

    for(var i=0;

    i<m_moduleList.length;

    i++)

    {

        if(m_moduleList[i].m==m)

        {

            m_moduleList.removeAt(i);

            break;

        }

    }

    var ctr=0;

    var added=false;

    for(var i=0;

    i<m_moduleList.length;

    i++)

    {

        if(m_moduleList[i].col==Kh.col)

        {

            if(ctr==Kh.pos)

            {

                m_moduleList.splice(i,0,

                {

                    "col":Kh.col,"m":m

                }

                );

                added=true;

                break;

            }

            ctr++;

        }

    }

    if(!added)m_moduleList.push(

    {

        "col":Kh.col,"m":m

    }

    );

    m_this.InvalidatePage();

};

this.InvalidatePage=function()

{

    var tmpColEls=new Array();

    for(var i=0;

    i<m_numColumns;

    i++)

    {

        var col=document.createElement("div");

        col.className="column";

        col.style.width=100/m_numColumns+"%";

        m_colContainer.appendChild(col);

        col.style.display="none";

        col.style.display="";

        tmpColEls.push(col);

    }

    for(var i=0;

    i<m_moduleList.length;

    i++)

    {

        tmpColEls[m_moduleList[i].col].appendChild(m_moduleList[i].m.GetEl());

    }

    while(m_columnEls.length>0)

    {

        var c=m_columnEls.pop();

        c.removeNode(true);

        c=null;

    }

    m_columnEls=tmpColEls;

};

this.PersistSortOrder=function()

{

    if(m_id!=0)

    {

        var arrCols=new Array();

        for(var i=0;

        i<m_numColumns;

        i++)

        {

            arrCols[i]=new Array();

        }

        for(var i=0;

        i<m_moduleList.length;

        i++)

        {

            arrCols[m_moduleList[i].col].push(m_moduleList[i].m.GetId());

        }

        if(m_sortOrderModuleId==null)

        {

function Lh(Mh,Nh,Oh)

{

    if(!Nh.error&&Oh)

    {

        m_sortOrderModuleId=Oh.id;

        Start.Store.UpdateModule(m_id,m_sortOrderModuleId,Start.Const.SortOrderKey3Col,"",Start.Util.ArrayToString(arrCols));

    }

}

Start.BookmarkService.AddBookmark(Start.Const.SortOrderKey3Col,"",m_id,null,Lh);

}

else Start.Store.UpdateModule(m_id,m_sortOrderModuleId,Start.Const.SortOrderKey3Col,"",Start.Util.ArrayToString(arrCols));

}

};

this.GetModulePositions=function()

{

var arrCols=new Array();

for(var i=0;

i<m_numColumns;

i++)

{

var arr=new Array();

var el=m_columnEls[i];

var p=Start.Util.GetElementOffset(el);

var c=

{

"x":p.x,"cx":el.offsetWidth

};

arrCols.push(

{

"column":c,"positions":arr

}

);

}

for(var i=0;

i<m_moduleList.length;

i++)

{

var el=m_moduleList[i].m.GetEl();

var p=Start.Util.GetElementOffset(el);

arrCols[m_moduleList[i].col].positions.push(

{

"m":m_moduleList[i].m,"x":p.x,"y":p.y,"cx":el.offsetWidth,"cy":el.offsetHeight

}

);

}

return arrCols;

};

this.SetColumns=function(Ph)

{

if(Ph!=m_numColumns)

{

m_numColumns=Ph;

var updateSortOrder=false;

for(var i=0;

i<m_moduleList.length;

i++)

{

if(m_moduleList[i].col>=m_numColumns)

{

    m_moduleList[i].col=m_numColumns-1;

    updateSortOrder=true;

}

}

m_this.InvalidatePage();

if(updateSortOrder)m_this.PersistSortOrder();

theApp.SetPreference(Start.Const.PrefPrefix+"numcolumns",m_numColumns);

}

};

this.IsDuplicateModule=function(Qh,Rh,Sh)

{

for(var i=0;

i<m_moduleList.length;

i++)

{

var m=m_moduleList[i].m;

if(m.GetBindingType()==Qh&&(m.GetBinding()==Rh||m.GetBinding()==Start.RssModule&&Rh==Start.RssReader))

{

if(m.GetBindingType()==Start.Const.BindingType.Internal)switch(m.GetBinding())

{

    case Start.RssModule:if(m.GetBindingParams().feedUrl==Sh.feedUrl)return true;

    break;

    case Start.AddContentModule:return true;

    break;

}

else

{

    var DupNotAList=new Array();

    DupNotAList[0]="custom/hiring.xml";

    DupNotAList[1]="custom/preview.xml";

    DupNotAList[2]="custom/clock.xml";

    for(var j=0;

    j<DupNotAList.length;

    j++)

    {

        if(m.GetBinding().substr(0,DupNotAList[j].length)==DupNotAList[j])return true;

    }

}

}

}

return false;

};

function Th(Uh,Vh,Wh)

{

    if(!Vh.error)

    {

        var arrCols=null;

        for(var i=0;

        i<Wh.bookmarks.length;

        i++)

        {

            if(Wh.bookmarks[i].name==Start.Const.SortOrderKey3Col)

            {

                m_sortOrderModuleId=Wh.bookmarks[i].id;

                arrCols=Start.Util.StringToArray(Wh.bookmarks[i].data);

                break;

            }

        }

        var sortedIdsOk=false;

        var found=false;

        if(arrCols)

        {

            for(var i=0;

            i<Wh.bookmarks.length;

            i++)

            {

                found=false;

                if(Wh.bookmarks[i].name==Start.Const.SortOrderKey||Wh.bookmarks[i].name==Start.Const.SortOrderKey3Col)continue;

                for(var j=0;

                j<arrCols.length&&!found;

                j++)

                {

                    for(var k=0;

                    k<arrCols[j].length;

                    k++)

                    {

                        if(Wh.bookmarks[i].id==arrCols[j][k])

                        {

                            found=true;

                            break;

                        }

                    }

                }

                if(!found)

                {

                    sortedIdsOk=false;

                    break;

                }

            }

            if(i==Wh.bookmarks.length)sortedIdsOk=true;

        }

        if(sortedIdsOk)for(var i=0;

        i<arrCols.length;

        i++)

        {

            for(var j=0;

            j<arrCols[i].length;

            j++)

            {

                for(var k=0;

                k<Wh.bookmarks.length;

                k++)

                {

                    if(arrCols[i][j]==Wh.bookmarks[k].id)

                    {

                        var data=Start.Util.StringToArray(Wh.bookmarks[k].data);

                        if(data)

                        {

                            var binding=data.binding;

                            if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

                            m_this.AddModule(Wh.bookmarks[k].name,Wh.bookmarks[k].url,data.isExpanded,data.type,binding,data.params,Wh.bookmarks[k].id,i,null,null,data.view);

                        }

                        break;

                    }

                }

            }

        }

        else for(var j=0;

        j<Wh.bookmarks.length;

        j++)

        {

            if(Wh.bookmarks[j].name==Start.Const.SortOrderKey||Wh.bookmarks[j].name==Start.Const.SortOrderKey3Col)continue;

            var data=Start.Util.StringToArray(Wh.bookmarks[j].data);

            if(data)

            {

                var binding=data.binding;

                if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

                m_this.AddModule(Wh.bookmarks[j].name,Wh.bookmarks[j].url,data.isExpanded,data.type,binding,data.params,Wh.bookmarks[j].id,j%m_numColumns,null,null,data.view);

            }

            else Start.BookmarkService.RemoveBookmark(Wh.bookmarks[j].id);

        }

    }

}

function Xh(Yh,Zh,aj)

{

    for(var i=0;

    i<aj.bookmarks.length;

    i++)

    {

        if(aj.bookmarks[i].data!="")data=Start.Util.StringToObject(aj.bookmarks[i].data);

        else

        {

            data=new Object();

            data.type=Start.Const.BindingType.Internal;

            data.binding="Start.RssModule";

            data.params=

            {

                "feedUrl":aj.bookmarks[i].url,"numItems":5

            };

            data.isExpanded=true;

            data.view=null;

        }

        if(data)

        {

            var binding=data.binding;

            if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

            var m=m_this.AddModule(aj.bookmarks[i].name,aj.bookmarks[i].url,data.isExpanded,data.type,binding,data.params,aj.bookmarks[i].id,i%m_numColumns,null,null,data.view);

        }

    }

}

function bj(cj,ej,gj)

{

    for(var i=0;

    i<gj.bookmarks.length;

    i++)

    {

        if(gj.bookmarks[i].data!="")data=Start.Util.StringToObject(gj.bookmarks[i].data);

        else

        {

            data=new Object();

            data.type=Start.Const.BindingType.Internal;

            data.binding="Start.RssModule";

            data.params=

            {

                "feedUrl":gj.bookmarks[i].url,"numItems":5

            };

            data.isExpanded=true;

            data.view=null;

        }

        if(data)

        {

            var binding=data.binding;

            if(data.type==Start.Const.BindingType.Internal)binding=Start.Util.StringToModule(data.binding);

            var m=m_this.AddModule(gj.bookmarks[i].name,gj.bookmarks[i].url,data.isExpanded,data.type,binding,data.params,gj.bookmarks[i].id,i%m_numColumns,null,null,data.view);

            m.Serialize();

        }

    }

}

};

Start.Page.registerClass("Start.Page","Web.Bindings.Base");

Start.Page.Events=Web.Enum.create("onModuleAddedEvent","onModuleRemovedEvent","onPageRemovedEvent");

registerNamespace("Start.Parser");

Start.Parser.ParseStartResponse=function(hj)

{

var root;

var error=false;

var code=-1;

var message="";

var data=null;

if(hj.status==200)

{

    root=Start.Parser._GetDocumentRoot(hj);

    if(root!=null)for(var i=0;

    i<root.childNodes.length;

    i++)

    {

        switch(root.childNodes[i].nodeName)

        {

            case "Code":code=parseInt(root.childNodes[i].text,10);

            break;

            case "Message":message=root.childNodes[i].text;

            break;

            case "Data":data=root.childNodes[i];

            break;

        }

    }

    if(code!=0)error=true;

}

else

{

    error=true;

    code=hj.status;

    message=hj.responseText;

}

return new Start.Struct.StartResponse(error,code,message,data);

};

Start.Parser.ParseEnumBookmarksResponse=function(jj)

{

var id=null;

var name=null;

var url=null;

var data=null;

var bookmarks=new Array();

var folders=new Array();

for(var i=0;

i<jj.childNodes.length;

i++)

{

    var ni=jj.childNodes[i];

    if(ni.nodeName=="Favorites")for(var j=0;

    j<ni.childNodes.length;

    j++)

    {

        var nj=ni.childNodes[j];

        if(nj.nodeName=="Bookmarks")for(var k=0;

        k<nj.childNodes.length;

        k++)

        {

            var nk=nj.childNodes[k];

            if(nk.nodeName=="Bookmark")

            {

                id=null;

                name=null;

                url=null;

                data=null;

                for(var item=0;

                item<nk.childNodes.length;

                item++)

                {

                    var nl=nk.childNodes[item];

                    switch(nl.nodeName)

                    {

                        case "Id":id=nl.text;

                        break;

                        case "Name":name=nl.text;

                        var locName=window[nl.getAttribute("resourceID")];

                        if(null!=locName)name=locName;

                        break;

                        case "Url":url=nl.text;

                        break;

                        case "ClientData":data=nl.text;

                        break;

                    }

                }

                if(id!=null&&name!=null&&url!=null)bookmarks[bookmarks.length]=new Start.Struct.Bookmark.Item(name,id,url,data);

            }

        }

        else

        {

            if(nj.nodeName=="BookmarkFolders")for(var k=0;

            k<nj.childNodes.length;

            k++)

            {

                var nk=nj.childNodes[k];

                if(nk.nodeName=="BookmarkFolder")

                {

                    id=null;

                    name=null;

                    for(var item=0;

                    item<nk.childNodes.length;

                    item++)

                    {

                        var nl=nk.childNodes[item];

                        switch(nl.nodeName)

                        {

                            case "Id":id=nl.text;

                            break;

                            case "Name":name=nl.text;

                            var locName=window[nl.getAttribute("resourceID")];

                            if(null!=locName)name=locName;

                            break;

                        }

                    }

                    if(id!=null&&name!=null)folders[folders.length]=new Start.Struct.Bookmark.Folder(name,id);

                }

            }

        }

    }

}

return new Start.Struct.Bookmark.Collection(folders,bookmarks);

};

Start.Parser.ParseAddBookmarkFolderResponse=function(kj)

{

var id=null;

var name=null;

var folder=null;

for(var i=0;

i<kj.childNodes.length;

i++)

{

    var ni=kj.childNodes[i];

    if(ni.nodeName=="BookmarkFolder")

    {

        id=null;

        name=null;

        for(var item=0;

        item<ni.childNodes.length;

        item++)

        {

            var nj=ni.childNodes[item];

            switch(nj.nodeName)

            {

                case "Id":id=nj.text;

                break;

                case "Name":name=nj.text;

                break;

            }

        }

        if(id!=null&&name!=null)folder=new Start.Struct.Bookmark.Folder(name,id);

    }

}

return folder;

};

Start.Parser.ParseAddBookmarkResponse=function(lj)

{

var id=null;

var name=null;

var url=null;

var data=null;

var bookmark=null;

for(var i=0;

i<lj.childNodes.length;

i++)

{

    var ni=lj.childNodes[i];

    if(ni.nodeName=="Bookmark")

    {

        id=null;

        name=null;

        url=null;

        data=null;

        for(var item=0;

        item<ni.childNodes.length;

        item++)

        {

            var nj=ni.childNodes[item];

            switch(nj.nodeName)

            {

                case "Id":id=nj.text;

                break;

                case "Name":name=nj.text;

                break;

                case "Url":url=nj.text;

                break;

                case "ClientData":data=nj.text;

                break;

            }

        }

        if(id!=null&&name!=null&&url!=null&&data!=null)

        {

            bookmark=new Start.Struct.Bookmark.Item(name,id,url,data);

            break;

        }

    }

}

return bookmark;

};

Start.Parser.ParseRssResponse=function(mj,oj)

{

var root=oj?mj:Start.Parser._GetDocumentRoot(mj);

if(root)

{

    var channels=new Array();

    for(var i=0;

    i<root.childNodes.length;

    i++)

    {

        var ni=root.childNodes[i];

        if(ni.nodeName=="channel")

        {

            var channelTitle;

            var channelTitleResourceID;

            var channelLink;

            var channelDescription;

            var channelAttribs=new Array();

            var bindingType;

            var bindingDocs;

            var bindingWebMaster;

            var image;

            var bindingBehavior;

            var items=new Array();

            var a=ni.attributes;

            for(var j=0;

            j<a.length;

            j++)

            {

                channelAttribs[a[j].nodeName]=a[j].nodeValue;

            }

            for(var j=0;

            j<ni.childNodes.length;

            j++)

            {

                var nj=ni.childNodes[j];

                switch(nj.nodeName)

                {

                    case "title":channelTitle=nj.text;

                    channelTitleResourceID=nj.getAttribute("resourceID");

                    break;

                    case "link":channelLink=nj.text;

                    break;

                    case "description":channelDescription=nj.text;

                    break;

                    case "class":if(root.tagName=="gadget")bindingType=nj.text;

                    break;

                    case "binding:type":bindingType=nj.text;

                    break;

                    case "binding:manifest":if(nj.getAttribute("environment").toLowerCase()=="start")bindingBehavior=nj.text;

                    break;

                    case "docs":bindingDocs=nj.text;

                    break;

                    case "image":image=new Object();

                    for(var k=0;

                    k<nj.childNodes.length;

                    k++)

                    {

                        var nk=nj.childNodes[k];

                        switch(nk.nodeName)

                        {

                            case "url":image.url=nk.text;

                            break;

                            case "title":image.title=nk.text;

                            break;

                            case "link":image.link=nk.text;

                            break;

                            case "width":image.width=nk.text;

                            break;

                            case "height":image.height=nk.text;

                            break;

                        }

                    }

                    break;

                    case "item":var title;

                    var description;

                    var link;

                    var pubDate;

                    var guid;

                    var source;

                    var imgLink;

                    var other=null;

                    var enclosure;

                    for(var k=0;

                    k<nj.childNodes.length;

                    k++)

                    {

                        var nk=nj.childNodes[k];

                        switch(nk.nodeName)

                        {

                            case "title":title=nk.text;

                            break;

                            case "description":description=nk.text;

                            break;

                            case "link":link=new String(nk.text);

                            link.type=nk.getAttribute("binding:type")||nk.getAttribute("type");

                            break;

                            case "pubDate":pubDate=nk.text;

                            break;

                            case "guid":guid=nk.text;

                            break;

                            case "source":source=nk.text;

                            source.url=nk.getAttribute("url");

                            break;

                            case "enclosure":enclosure=new String(nk.getAttribute("url"));

                            enclosure.encUrl=nk.getAttribute("url");

                            enclosure.encLength=nk.getAttribute("length");

                            enclosure.encType=nk.getAttribute("type");

                            break;

                            case "other":other=new Object();

                            for(var l=0;

                            l<nk.childNodes.length;

                            l++)

                            {

                                var nl=nk.childNodes[l];

                                other[nl.nodeName]=nl.text;

                            }

                            break;

                        }

                    }

                    if(title!=null&&title.substring(0,4)=="ADV:")continue;

                    if(!title)title="Default Title";

                    if(!link&&guid&&guid.substring(0,7)=="http://")link=guid;

                    items[items.length]=new Start.Struct.Rss.Item(title,description,link,pubDate,guid,source,imgLink,enclosure,other);

                    break;

                }

            }

            channels[channels.length]=new Start.Struct.Rss.Channel(channelTitle,channelTitleResourceID,channelLink,channelDescription,channelAttribs,items,image,

            {

                "type":bindingType,"manifest":bindingBehavior

            }

            );

        }

    }

    return new Start.Struct.Rss.Collection(channels);

}

return null;

};

Start.Parser.ParseEnumRssFeedsResponse=function(pj)

{

var visArr=new Array();

for(var i=0;

i<pj.childNodes.length;

i++)

{

    var ni=pj.childNodes[i];

    if(ni.nodeName=="ArrayOfRssFeed")for(var j=0;

    j<ni.childNodes.length;

    j++)

    {

        var nj=ni.childNodes[j];

        if(nj.nodeName=="RssFeed")

        {

            var vis=new Object();

            vis.url=null;

            vis.mimeType=null;

            vis.title=null;

            for(var k=0;

            k<nj.childNodes.length;

            k++)

            {

                var nk=nj.childNodes[k];

                switch(nk.nodeName)

                {

                    case "Url":vis.url=nk.text;

                    break;

                    case "MimeType":vis.mimeType=nk.text;

                    break;

                    case "Title":vis.title=nk.text;

                    break;

                }

            }

            if(vis.url&&vis.mimeType&&vis.title)visArr[visArr.length]=vis;

        }

    }

}

return visArr;

};

Start.Parser.ParseGetPreferencesResponse=function(qj)

{

var arr=new Array();

for(var i=0;

i<qj.childNodes.length;

i++)

{

    var ni=qj.childNodes[i];

    if(ni.nodeName=="ArrayOfPreference")for(var j=0;

    j<ni.childNodes.length;

    j++)

    {

        var nj=ni.childNodes[j];

        if(nj.nodeName=="Preference")

        {

            var key=null;

            var val=null;

            for(var k=0;

            k<nj.childNodes.length;

            k++)

            {

                var nk=nj.childNodes[k];

                switch(nk.nodeName)

                {

                    case "Key":key=nk.text;

                    break;

                    case "Value":val=nk.text;

                    break;

                }

            }

            if(key&&val)arr[key]=val;

        }

    }

}

return arr;

};

Start.Parser._GetDocumentRoot=function(rj)

{

var root=null;

if(rj.responseText.length==4)return null;

if(rj.responseXML.xml=="")try

{

    var doc=new ActiveXObject("Microsoft.XMLDOM");

    doc.loadXML(rj.responseText);

    root=doc.documentElement;

}

catch(e)

{

    root=null;

}

else try

{

    root=rj.responseXML.documentElement;

}

catch(e)

{

    root=null;

}

return root;

};

registerNamespace("Start.PopularFeedsGroup");

Start.PopularFeedsGroup=function(sj,tj,uj)

{

Start.PopularFeedsGroup.initializeBase(this,arguments);

var m_el=sj;

var m_this=this;

this.initialize=function(vj)

{

    Start.PopularFeedsGroup.getBaseMethod(this,"initialize","Start.Group").call(this,vj);

};

this.dispose=function(wj)

{

    Start.PopularFeedsGroup.getBaseMethod(this,"dispose","Start.Group").call(this,wj);

};

this.RenderContent=function()

{

    m_this.GetBodyEl().innerText=L_Loading_Text;

    Start.Store.FetchPopularFeeds(xj);

};

function xj(yj,zj,Aj)

{

    m_this.GetBodyEl().innerHTML="";

    if(!zj.error)

    {

        for(var i=0;

        i<Aj.folders.length;

        i++)

        {

            m_this.AddFolder(Aj.folders[i],i==0,null,false);

        }

        for(var i=0;

        i<Aj.bookmarks.length&&i<10;

        i++)

        {

            m_this.AddItem(Aj.bookmarks[i],false);

        }

    }

}

};

Start.PopularFeedsGroup.registerClass("Start.PopularFeedsGroup","Start.Group");

registerNamespace("Start.PopupModule");

Start.PopupModule=function(Bj,Cj,Dj)

{

Start.PopupModule.initializeBase(this,arguments);

var m_el=Bj;

var m_this=this;

var m_title=Cj.title;

var m_link=Cj.link;

var m_bindingType=Cj.bindingType;

var m_binding=Cj.binding;

var m_bindingParams=Cj.bindingParams;

var m_titleEl=null;

var m_titleBarContainer=null;

var m_bodyContainer=null;

var m_iconEl=null;

var m_closeBtn=null;

var m_addText=null;

var m_bindingManager;

this.GetTitle=function()

{

    return m_title;

};

this.GetLink=function()

{

    return m_link;

};

this.GetEl=function()

{

    return m_el;

};

this.GetBindingParams=function()

{

    return m_bindingParams;

};

this.GetTitleBarEl=function()

{

    return m_titleBarContainer;

};

this.initialize=function(Ej)

{

    Start.PopupModule.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Ej);

    m_titleBarContainer=document.createElement("div");

    m_titleBarContainer.className="rssReaderTitleBar";

    m_el.appendChild(m_titleBarContainer);

    m_bodyContainer=document.createElement("div");

    m_bodyContainer.style.display="none";

    m_bodyContainer.style.display="";

    m_bodyContainer.className="rssReaderBody";

    m_bodyContainer.innerText=L_Loading_Text;

    m_el.appendChild(m_bodyContainer);

    m_bindingManager=new Start.BindingManager.Downloader(m_bodyContainer,this);

    m_closeBtn=document.createElement("div");

    m_closeBtn.className="moduleKillBtn";

    m_closeBtn.title=L_CloseWindow_Text;

    m_closeBtn.attachEvent("onmousedown",Oj);

    m_titleBarContainer.appendChild(m_closeBtn);

    var page=theApp.GetSheet().GetCurrentPage();

    m_addText=document.createElement("div");

    m_addText.innerText=L_AddToPage_Text;

    if(page&&!page.IsDuplicateModule(m_bindingType,m_binding,m_bindingParams))

    {

        m_addText.title=L_AddToPageTip_Text;

        m_addText.className="rssReaderPinText";

        m_addText.attachEvent("onclick",Pj);

    }

    else

    {

        m_addText.title=L_AddModuleHdrDup_Text;

        m_addText.className="rssReaderInactivePinText";

    }

    m_titleBarContainer.appendChild(m_addText);

    m_iconEl=document.createElement("span");

    m_iconEl.className="moduleIcon";

    m_titleEl=document.createElement("a");

    if(m_link)m_titleEl.href=m_link;

    m_titleEl.target="new";

    m_titleEl.className="rssReaderTitle";

    m_titleEl.innerText=m_title;

    m_titleBarContainer.appendChild(m_iconEl);

    m_titleBarContainer.appendChild(m_titleEl);

    document.attachEvent("onkeydown",Qj);

    m_bodyContainer.innerText=L_Loading_Text;

    if(m_bindingType==Start.Const.BindingType.External)m_bindingManager.RequestDefinition(m_binding,m_bindingParams);

    else

    {

        var params=new Object();

        for(var i in m_bindingParams)

        {

            params[i]=m_bindingParams[i];

        }

        params.module=m_this;

        if(params.feedUrl)m_bindingManager.RequestDefinition(params.feedUrl,params,m_binding,Fj);

        else Web.Bindings.attachElementBindingSync(m_bodyContainer,m_binding,m_this,params);

    }

};

function Fj(Gj)

{

    if(!Gj)Nj();

}

this.dispose=function(Hj)

{

    Start.PopupModule.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Hj);

    if(m_closeBtn)

    {

        m_closeBtn.detachEvent("onmousedown",Oj);

        m_closeBtn=null;

    }

    if(m_addText)

    {

        m_addText.detachEvent("onclick",Pj);

        m_addText=null;

    }

    m_bindingManager.dispose();

    m_bindingManager=null;

    document.detachEvent("onkeydown",Qj);

};

this.Resize=function(Ij)

{

    if(Ij>0)m_el.style.width=Ij+"px";

};

this.SetTitleText=function(Jj)

{

    m_titleEl.innerText=Jj;

};

this.SetTitleLink=function(Kj)

{

    m_titleEl.href=Kj;

};

function Lj(Mj)

{

    if(Mj&&!Mj.blnError)

    {

        var el=Mj.cloneNode(true);

        el.height="16";

        el.width="16";

        m_iconEl.appendChild(el);

    }

}

function Nj()

{

    m_this.fire("onReaderClosedEvent");

}

function Oj()

{

    Nj();

}

function Pj()

{

    var binding=m_binding;

    if(m_bindingType==Start.Const.BindingType.Internal&&m_binding==Start.RssReader)binding=Start.RssModule;

    var page=theApp.GetSheet().GetCurrentPage();

    if(page)

    {

        var m=page.AddModule(m_title,m_link,true,m_bindingType,binding,m_bindingParams,null,0,true);

        if(m)m.Serialize(true);

    }

    m_this.fire("onReaderClosedEvent");

}

function Qj(Rj)

{

    if(Rj.keyCode==27)Nj();

}

var KillBtn=function(Sj,Tj,Uj)

{

    KillBtn.initializeBase(this,arguments);

    var m_el=Sj;

    var m_this=this;

    this.initialize=function(Vj)

    {

        KillBtn.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Vj);

        m_el.title=L_RemoveModule_Text;

        m_el.className="moduleKillBtn";

        m_el.attachEvent("onclick",Xj);

    };

    this.dispose=function(Wj)

    {

        KillBtn.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Wj);

        m_el.detachEvent("onclick",Xj);

        m_el=null;

    };

function Xj()

{

    m_this.fire("onClickedEvent");

    return false;

}

};

KillBtn.registerClass("KillBtn","Web.Bindings.Base");

KillBtn.Events=Web.Enum.create("onClickedEvent");

};

Start.PopupModule.registerClass("Start.PopupModule","Web.Bindings.Base");

Start.PopupModule.Events=Web.Enum.create("onReaderClosedEvent");

registerNamespace("Start.RecentSearchesGroup");

Start.RecentSearchesGroup=function(Yj,Zj,ak)

{

Start.RecentSearchesGroup.initializeBase(this,arguments);

var m_el=Yj;

var m_this=this;

this.initialize=function(bk)

{

Start.RecentSearchesGroup.getBaseMethod(this,"initialize","Start.Group").call(this,bk);

};

this.dispose=function(ck)

{

Start.RecentSearchesGroup.getBaseMethod(this,"dispose","Start.Group").call(this,ck);

var list=m_this.GetItemList();

for(var i=0;

i<list.length;

i++)

{

    list[i].detachEvent("onItemRemoved",kk);

}

};

this.RenderContent=function()

{

m_this.GetBodyEl().innerText=L_Loading_Text;

Start.Store.FetchRecentSearches(nk);

};

this.AddItem=function(ek,gk,hk,jk)

{

if(0==m_this.GetItemList().length)m_this.GetBodyEl().innerHTML="";

var item=Start.RecentSearchesGroup.getBaseMethod(this,"AddItem","Start.Group").call(this,ek,gk,hk,jk);

if(item)item.attachEvent("onItemRemoved",kk);

};

function kk(lk)

{

    lk.srcBinding.detachEvent("onItemRemoved",kk);

    if(0==m_this.GetItemList().length)mk();

}

function mk()

{

    m_this.GetBodyEl().innerHTML=L_NoRecentSearches_Text;

}

function nk(ok,pk,qk)

{

    m_this.GetBodyEl().innerHTML="";

    if(!pk.error)

    {

        if(qk.bookmarks.length==0)mk();

        else for(var i=0;

        i<qk.bookmarks.length;

        i++)

        {

            m_this.AddItem(qk.bookmarks[i],true);

        }

    }

    else m_this.GetBodyEl().innerHTML=L_Error_Text;

}

};



Start.RecentSearchesGroup.registerClass("Start.RecentSearchesGroup","Start.Group");

registerNamespace("Start.RssHeadline");



Start.RssHeadline=function(rk,sk,tk)

{

Start.RssHeadline.initializeBase(this,arguments);

var m_el=rk;

var m_this=this;

var m_headlineLink=null;

var m_headline=sk.headline;

var m_isExpanded=sk.isExpanded;

var m_enclosure=sk.enclosure;

this.GetLinkElement=function()

{

    return m_headlineLink;

};

this.initialize=function(uk)

{

    Start.RssHeadline.getBaseMethod(this,"initialize","Start.ExpandableContainer").call(this,uk);

    m_el.className="rssHeadlineContainer";

    m_this.GetTitleBarEl().className="rssHeadlineTitleBar";

    m_this.GetBodyEl().className="rssHeadlineDescription";

    m_headlineLink=document.createElement("a");

    m_this.GetTitleBarEl().appendChild(m_headlineLink);

    if(m_headline.link)m_headlineLink.href="b.htm?"+m_headline.link.replace(/\?/g,"_");

    m_headlineLink.target="naviframe";

    m_headlineLink.className="rssHeadlineTitle";

    m_headlineLink.innerHTML=m_headline.title;

    m_headlineLink.attachEvent("onclick",wk);

    if(m_headline.pubDate!="")

    {

        str=Start.Util.HelperHoursAgo(m_headline.pubDate);

        var ago=document.createElement("span");

        ago.className="newsbotAge";

        ago.innerHTML=str;

        m_this.GetTitleBarEl().appendChild(ago);

    }

    m_this.SetExpandCollapseButton(m_headlineLink,null,null);

    if(m_isExpanded)m_headlineLink.click();

};

this.dispose=function(vk)

{

    Start.RssHeadline.getBaseMethod(this,"dispose","Start.ExpandableContainer").call(this,vk);

    m_headlineLink.detachEvent("onclick",wk);

};

function wk(xk)

{

    m_this.fire("onHeadlineClicked");

}

this.RenderContent=function()

{

    var str="";

    if(null!=m_headline.description)str=m_headline.description;

    if(m_headline.enclosure&&m_headline.enclosure.encType)

    {

        if(str!="")str+="<br>";

        str+="<embed autostart=false type='"+m_headline.enclosure.encType+"' src='"+m_headline.enclosure+"'></embed>";

        str+="<br>"+m_headline.enclosure;

        if(m_headline.enclosure.encLength&&m_headline.enclosure.encLength>0)str+=" ("+m_headline.enclosure.encLength+" bytes)";

    }

    if(m_headline.link)str+=" <a style='color:gray' target='new' href='"+m_headline.link+"'>"+L_MoreLink_Text+"&nbsp;    &raquo;    </a>";

    m_this.GetBodyEl().innerHTML=str;

};

};



Start.RssHeadline.registerClass("Start.RssHeadline","Start.ExpandableContainer");

Start.RssHeadline.Events=Web.Enum.create("onHeadlineClicked");

registerNamespace("Start.RssModule");

Start.RssModule=function(yk,zk,Ak)

{

Start.RssModule.initializeBase(this,arguments);

var m_el=yk;

var m_this=this;

var m_headlineList=null;

var m_feedUrl=zk.feedUrl;

var m_numItems=zk.numItems;

var m_module=zk.module;

var m_rssInfo=zk.feed;

var m_objTimer;

var m_isLoaded=false;

var m_elItems=new Array();

var m_itemBindings=new Array();

var m_toolMore=null;

var m_toolLess=null;

this.GetFeedUrl=function()

{

    return m_feedUrl;

};

this.GetRSS=function()

{

    return m_rssInfo;

};

this.GetUnreadCount=function()

{

    var unread=0;

    for(var i=0;

    i<m_elItems.length;

    i++)

    {

        var item=m_elItems[i];

        var link=item.getElementsByTagName("a")[0];

        if(link.currentStyle.color!="gray")unread++;

    }

    return unread;

};

this.SetUnreadCountInTitle=function()

{

    if(!Web.Browser.isMozilla())

    {

        var unread=m_this.GetUnreadCount();

        var title=m_rssInfo.channels[0].title;

        if(0<unread)title+=" ("+m_this.GetUnreadCount()+")";

        m_module.SetTitleText(title);

    }

};

this.initialize=function(Bk)

{

    Start.RssModule.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Bk);

    m_el.innerText=L_Loading_Text;

    if(!m_rssInfo)Gk();

    else Jk();

    m_module.GetEl().attachEvent("onmouseover",Qk);

    m_module.GetEl().attachEvent("onmouseout",Rk);

};

this.dispose=function(Ck)

{

    Kk(false);

    for(var i=0;

    i<m_itemBindings.length;

    i++)

    {

        m_itemBindings[i].detachEvent("onHeadlineClicked",Dk);

        m_itemBindings[i]=null;

    }

    if(m_toolLess)m_toolLess.detachEvent("onmousedown",Pk);

    if(m_toolMore)m_toolMore.detachEvent("onmousedown",Ok);

    m_module.GetEl().detachEvent("onmouseover",Qk);

    m_module.GetEl().detachEvent("onmouseout",Rk);

    clearTimeout(m_objTimer);

    m_toolMore=m_toolLess=m_module=m_el=null;

    Start.RssModule.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Ck);

};

function Dk(Ek)

{

    m_this.MarkHeadlineAsVisited(Ek.srcBinding.GetLinkElement().href);

}

this.MarkHeadlineAsVisited=function(Fk)

{

    for(var i=0;

    i<m_elItems.length;

    i++)

    {

        var item=m_elItems[i];

        var link=item.getElementsByTagName("a")[0];

        if(link.href==Fk)link.className=link.className+" visited";

    }

    m_this.SetUnreadCountInTitle();

};

function Gk()

{

    var n=(Math.floor(m_numItems/5)+1)*5;

    var r=Web.Network.createRequest(Web.Network.Type.XML,m_feedUrl,

    {

        "numItems":n

    }

    ,Hk);

    r.execute();

}

function Hk(Ik)

{

    m_rssInfo=Start.Parser.ParseRssResponse(Ik);

    if(m_rssInfo)Jk();

    else m_el.innerHTML=L_Error_Text;

    if(Start.RssModule.DefaultRefresh>0)m_objTimer=setTimeout(Gk,Start.RssModule.DefaultRefresh*60*1000);

}

function Jk()

{

    if(m_rssInfo.channels.length>0)

    {

        Mk(m_rssInfo.channels[0]);

        m_this.fire("onrssupdate",m_rssInfo);

    }

}

function Kk(Lk)

{

    while(m_elItems.length>0)

    {

        var el=m_elItems.pop();

        Web.Bindings.removeBindings(el);

        if(Lk)el.removeNode(true);

        el=null;

    }

}

function Mk(Nk)

{

    if(!m_isLoaded)

    {

        if(Nk.link)m_module.SetTitleLink(Nk.link);

        if(Nk.title)m_module.SetTitleText(Nk.title);

        m_isLoaded=true;

    }

    else Kk(true);

    m_el.innerHTML="";

    if(Nk.items.length>0)

    {

        var fMax=false;

        if(m_numItems>Nk.items.length)

        {

            m_numItems=Nk.items.length;

            fMax=true;

        }

        m_toolMore=document.createElement("span");

        m_toolMore.className=fMax?"toolMoreLess toolMoreLessInactive":"toolMoreLess";

        if(!fMax)m_toolMore.attachEvent("onmousedown",Ok);

        m_toolMore.title=L_PlusTooltip_Text;

        m_toolMore.innerText="+";

        m_el.appendChild(m_toolMore);

        m_toolLess=document.createElement("span");

        m_toolLess.className=m_numItems==1?"toolMoreLess toolMoreLessInactive":"toolMoreLess";

        if(m_numItems>1)m_toolLess.attachEvent("onmousedown",Pk);

        m_toolLess.title=L_MinusTooltip_Text;

        m_toolLess.innerText="-";

        m_el.appendChild(m_toolLess);

        Rk();

        m_headlineList=document.createElement("ul");

        m_headlineList.className="rssList";

        m_el.appendChild(m_headlineList);

        for(var i=0;

        i<Nk.items.length&&i<m_numItems;

        i++)

        {

            var li=document.createElement("li");

            m_headlineList.appendChild(li);

            var item=Web.Bindings.attachElementBindingSync(li,Start.RssModule.HeadlineItem,m_this,

            {

                "channelTitle":Nk.title,"title":Nk.items[i].title,"enclosure":Nk.items[i].enclosure,"feedUrl":m_feedUrl,"numItems":m_numItems,"desc":Nk.items[i].description,"link":Nk.items[i].link

            }

            );

            m_elItems.push(li);

            m_itemBindings.push(item);

            item.attachEvent("onHeadlineClicked",Dk);

        }

        var div=document.createElement("div");

        div.style.clear="both";

        m_el.appendChild(div);

        m_this.SetUnreadCountInTitle();

    }

}

function Ok()

{

    if(m_numItems<=2)m_numItems+=1;

    else

    {

        if(m_numItems==3)m_numItems+=2;

        else m_numItems+=3;

    }

    if(m_numItems>50)m_numItems=50;

    Gk();

    var clientData="{type:1,binding:'Start.RssModule',params:{feedUrl:'"+m_feedUrl+"',numItems:"+m_numItems+"},isExpanded:true,view:'"+m_module.GetView()+"'}";

    Start.BookmarkService.UpdateBookmark(m_module.GetId(),m_module.GetTitle(),m_module.GetLink(),Start.Const.MyPagesFolderIdStr,clientData);

    m_toolMore.className="toolMoreLess toolMoreLessInactive";

}

function Pk()

{

    if(m_numItems>5)m_numItems-=3;

    else

    {

        if(m_numItems==5)m_numItems-=2;

        else m_numItems-=1;

    }

    if(m_numItems<1)m_numItems=1;

    Gk();

    var clientData="{type:1,binding:'Start.RssModule',params:{feedUrl:'"+m_feedUrl+"',numItems:"+m_numItems+"},isExpanded:true,view:'"+m_module.GetView()+"'}";

    Start.BookmarkService.UpdateBookmark(m_module.GetId(),m_module.GetTitle(),m_module.GetLink(),Start.Const.MyPagesFolderIdStr,clientData);

}

function Qk()

{

    if(m_toolMore)m_toolMore.style.visibility="visible";

    if(m_toolLess)m_toolLess.style.visibility="visible";

}

function Rk()

{

    if(m_toolMore)m_toolMore.style.visibility="hidden";

    if(m_toolLess)m_toolLess.style.visibility="hidden";

}

};

Start.RssModule.registerClass("Start.RssModule","Web.Bindings.Base");

Start.RssModule.Events=Web.Enum.create("onrssupdate");

Start.RssModule.DefaultRefresh=15;

Start.RssModule.HeadlineItem=function(Sk,Tk,Uk)

{

Start.RssModule.HeadlineItem.initializeBase(this,arguments);

var m_el=Sk;

var m_this=this;

var m_channelTitle=Tk.channelTitle;

var m_title=Tk.title;

var m_feedUrl=Tk.feedUrl;

var m_numItems=Tk.numItems;

var m_desc=Tk.desc;

var m_link=Tk.link;

var m_enclosure=Tk.enclosure;

var m_className=Tk.className;

var m_tEl=null;

var m_articleLink=null;

this.GetLinkElement=function()

{

    return m_tEl;

};

this.initialize=function(Vk)

{

    Start.RssModule.HeadlineItem.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Vk);

    m_tEl=document.createElement("a");

    m_el.appendChild(m_tEl);

    m_tEl.target="naviframe";

    var link="b.htm?";

    if(null!=m_link)link+=m_link.replace(/\?/g,"_");

    m_tEl.href=link;

    m_tEl.className=m_className?m_className:"rssHeadlineTitle";

    m_tEl.innerHTML=m_title;

    if(m_desc&&m_desc.length<400)m_tEl.title=m_desc;

    m_tEl.attachEvent("onmouseup",Zk);

    if(m_link)

    {

        var span=document.createElement("span");

        m_articleLink=document.createElement("a");

        m_articleLink.target="naviframe";

        m_articleLink.attachEvent("onclick",Xk);

        m_articleLink.innerHTML="&raquo;        ";

        m_articleLink.href="b.htm?"+m_link.replace(/\?/g,"_");

        span.innerHTML="&nbsp;        &nbsp;        ";

        span.appendChild(m_articleLink);

        m_articleLink.title=L_OpenNewBrowser_Text;

        m_el.appendChild(span);

    }

};

this.dispose=function(Wk)

{

    Start.RssModule.HeadlineItem.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Wk);

    m_tEl.detachEvent("onmouseup",Zk);

    if(m_link)m_articleLink.detachEvent("onclick",Xk);

    m_tEl=m_el=m_articleLink=m_link=null;

};

function Xk(Yk)

{

    m_this.fire("onHeadlineClicked");

    window.open(m_link,"new");

}

function Zk()

{

    var params=

    {

        "feedUrl":m_feedUrl,"numItems":m_numItems?m_numItems:5,"headlineToExpand":m_title

    };

    theApp.DisplayPopupModule(m_channelTitle,null,Start.Const.BindingType.Internal,Start.RssReader,params);

    window.event.cancelBubble=true;

    m_this.fire("onHeadlineClicked");

}

};

Start.RssModule.HeadlineItem.registerClass("Start.RssModule.HeadlineItem","Web.Bindings.Base");

Start.RssModule.HeadlineItem.Events=Web.Enum.create("onHeadlineClicked");

registerNamespace("Start.RssReader");

Start.RssReader=function(al,bl,cl)

{

Start.RssReader.initializeBase(this,arguments);

var m_el=al;

var m_this=this;

var m_secure=false;

var m_feedUrl=bl.feedUrl;

var m_numItems=bl.numItems;

var m_module=bl.module;

var m_headlineToExpand=bl.headlineToExpand;

var m_headlineList=null;

var m_headlinesEl=null;

var m_rssInfo=bl.feed;

var m_toolExpand=null;

var m_toolCollapse=null;

var m_headlines=new Array();

this.initialize=function(el)

{

    Start.RssReader.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,el);

    m_el.innerHTML="";

    var div=document.createElement("div");

    div.className="rssReaderToolbar";

    m_el.appendChild(div);

    div.appendChild(document.createTextNode("["));

    m_toolCollapse=document.createElement("span");

    m_toolCollapse.innerText=L_Collapse_Text;

    div.appendChild(m_toolCollapse);

    div.appendChild(document.createTextNode(" | "));

    m_toolExpand=document.createElement("span");

    m_toolExpand.innerText=L_Expand_Text;

    div.appendChild(m_toolExpand);

    div.appendChild(document.createTextNode("]"));

    m_headlinesEl=document.createElement("div");

    m_headlinesEl.className="rssReaderHeadlines";

    m_el.appendChild(m_headlinesEl);

    m_headlinesEl.innerHTML=L_Loading_Text+"<br><br><br><br><br>";

    if(!m_rssInfo)

    {

        var r=Web.Network.createRequest(Web.Network.Type.XML,m_feedUrl,

        {

            "numItems":m_numItems

        }

        ,jl);

        r.execute();

    }

    else ll();

};

this.dispose=function(gl)

{

    Start.RssReader.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,gl);

    m_toolExpand.detachEvent("onmousedown",ql);

    m_toolCollapse.detachEvent("onmousedown",rl);

    for(var i=0;

    i<m_headlines.length;

    i++)

    {

        m_headlines[i].detachEvent("onHeadlineClicked",ol);

    }

};

this.Resize=function(hl)

{

    m_el.style.width=hl+"px";

};

function jl(kl)

{

    m_rssInfo=Start.Parser.ParseRssResponse(kl);

    if(m_rssInfo)ll();

    else m_headlinesEl.innerHTML=L_Error_Text;

}

function ll()

{

    if(m_rssInfo.channels.length>0)

    {

        ml(m_rssInfo.channels[0]);

        Start.StartService.TrackEvent(m_feedUrl);

        sl();

    }

}

function ml(nl)

{

    m_headlinesEl.innerHTML="";

    if(nl.link)m_module.SetTitleLink(nl.link);

    if(nl.title)m_module.SetTitleText(nl.title);

    if(nl.items.length>0)

    {

        var expandId=0;

        if(m_headlineToExpand)for(var i=0;

        i<nl.items.length;

        i++)

        {

            if(nl.items[i].title==m_headlineToExpand)

            {

                expandId=i;

                break;

            }

        }

        m_headlineList=document.createElement("ul");

        m_headlineList.className="rssList";

        m_headlinesEl.appendChild(m_headlineList);

        for(var i=0;

        i<nl.items.length;

        i++)

        {

            var li=document.createElement("li");

            m_headlineList.appendChild(li);

            var item=Web.Bindings.attachElementBindingSync(li,Start.RssHeadline,m_this,

            {

                "headline":nl.items[i],"isExpanded":i==expandId

            }

            );

            item.attachEvent("onHeadlineClicked",ol);

            m_headlines.push(item);

        }

        var div=document.createElement("div");

        div.style.clear="both";

        m_el.appendChild(div);

    }

}

function ol(pl)

{

    var page=theApp.GetSheet().GetCurrentPage();

    if(page)

    {

        var mods=page.GetModules(Start.Const.BindingType.Internal,Start.RssModule,

        {

            "feedUrl":m_feedUrl

        }

        );

        for(var i=0;

        i<mods.length;

        i++)

        {

            var mod=mods[i].GetContentModule();

            mod.MarkHeadlineAsVisited(pl.srcBinding.GetLinkElement().href);

        }

    }

}

function ql()

{

    for(var i=0;

    i<m_headlines.length;

    i++)

    {

        m_headlines[i].Expand();

        m_headlines[i].GetLinkElement().click();

    }

    sl();

}

function rl()

{

    for(var i=0;

    i<m_headlines.length;

    i++)

    {

        m_headlines[i].Collapse();

    }

    sl();

}

function sl()

{

    var allOpen=true;

    var allClosed=true;

    for(var i=0;

    i<m_headlines.length;

    i++)

    {

        if(m_headlines[i].IsExpanded())allClosed=false;

        else allOpen=false;

    }

    m_toolExpand.className=allOpen?"toolExpandCollapseInactive":"toolExpandCollapse";

    if(allOpen)m_toolExpand.detachEvent("onmousedown",ql);

    else m_toolExpand.attachEvent("onmousedown",ql);

    m_toolCollapse.className=allClosed?"toolExpandCollapseInactive":"toolExpandCollapse";

    if(allClosed)m_toolCollapse.detachEvent("onmousedown",rl);

    else m_toolCollapse.attachEvent("onmousedown",rl);

}

};

Start.RssReader.registerClass("Start.RssReader","Web.Bindings.Base");

registerNamespace("Start.SearchModule");

registerNamespace("Start.SearchModuleTab");

Start.SearchModule=function(tl,ul,vl)

{

Start.SearchModule.initializeBase(this,arguments);

var m_el=tl;

var m_this=this;

var m_query=ul.query;

var m_module=ul.module;

var m_defaultTab=ul.defaultTab;

var m_pageContainer=null;

var m_pageList=new Array();

var m_curPage=null;

var m_tabContainer=null;

var m_tabList=new Array();

var m_curTab=null;

var m_countContainer=null;

var m_countList=new Array();

var m_curCount=null;

var m_isInitialized=false;

var m_onDashboard=false;

this.initialize=function(wl)

{

    Start.SearchModule.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,wl);

    m_el.innerHTML="";

    m_module.SetTitleText(L_AddSearchPopup_Text+m_query);

    if(Web.Type.compare("Start.DashboardModule",m_module))m_onDashboard=true;

    m_countContainer=document.createElement("span");

    m_countContainer.className="searchCountContainer";

    m_el.appendChild(m_countContainer);

    m_tabContainer=document.createElement("div");

    m_tabContainer.className="searchTabContainer";

    if(m_onDashboard)m_tabContainer.style.marginBottom="5px";

    else m_tabContainer.style.marginBottom="15px";

    m_el.appendChild(m_tabContainer);

    m_pageContainer=document.createElement("div");

    m_pageContainer.className="searchPageContainer";

    m_el.appendChild(m_pageContainer);

    m_this.AddPage(Start.SearchProviders.MSNWeb,m_query,0);

    m_this.AddPage(Start.SearchProviders.MSNNews,m_query,1);

    m_this.AddPage(Start.SearchProviders.Rss,m_query,2);

    var activeTab=0;

    if(m_defaultTab>=0)activeTab=m_defaultTab;

    m_this.SetActivePage(activeTab);

    if(activeTab>=0&&activeTab<m_pageList.length)m_pageList[activeTab].Load();

};

this.dispose=function(xl)

{

    Start.SearchModule.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,xl);

    while(m_pageList.length>0)

    {

        var page=m_pageList.pop();

        page=null;

    }

};

this.AddPage=function(yl,zl,Al)

{

    var t=document.createElement("span");

    t.className="searchTab";

    m_tabContainer.appendChild(t);

    var tab=Web.Bindings.attachElementBindingSync(t,Start.SearchModuleTab,m_this,

    {

        "query":zl,"sheet":this,"id":Al,"module":m_module,"onDashboard":m_onDashboard

    }

    );

    m_tabList.push(tab);

    var c=document.createElement("div");

    c.className="searchCount";

    m_countContainer.appendChild(c);

    m_countList.push(c);

    var p=document.createElement("div");

    p.className="searchPage";

    m_pageContainer.appendChild(p);

    var page=Web.Bindings.attachElementBindingSync(p,yl,m_this,

    {

        "query":zl,"tab":tab,"sheet":this,"onDashboard":m_onDashboard,"countEl":c

    }

    );

    m_pageList.push(page);

};

this.RemovePage=function(Bl)

{

    if(Bl>=0&&Bl<m_pageList.length)

    {

        var page=m_pageList[Bl];

        if(page)

        {

            page.GetEl().removeNode(true);

            m_pageList.removeAt(Bl);

        }

    }

};

this.SetActivePage=function(Cl)

{

    if(m_pageList.length==0)return;

    if(Cl>=m_pageList.length)Cl=m_pageList.length-1;

    else

    {

        if(Cl<0)Cl=0;

    }

    var newPage=m_pageList[Cl];

    var newTab=m_tabList[Cl];

    var newCount=m_countList[Cl];

    if(newPage!=m_curPage)

    {

        newPage.GetEl().className="searchPage searchPageActive";

        if(m_curPage)m_curPage.GetEl().className="searchPage";

        m_curPage=newPage;

        newTab.GetEl().className="searchTab searchTabActive";

        if(m_curTab)m_curTab.GetEl().className="searchTab";

        m_curTab=newTab;

        newCount.className="searchCount searchCountActive";

        if(m_curCount)m_curCount.className="searchCount";

        m_curCount=newCount;

    }

};

this.OnLoaded=function(Dl)

{

    if(!m_isInitialized)

    {

        for(var i=0;

        i<m_pageList.length;

        i++)

        {

            if(i!=Dl)m_pageList[i].Load();

        }

        m_isInitialized=true;

    }

};

};

Start.SearchModule.registerClass("Start.SearchModule","Web.Bindings.Base");

Start.SearchModuleTab=function(El,Fl,Gl)

{

Start.SearchModuleTab.initializeBase(this,arguments);

var m_el=El;

var m_this=this;

var m_query=Fl.query;

var m_sheet=Fl.sheet;

var m_module=Fl.module;

var m_onDashboard=Fl.onDashboard;

var m_id=Fl.id;

this.GetEl=function()

{

    return m_el;

};

this.GetId=function()

{

    return m_id;

};

this.initialize=function(Hl)

{

    Start.SearchModuleTab.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Hl);

    m_el.attachEvent("onmousedown",Jl);

};

this.dispose=function(Il)

{

    Start.SearchModuleTab.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Il);

    m_el.detachEvent("onmousedown",Jl);

};

function Jl()

{

    m_sheet.SetActivePage(m_id);

    if(m_onDashboard)

    {

        var clientData="{type:1,binding:'Start.SearchModule',params:{query:'"+m_query.replace(/\'/g,"\\'")+"',defaultTab:"+m_id+"    }    ,isExpanded:true}";

		

		Start.BookmarkService.UpdateBookmark(m_module.GetId(),m_module.GetTitle(),m_module.GetLink(),Start.Const.MyPagesFolderIdStr,clientData);

	}

	else m_module.GetBindingParams().defaultTab=m_id;

}

};



Start.SearchModuleTab.registerClass("Start.SearchModuleTab","Web.Bindings.Base");

registerNamespace("Start.SearchProviders.MSNWeb");

registerNamespace("Start.SearchProviders.MSNNews");

registerNamespace("Start.SearchProviders.Rss");

Start.SearchProviders.MSNWeb=function(Kl,Ll,Ml)

{

Start.SearchProviders.MSNWeb.initializeBase(this,arguments);

var m_el=Kl;

var m_this=this;

var m_query=Ll.query;

var m_sheet=Ll.sheet;

var m_tab=Ll.tab;

var m_onDashboard=Ll.onDashboard;

var m_countEl=Ll.countEl;

var m_resultsEl=null;

var m_adsEl=null;

var m_first=0;

var m_count=10;

this.GetEl=function()

{

return m_el;

};

this.initialize=function(Nl)

{

Start.SearchProviders.MSNWeb.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Nl);

m_tab.GetEl().innerText=L_WebResults_Text;

};

this.dispose=function(Ol)

{

Start.SearchProviders.MSNWeb.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Ol);

};

this.Load=function()

{

var queries=new Array();

queries[0]=

{

"engine":"msnweb_"+M_CultureVariable_Text,"count":m_count,"first":m_first,"query":m_query

};

Start.StartService.Search(queries,Pl);

m_el.innerHTML=L_Loading_Text;

};

function Pl(Ql,Rl)

{

    m_el.innerHTML="";

    m_sheet.OnLoaded(m_tab.GetId());

    if(!Rl.error&&Rl.data)

    {

        var node=null;

        for(var i=0;

        i<Rl.data.childNodes.length;

        i++)

        {

            if(Rl.data.childNodes[i].nodeType==1)

            {

                node=Rl.data.childNodes[i];

                break;

            }

        }

        m_rssInfo=Start.Parser.ParseRssResponse(node,true);

        if(m_rssInfo)

        {

            if(m_rssInfo.channels.length>0)

            {

                var chanResults=-1;

                var chanAds=-1;

                var chanEncarta=-1;

                for(var i=0;

                i<m_rssInfo.channels.length;

                i++)

                {

                    switch(m_rssInfo.channels[i].attribs.source)

                    {

                        case "FEDERATOR_MONARCH":chanResults=i;

                        break;

                        case "FEDERATOR_BACKFILL_ADS":chanAds=i;

                        break;

                        case "FEDERATOR_ENCARTA":chanEncarta=i;

                        break;

                    }

                }

                if(chanEncarta!=-1)

                {

                    var div=document.createElement("div");

                    div.innerHTML=Sl(m_rssInfo.channels[chanEncarta]);

                    m_el.appendChild(div);

                }

                if(!m_onDashboard&&chanAds!=-1&&m_rssInfo.channels[chanAds].attribs.count!="0")

                {

                    m_adsEl=document.createElement("div");

                    m_adsEl.className="searchAds";

                    m_el.appendChild(m_adsEl);

                    Wl(m_rssInfo.channels[chanAds]);

                }

                if(chanResults!=-1)

                {

                    m_resultsEl=document.createElement("div");

                    m_resultsEl.className="searchResults";

                    m_el.appendChild(m_resultsEl);

                    Ul(m_rssInfo.channels[chanResults]);

                    var div=document.createElement("div");

                    div.style.textAlign="center";

                    if(m_first>0)

                    {

                        var prev=document.createElement("span");

                        prev.className="searchPrev";

                        prev.innerText=L_Previous_Text;

                        prev.attachEvent("onmousedown",Zl);

                        div.appendChild(prev);

                    }

                    var showNext=false;

                    if(m_rssInfo.channels[chanResults].attribs.total)

                    {

                        if(m_rssInfo.channels[chanResults].attribs.total-m_first>m_count)showNext=true;

                    }

                    else

                    {

                        if(m_rssInfo.channels[chanResults].items.length==m_count)showNext=true;

                    }

                    if(m_first>0&&showNext)div.appendChild(document.createTextNode(" | "));

                    if(showNext)

                    {

                        var next=document.createElement("span");

                        next.className="searchNext";

                        next.innerText=L_Next_Text;

                        next.attachEvent("onmousedown",Yl);

                        div.appendChild(next);

                    }

                    m_el.appendChild(div);

                }

                return;

            }

            else m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

        }

    }

    m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function Sl(Tl)

{

    var htm="";

    for(var i=0;

    i<Tl.items.length;

    i++)

    {

        htm+="<div class='searchResultsItem' "+(m_onDashboard?"style='line-height:normal'":"")+">"+L_InlineAnswer_Text+"<b>";

        var o=Tl.items[i].other;

        if(!m_onDashboard)

        {

            if(o&&o.subject)htm+=o.subject+": ";

            if(o&&o.expression)htm+=o.expression+": ";

            if(o&&o.indicator)htm+=o.indicator+": ";

        }

        if(o&&o.answer)htm+=o.answer;

        else htm+=Tl.items[i].title;

        htm+="</b><br>";

        if(!m_onDashboard)

        {

            if(o&&o.source)htm+="Source: "+o.source+" - <a href='"+Tl.items[i].link+"'>"+L_EncartaAnswers_Text+"</a>";

            else htm+="<a href='"+Tl.items[i].link+"'>"+L_EncartaAnswers_Text+"</a>";

        }

        htm+="</div>";

    }

    return htm;

}

function Ul(Vl)

{

    if(Vl.items.length>0)

    {

        var htm="";

        var max=Vl.items.length;

        if(m_onDashboard&&max>3)max=3;

        for(var i=0;

        i<max;

        i++)

        {

            htm+="<div class='"+(m_onDashboard?"searchResultsItemDashboard":"searchResultsItem")+"'><a title='"+Vl.items[i].description+"' href='"+Vl.items[i].link+"' style='"+(m_onDashboard?"font-size:larger;            ":"")+"' target='new'>"+Vl.items[i].title+"</a>";            htm+="<br>";

            var d=Start.Util.TruncateToSpace(Vl.items[i].description,150);

            htm+=d;

            if(d)htm+="<br>";

            htm+="<span style='color:green'>"+Vl.items[i].guid.substring(7,Vl.items[i].guid.length)+"</span>";

            htm+="</div>";

        }

        m_resultsEl.innerHTML+=htm;

        if(!m_onDashboard)m_countEl.innerHTML=Start.SearchProviders.DisplayResultsText(Vl.attribs.total,m_first,Vl.items.length);

    }

    else m_resultsEl.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function Wl(Xl)

{

    var deduped=new Array();

    for(var i=0;

    i<Xl.items.length;

    i++)

    {

        var dup=false;

        for(var j=0;

        j<deduped.length;

        j++)

        {

            if(deduped[j].guid==Xl.items[i].guid)

            {

                dup=true;

                break;

            }

        }

        if(!dup)deduped.push(Xl.items[i]);

    }

    var htm="";

    for(var i=0;

    i<deduped.length;

    i++)

    {

        htm+="<a href='"+deduped[i].link+"' target='new'>"+deduped[i].title+"</a>";

        htm+="<br>";

        htm+=deduped[i].description;

        htm+="<br>";

        htm+="<span style='color:green'>"+deduped[i].guid.substring(7,deduped[i].guid.length)+"</span>";

        if(i==2)htm+="<div class='searchAdDivider'></div>";

        else htm+="<br><br>";

    }

    m_adsEl.innerHTML+=htm;

}

function Yl()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first+=m_count;

    m_this.Load();

}

function Zl()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first-=m_count;

    m_this.Load();

}

};

Start.SearchProviders.MSNWeb.registerClass("Start.SearchProviders.MSNWeb","Web.Bindings.Base");

Start.SearchProviders.MSNNews=function(am,bm,cm)

{

Start.SearchProviders.MSNNews.initializeBase(this,arguments);

var m_el=am;

var m_this=this;

var m_query=bm.query;

var m_sheet=bm.sheet;

var m_tab=bm.tab;

var m_onDashboard=bm.onDashboard;

var m_countEl=bm.countEl;

var m_resultsEl=null;

var m_adsEl=null;

var m_first=0;

var m_count=10;

this.GetEl=function()

{

    return m_el;

};

this.initialize=function(em)

{

    Start.SearchProviders.MSNNews.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,em);

    m_tab.GetEl().innerText=L_NewsResults_Text;

};

this.dispose=function(gm)

{

    Start.SearchProviders.MSNNews.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,gm);

};

this.Load=function()

{

    var queries=new Array();

    queries[0]=

    {

        "engine":"msnnews_"+M_CultureVariable_Text,"count":m_count,"first":m_first,"query":m_query

    };

    Start.StartService.Search(queries,hm);

    m_el.innerHTML=L_Loading_Text;

};

function hm(jm,km)

{

    m_el.innerHTML="";

    m_sheet.OnLoaded(m_tab.GetId());

    if(!km.error&&km.data)

    {

        var node=null;

        for(var i=0;

        i<km.data.childNodes.length;

        i++)

        {

            if(km.data.childNodes[i].nodeType==1)

            {

                node=km.data.childNodes[i];

                break;

            }

        }

        m_rssInfo=Start.Parser.ParseRssResponse(node,true);

        if(m_rssInfo)

        {

            if(m_rssInfo.channels.length>0)

            {

                lm(m_rssInfo.channels[0]);

                var div=document.createElement("div");

                div.style.textAlign="center";

                if(m_first>0)

                {

                    var prev=document.createElement("span");

                    prev.className="searchPrev";

                    prev.innerText=L_Previous_Text;

                    prev.attachEvent("onmousedown",om);

                    div.appendChild(prev);

                }

                var showNext=false;

                if(m_rssInfo.channels[0].attribs.total)

                {

                    if(m_rssInfo.channels[0].attribs.total-m_first>m_count)showNext=true;

                }

                else

                {

                    if(m_rssInfo.channels[0].items.length==m_count)showNext=true;

                }

                if(m_first>0&&showNext)div.appendChild(document.createTextNode(" | "));

                if(showNext)

                {

                    var next=document.createElement("span");

                    next.className="searchNext";

                    next.innerText=L_Next_Text;

                    next.attachEvent("onmousedown",nm);

                    div.appendChild(next);

                }

                m_el.appendChild(div);

                return;

            }

            else m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

        }

    }

    m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function lm(mm)

{

    if(mm.items.length>0)

    {

        var htm="";

        var max=mm.items.length;

        if(m_onDashboard&&max>3)max=3;

        for(var i=0;

        i<max;

        i++)

        {

            htm+="<div class='"+(m_onDashboard?"searchResultsItemDashboard":"searchResultsItem")+"'><a href='"+mm.items[i].link+"' style='"+(m_onDashboard?"font-size:larger;            ":"")+"' target='new'>"+mm.items[i].title+"</a>";

            htm+="<br>";

            var d=Start.Util.TruncateToSpace(mm.items[i].description,150);

            htm+=d;

            if(d)htm+="<br>";

            htm+="</div>";

        }

        m_el.innerHTML+=htm;

        if(!m_onDashboard)m_countEl.innerHTML=Start.SearchProviders.DisplayResultsText(mm.attribs.total,m_first,mm.items.length);

    }

    else m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function nm()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first+=m_count;

    m_this.Load();

}

function om()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first-=m_count;

    m_this.Load();

}

};

Start.SearchProviders.MSNNews.registerClass("Start.SearchProviders.MSNNews","Web.Bindings.Base");

Start.SearchProviders.Rss=function(pm,qm,rm)

{

Start.SearchProviders.Rss.initializeBase(this,arguments);

var m_el=pm;

var m_this=this;

var m_query=qm.query;

var m_sheet=qm.sheet;

var m_tab=qm.tab;

var m_onDashboard=qm.onDashboard;

var m_countEl=qm.countEl;

var m_resultsEl=null;

var m_adsEl=null;

var m_first=0;

var m_count=10;

this.GetEl=function()

{

    return m_el;

};

this.initialize=function(sm)

{

    Start.SearchProviders.Rss.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,sm);

    m_tab.GetEl().innerText=L_RssResults_Text;

};

this.dispose=function(tm)

{

    Start.SearchProviders.Rss.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,tm);

};

this.Load=function()

{

    var queries=new Array();

    queries[0]=

    {

        "engine":"msnrss","count":m_count,"first":m_first,"query":m_query

    };

    Start.StartService.Search(queries,um);

    m_el.innerHTML=L_Loading_Text;

};

function um(vm,wm)

{

    m_el.innerHTML="";

    m_sheet.OnLoaded(m_tab.GetId());

    if(!wm.error&&wm.data)

    {

        var node=null;

        for(var i=0;

        i<wm.data.childNodes.length;

        i++)

        {

            if(wm.data.childNodes[i].nodeType==1)

            {

                node=wm.data.childNodes[i];

                break;

            }

        }

        m_rssInfo=Start.Parser.ParseRssResponse(node,true);

        if(m_rssInfo)

        {

            if(m_rssInfo.channels.length>0)

            {

                var chanResults=-1;

                for(var i=0;

                i<m_rssInfo.channels.length;

                i++)

                {

                    switch(m_rssInfo.channels[i].attribs.source)

                    {

                        case "FEDERATOR_MONARCH":chanResults=i;

                        break;

                    }

                }

                if(chanResults!=-1)

                {

                    xm(m_rssInfo.channels[chanResults]);

                    var div=document.createElement("div");

                    div.style.textAlign="center";

                    if(m_first>0)

                    {

                        var prev=document.createElement("span");

                        prev.className="searchPrev";

                        prev.innerText=L_Previous_Text;

                        prev.attachEvent("onmousedown",Am);

                        div.appendChild(prev);

                    }

                    var showNext=false;

                    if(m_rssInfo.channels[chanResults].attribs.total)

                    {

                        if(m_rssInfo.channels[chanResults].attribs.total-m_first>m_count)showNext=true;

                    }

                    else

                    {

                        if(m_rssInfo.channels[chanResults].items.length==m_count)showNext=true;

                    }

                    if(m_first>0&&showNext)div.appendChild(document.createTextNode(" | "));

                    if(showNext)

                    {

                        var next=document.createElement("span");

                        next.className="searchNext";

                        next.innerText=L_Next_Text;

                        next.attachEvent("onmousedown",zm);

                        div.appendChild(next);

                    }

                    m_el.appendChild(div);

                }

                return;

            }

            else m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

        }

    }

    m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function xm(ym)

{

    if(ym.items.length>0)

    {

        var htm="";

        var max=ym.items.length;

        if(m_onDashboard&&max>3)max=3;

        for(var i=0;

        i<max;

        i++)

        {

            var div=document.createElement("div");

            div.className=m_onDashboard?"searchResultsItemDashboard":"searchResultsItem";

            var link=document.createElement("div");

            if(m_onDashboard)link.style.fontSize="larger";

            div.appendChild(link);

            var item=Web.Bindings.attachElementBindingSync(link,Start.RssModule.HeadlineItem,null,

            {

                "channelTitle":ym.items[i].title,"title":ym.items[i].title,"feedUrl":ym.items[i].link,"numItems":5,"desc":ym.items[i].description,"className":"searchLink"

            }

            );

            if(ym.items[i].description)

            {

                var desc=document.createElement("div");

                desc.innerHTML=Start.Util.TruncateToSpace(ym.items[i].description,150);

                div.appendChild(desc);

            }

            var source=document.createElement("span");

            source.className="feedSource";

            source.innerHTML=ym.items[i].link.substring(7,ym.items[i].link.indexOf("/",7));

            div.appendChild(source);

            div.appendChild(document.createTextNode(" - "));

            var subscribe=document.createElement("span");

            subscribe.className="rssSubscribe";

            subscribe.title=L_SubscribeFeedText_Text;

            subscribe.innerText=L_SubscribeFeed_Text;

            var feedUrl=new String();

            feedUrl=ym.items[i].link.substring(0,ym.items[i].link.length);

            var sub=Web.Bindings.attachElementBindingSync(subscribe,Start.SearchProviders.Rss.Subscribe,null,

            {

                "title":ym.items[i].title,"feedUrl":feedUrl

            }

            );

            div.appendChild(subscribe);

            m_el.appendChild(div);

        }

        if(!m_onDashboard)m_countEl.innerHTML=Start.SearchProviders.DisplayResultsText(ym.attribs.total,m_first,ym.items.length);

    }

    else m_el.innerHTML=L_NoResults_Text+"<br><br><br>";

}

function zm()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first+=m_count;

    m_this.Load();

}

function Am()

{

    if(!m_onDashboard)m_el.innerHTML="";

    m_first-=m_count;

    m_this.Load();

}

};

Start.SearchProviders.Rss.registerClass("Start.SearchProviders.Rss","Web.Bindings.Base");

Start.SearchProviders.Rss.Subscribe=function(Bm,Cm,Dm)

{

Start.SearchProviders.Rss.Subscribe.initializeBase(this,arguments);

var m_el=Bm;

var m_this=this;

var m_title=Cm.title;

var m_feedUrl=Cm.feedUrl;

this.initialize=function(Em)

{

    Start.SearchProviders.Rss.Subscribe.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Em);

    m_el.attachEvent("onmousedown",Gm);

};

this.dispose=function(Fm)

{

    Start.SearchProviders.Rss.Subscribe.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Fm);

    m_el.detachEvent("onmousedown",Gm);

};

function Gm()

{

    var item=null;

    theApp.GetSidebar().Expand();

    theApp.GetSidebar().Pin();

    var myFeedsGroup=theApp.GetSidebar().GetMyFeedsGroup();

    var data=new Object();

    data.type=parseInt(Start.Const.BindingType.Internal,10);

    data.binding="Start.RssReader";

    data.params=

    {

        "feedUrl":m_feedUrl,"numItems":5

    };

    data.isExpanded=true;

    var bookmark=new Start.Struct.Bookmark.Item(m_title,null,null,Start.Util.ObjectToString(data));

    if(myFeedsGroup.IsExpanded())item=myFeedsGroup.AddItem(bookmark,true,false,true);

function Hm()

{

    myFeedsGroup.Expand();

    myFeedsGroup.FlashItem(bookmark.name,true);

}

if(item||!myFeedsGroup.IsExpanded())Start.Store.AddFeedToMyFeedsFolder(bookmark,Hm);

else Hm();

event.returnValue=false;

return false;

}

};

Start.SearchProviders.Rss.Subscribe.registerClass("Start.SearchProviders.Rss.Subscribe","Web.Bindings.Base");

Start.SearchProviders.DisplayResultsText=function(Im,Jm,Km)

{

var htm="";

if(Im)

{

htm=L_ResultsNofMFirst_Text+" <strong>"+(Jm+1)+" - "+(Jm+Km)+"</strong> ";

htm+=L_ResultsNOfMMiddle_Text+" <strong>"+Start.Util.FormatNumber(parseInt(Im,10)+1)+"</strong>"+L_ResultsNOfMEnd_Text;

}

else htm=L_ResultsFirst_Text+" <strong>"+(Jm+1)+" - "+(Jm+Km)+"</strong>"+L_ResultsEnd_Text;

return htm;

};





registerNamespace("Start.Sheet");

Start.Sheet=function(Lm,Mm,Nm)

{

Start.Sheet.initializeBase(this,arguments);

var m_el=Lm;

var m_this=this;

var m_pageContainer=null;

var m_pageList=new Array();

var m_curPage=null;

var m_preview=null;

this.GetEl=function()

{

return m_el;

};

this.GetCurrentPage=function()

{

return m_curPage;

};

this.initialize=function(Om)

{

Start.Sheet.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,Om);

m_el.className="sheet";

m_pageContainer=document.createElement("div");

m_pageContainer.className="pageContainer";

m_el.appendChild(m_pageContainer);

var div=document.createElement("div");

div.id="footer";

var feedback=document.createElement("span");

feedback.innerHTML="<a href='mailto:startfb@microsoft.com?subject=start feedback'>"+L_FeedbackLink_Text+"</a>";

div.appendChild(feedback);

div.appendChild(document.createTextNode(" | "));

var weblog=document.createElement("span");

weblog.innerHTML="<a href='http://spaces.msn.com/members/startcom' target='new'>"+L_BlogLink_Text+"</a>";

div.appendChild(weblog);

var gadget=document.createElement("span");

gadget.innerHTML+="&nbsp;| <a href='http://www.start.com/developer'>developer site</a>";

div.appendChild(gadget);

var site=document.createElement("div");

site.className="footerlinks";

site.innerHTML=L_Disclaimer1_Text+"<a href='http://sandbox.msn.com'>http://sandbox.msn.com</a>. "+L_Disclaimer2_Text;

site.innerHTML+="<br>"+L_MicrosoftFooter_Text;

site.innerHTML+="&nbsp;- ";

var privacyLink=document.createElement("a");

privacyLink.target="new";

privacyLink.innerText=L_PrivacyFooter_Text;

privacyLink.href=M_PrivacyLinkHref_Text;

site.appendChild(privacyLink);

site.innerHTML+=" - ";

div.appendChild(site);

m_preview=document.createElement("span");

m_preview.className="previewText";

m_preview.innerHTML=L_PreviewFooter_Text;

m_preview.attachEvent("onmousedown",Rm);

site.appendChild(m_preview);

m_el.appendChild(div);

};

this.dispose=function(Pm)

{

Start.Sheet.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,Pm);

m_preview.detachEvent("onmousedown",Rm);

while(m_pageList.length>0)

{

    var page=m_pageList.pop();

    page=null;

}

m_preview=m_el=null;

};

function Qm()

{

    var cookie_date=new Date();

    cookie_date.setTime(cookie_date.getTime()-1);

    document.cookie="start_session=;    expires="+cookie_date.toGMTString();

    document.location.reload();

}

function Rm()

{

    theApp.DisplayPopupModule("Preview",null,Start.Const.BindingType.External,"custom/preview.xml",null);

}

this.AddPage=function(Sm,Tm,Um)

{

    var p=document.createElement("div");

    if(Um==null||Um<0||Um>=m_pageList.length)m_pageContainer.appendChild(p);

    else m_pageContainer.insertBefore(p,m_pageList[Um].GetEl());

    var page=Web.Bindings.attachElementBindingSync(p,Start.Page,m_this,

    {

        "name":Sm,"id":Tm,"sheet":this

    }

    );

    if(Um==null||Um<0||Um>=m_pageList.length)m_pageList.push(page);

    else m_pageList.insert(page,Um);

};

this.RemovePage=function(Vm)

{

    if(Vm>=0&&Vm<m_pageList.length)

    {

        var page=m_pageList[Vm];

        if(page)

        {

            page.GetEl().removeNode(true);

            m_pageList.removeAt(Vm);

        }

    }

};

this.SetActivePage=function(Wm)

{

    if(m_pageList.length==0)return;

    if(Wm>=m_pageList.length)Wm=m_pageList.length-1;

    else

    {

        if(Wm<0)Wm=0;

    }

    var newPage=m_pageList[Wm];

    if(newPage!=m_curPage)

    {

        newPage.Activate(true);

        if(m_curPage)m_curPage.Activate(false);

        m_curPage=newPage;

    }

};

this.UpdateDashboardState=function(Xm)

{

    m_pageContainer.style.display=Xm?"":"none";

};

function Ym()

{

    theApp.DisplayPopupModule(L_AddContentHeading_Text,null,Start.Const.BindingType.Internal,Start.AddContentModule,null);

}

};

Start.Sheet.registerClass("Start.Sheet","Web.Bindings.Base");





registerNamespace("Start.Sidebar");

Start.Sidebar=function(Zm,an,bn)

{

Start.Sidebar.initializeBase(this,arguments);

var m_el=Zm;

var m_this=this;

var m_addFeedEl=null;

var m_myFeedsGroup=null;

var m_myFavoritesGroup=null;

var m_popularFeedsGroup=null;

var m_myPagesGroup=null;

var m_staffPicks=null;

var m_categoriesGroup=null;

var m_recentSearchesGroup=null;

var m_isPinned=an.isExpanded;

var m_waitingToMouseOut=false;

var m_addContentBtn=null;

var m_killBtnEl=null;

var m_firstTime=true;

this.GetMyFeedsGroup=function()

{

    return m_myFeedsGroup;

};

this.GetRecentSearchesGroup=function()

{

    return m_recentSearchesGroup;

};

this.IsPinned=function()

{

    return m_isPinned;

};

this.initialize=function(cn)

{

    Start.Sidebar.getBaseMethod(this,"initialize","Start.ExpandableContainer").call(this,cn);

    m_el.className="sidebar";

    m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarNoBorder";

    m_this.GetBodyEl().className="sidebarBody";

    if(m_isPinned)m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarBorderExpanded";

    else

    {

        m_el.attachEvent("onmouseover",gn);

        m_el.attachEvent("onmouseout",hn);

    }

    m_this.GetTitleBarEl().attachEvent("onmousedown",kn);

    var logo=document.createElement("div");

    logo.className="sidebarLogo";

    m_this.GetTitleBarEl().appendChild(logo);

    var preview=document.createElement("div");

    preview.className="sidebarPreview";

    preview.innerText=L_PreviewText_Text;

    m_this.GetTitleBarEl().appendChild(preview);

    m_killBtnEl=document.createElement("div");

    m_killBtnEl.className="sidebarKillBtn";

    m_killBtnEl.title=L_CloseSidebar_Text;

    m_killBtnEl.style.display=m_isPinned?"":"none";

    m_this.GetTitleBarEl().appendChild(m_killBtnEl);

    m_pinBtnEl=document.createElement("div");

    m_pinBtnEl.className="sidebarPinBtn";

    m_pinBtnEl.innerText=L_PinSidebar_Text;

    m_pinBtnEl.title=L_PinSidebar_Text;

    m_pinBtnEl.style.display="none";

    m_this.GetTitleBarEl().appendChild(m_pinBtnEl);

    var btnShow=document.createElement("div");

    btnShow.className="sidebarShowHideBtn sidebarOCBtnExpanded";

    var btnHide=document.createElement("div");

    btnHide.className="sidebarShowHideBtn sidebarOCBtnCollapsed";

    m_this.SetExpandCollapseButton(m_this.GetTitleBarEl(),btnShow,btnHide,true);

};

this.dispose=function(en)

{

    if(!m_isPinned)

    {

        m_el.detachEvent("onmouseover",gn);

        m_el.detachEvent("onmouseout",hn);

    }

    m_this.GetTitleBarEl().detachEvent("onmousedown",kn);

    Start.Sidebar.getBaseMethod(this,"dispose","Start.ExpandableContainer").call(this,en);

    if(m_addFeedEl)m_addFeedEl.detachEvent("onmousedown",ln);

};

function gn()

{

    if(!m_isPinned)

    {

        m_this.Expand();

        m_pinBtnEl.style.display="";

        if(m_this.IsExpanded())

        {

            m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarBorderExpanded";

            theApp.MovePopup(true);

        }

        else m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarBorderCollapsed";

    }

}

function hn(jn)

{

    if(!m_el.contains(window.event.toElement))

    {

        m_pinBtnEl.style.display="none";

        m_this.Collapse();

        if(!m_this.IsExpanded())

        {

            m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarNoBorder";

            theApp.MovePopup(false);

        }

        if(m_waitingToMouseOut)

        {

            m_el.attachEvent("onmouseover",gn);

            m_waitingToMouseOut=false;

        }

    }

}

function kn()

{

    m_isPinned=!m_isPinned;

    if(m_isPinned)

    {

        m_this.fire("onSidebarExpandedEvent");

        m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarBorderExpanded";

        m_el.detachEvent("onmouseover",gn);

        m_el.detachEvent("onmouseout",hn);

        m_this.Expand();

        theApp.MovePopup(false);

        m_killBtnEl.style.display="";

        m_pinBtnEl.style.display="none";

    }

    else

    {

        m_this.fire("onSidebarCollapsedEvent");

        m_this.GetTitleBarEl().className="sidebarTitleBar sidebarTitleBarNoBorder";

        m_el.attachEvent("onmouseout",hn);

        m_waitingToMouseOut=true;

        m_killBtnEl.style.display="none";

        m_pinBtnEl.style.display="none";

        m_this.Collapse();

    }

}

this.RenderContent=function()

{

    var hr=document.createElement("div");

    hr.className="sidebarSep1";

    if(!Web.Browser.isMozilla())hr.className+=" sidebarSepIEOnly";

    hr.innerHTML="&nbsp;    ";

    m_this.GetBodyEl().appendChild(hr);

    m_addFeedEl=document.createElement("div");

    m_addFeedEl.innerText=L_AddContentText_Text;

    m_addFeedEl.className="addFeedText";

    m_addFeedEl.attachEvent("onmousedown",ln);

    m_this.GetBodyEl().appendChild(m_addFeedEl);

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_myFeedsGroup=Web.Bindings.attachElementBindingSync(div,Start.MyFeedsGroup,m_this,

    {

        "title":L_MyFeedsGroup_Text,"isExpanded":false

    }

    );

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_recentSearchesGroup=Web.Bindings.attachElementBindingSync(div,Start.RecentSearchesGroup,m_this,

    {

        "title":L_RecentSearchesGroup_Text,"isExpanded":false

    }

    );

    var hr=document.createElement("div");

    hr.className="sidebarSep2";

    hr.innerHTML="&nbsp;    ";

    m_this.GetBodyEl().appendChild(hr);

    var dummy=document.createElement("div");

    dummy.className="topFeedsSpacer";

    m_this.GetBodyEl().appendChild(dummy);

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_popularFeedsGroup=Web.Bindings.attachElementBindingSync(div,Start.PopularFeedsGroup,m_this,

    {

        "title":L_PopularFeedsGroup_Text,"isExpanded":false

    }

    );

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_startlets=Web.Bindings.attachElementBindingSync(div,Start.Startlets,m_this,

    {

        "title":L_Startlets_Text,"isExpanded":false

    }

    );

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_staffPicks=Web.Bindings.attachElementBindingSync(div,Start.StaffPicks,m_this,

    {

        "title":L_StaffPicks_Text,"isExpanded":true

    }

    );

    var div=document.createElement("div");

    m_this.GetBodyEl().appendChild(div);

    m_categoriesGroup=Web.Bindings.attachElementBindingSync(div,Start.CategoriesGroup,m_this,

    {

        "title":L_CategoriesGroup_Text,"isExpanded":false

    }

    );

};

this.Pin=function()

{

    if(!m_isPinned)kn();

};

function ln()

{

    theApp.DisplayPopupModule(L_AddContentHeading_Text,null,Start.Const.BindingType.Internal,Start.AddContentModule,null);

}

};

Start.Sidebar.registerClass("Start.Sidebar","Start.ExpandableContainer");

Start.Sidebar.Events=Web.Enum.create("onSidebarExpandedEvent","onSidebarCollapsedEvent");

registerNamespace("Start.StaffPicks");

Start.StaffPicks=function(mn,nn,on)

{

Start.StaffPicks.initializeBase(this,arguments);

var m_el=mn;

var m_this=this;

this.initialize=function(pn)

{

    Start.StaffPicks.getBaseMethod(this,"initialize","Start.Group").call(this,pn);

};

this.dispose=function(qn)

{

    Start.StaffPicks.getBaseMethod(this,"dispose","Start.Group").call(this,qn);

};

this.RenderContent=function()

{

    m_this.GetBodyEl().innerText=L_Loading_Text;

    Start.Store.FetchStaffFeeds(rn);

};

function rn(sn,tn,un)

{

    m_this.GetBodyEl().innerHTML="";

    if(!tn.error)

    {

        for(var i=0;

        i<un.folders.length;

        i++)

        {

            m_this.AddFolder(un.folders[i],true,null,false);

        }

        for(var i=0;

        i<un.bookmarks.length;

        i++)

        {

            m_this.AddItem(un.bookmarks[i],false);

        }

    }

}

};

Start.StaffPicks.registerClass("Start.StaffPicks","Start.Group");

Start.Startlets=function(vn,wn,xn)

{

Start.Startlets.initializeBase(this,arguments);

var m_el=vn;

var m_this=this;

this.initialize=function(yn)

{

    Start.Startlets.getBaseMethod(this,"initialize","Start.Group").call(this,yn);

};

this.dispose=function(zn)

{

    Start.Startlets.getBaseMethod(this,"dispose","Start.Group").call(this,zn);

};

this.RenderContent=function()

{

    m_this.GetBodyEl().innerText=L_Loading_Text;

    Start.Store.FetchStartlets(An);

};

function An(Bn,Cn,Dn)

{

    m_this.GetBodyEl().innerHTML="";

    if(!Cn.error)

    {

        for(var i=0;

        i<Dn.folders.length;

        i++)

        {

            m_this.AddFolder(Dn.folders[i],true,null,false);

        }

        for(var i=0;

        i<Dn.bookmarks.length;

        i++)

        {

            m_this.AddItem(Dn.bookmarks[i],false);

        }

    }

}

};

Start.Startlets.registerClass("Start.Startlets","Start.Group");

registerNamespace("Start.Store");

registerNamespace("Start.BookmarkService");

registerNamespace("Start.StartService");

Start.Store.FetchModulesForPage=function(En,Fn)

{

Start.BookmarkService.EnumBookmarks(En,Fn);

};

Start.Store.AddPage=function(Gn,Hn)

{

Start.BookmarkService.AddBookmarkFolder(Gn,Start.Const.MyPagesFolderIdStr,Hn);

};

Start.Store.DeletePage=function(In,Jn)

{

Start.BookmarkService.RemoveBookmarkFolder(In,Jn);

};

Start.Store.AddModuleToPage=function(Kn,Ln,Mn,Nn,On)

{

Start.BookmarkService.AddBookmark(Ln,Mn,Kn,Nn,On);

};

Start.Store.AddFeedToMyFeedsFolder=function(Pn,Qn)

{

Start.BookmarkService.AddBookmark(Pn.name,Pn.url,Start.Const.MyFeedsFolderIdStr,Pn.data,Qn);

};

Start.Store.DeleteModuleFromPage=function(Rn,Sn)

{

Start.BookmarkService.RemoveBookmark(Rn,Sn);

};

Start.Store.UpdateModule=function(Tn,Un,Vn,Wn,Xn,Yn)

{

Start.BookmarkService.UpdateBookmark(Un,Vn,Wn,Tn,Xn,Yn);

};

Start.Store.FetchPopularFeeds=function(Zn)

{

Start.BookmarkService.EnumBookmarks(Start.Const.PopularFeedsIdStr,Zn);

};

Start.Store.FetchCategoryFeeds=function(ao)

{

function bo(co)

{

    var sr=Start.Parser.ParseStartResponse(co);

    var info=null;

    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

    ao(co,sr,info);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,"loc/"+theApp.GetLanguage()+"/"+theApp.GetLocale()+"/root.xml",null,ao?bo:null);

r.execute();

};

Start.Store.FetchStaffFeeds=function(eo)

{

	if(Start.Const.UseStaticStaffFeeds)

	{

		function go(ho)

		{

		    var sr=Start.Parser.ParseStartResponse(ho);

		    var info=null;

		    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

		    eo(ho,sr,info);

		}

		var r=Web.Network.createRequest(Web.Network.Type.XML,"loc/"+theApp.GetLanguage()+"/"+theApp.GetLocale()+"/staff.xml",null,eo?go:null);

		r.execute();

	}

};

Start.Store.FetchStartlets=function(jo)

{

function ko(lo)

{

    var sr=Start.Parser.ParseStartResponse(lo);

    var info=null;

    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

    jo(lo,sr,info);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,"loc/"+theApp.GetLanguage()+"/"+theApp.GetLocale()+"/startlets.xml",null,jo?ko:null);

r.execute();

};

Start.Store.FetchMyFeeds=function(mo)

{

Start.BookmarkService.EnumBookmarks(Start.Const.MyFeedsFolderIdStr,mo);

};

Start.Store.FetchRecentSearches=function(no)

{

Start.BookmarkService.EnumBookmarksMostRecent(Start.Const.RecentSearchesFolderIdStr,10,no);

};

Start.Store.FetchSidebarFolder=function(oo,po)

{

if(oo.indexOf(".")>0)

{

function qo(ro)

{

    var sr=Start.Parser.ParseStartResponse(ro);

    var info=null;

    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

    po(ro,sr,info);

}

var uri;

if(oo.indexOf(".xml"))uri="loc/"+theApp.GetLanguage()+"/"+theApp.GetLocale()+"/"+oo;

else uri=oo;

var r=Web.Network.createRequest(Web.Network.Type.XML,uri,null,po?qo:null);

r.execute();

}

else Start.BookmarkService.EnumBookmarks(oo,po);

};

Start.StartService.Login=function(so)

{

function to(uo)

{

    var sr=Start.Parser.ParseStartResponse(uo);

    so(uo,sr);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/Login",null,so?to:null);

r.execute();

};

Start.StartService.GetPassportStatus=function()

{

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/PassportStatus",null,Start.StartService.UpdateLogoTag,null,null,

{

    "Referer":"http://www.start.com/3/"

}

);

r.execute();

};

Start.StartService.UpdateLogoTag=function(vo)

{

var root=Start.Parser._GetDocumentRoot(vo);

if(root&&theApp.GetToolbar()&&theApp.GetToolbar().GetLogoTag())

{

    var loginUrl=root.selectSingleNode("LogoTag");

    theApp.GetToolbar().GetLogoTag().setAttribute("href",loginUrl.text);

    var IsAuthenticated=root.selectSingleNode("IsAuthenticated");

    if(IsAuthenticated!=null&&IsAuthenticated.text=="true")theApp.GetToolbar().GetLogoTag().innerText=L_SignOutText_Text;

    else theApp.GetToolbar().GetLogoTag().innerText=L_SignInText_Text;

}

};

Start.StartService.EnumRssFeeds=function(wo,xo)

{

function yo(zo)

{

    var sr=Start.Parser.ParseStartResponse(zo);

    var visArr=null;

    if(!sr.error)visArr=Start.Parser.ParseEnumRssFeedsResponse(sr.data);

    xo(zo,sr,visArr);

}

var query="url="+encodeURIComponent(wo);

if(wo.charAt(wo.length-1)!="/")query+="%2F";

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/EnumRSSFeeds?"+query,null,xo?yo:null);

r.execute();

};

Start.StartService.GetPreferences=function(Ao,Bo)

{

function Co(Do)

{

    var sr=Start.Parser.ParseStartResponse(Do);

    var preferences=null;

    if(!sr.error)preferences=Start.Parser.ParseGetPreferencesResponse(sr.data);

    Bo(Do,sr,preferences);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/GetPreferences?key="+encodeURIComponent(Ao)+"&rand="+Math.random(),null,Bo?Co:null);

r.execute();

};

Start.StartService.SetPreference=function(Eo,Fo,Go)

{

function Ho(Io)

{

    var sr=Start.Parser.ParseStartResponse(Io);

    Go(Io,sr);

}

var postData="key="+encodeURI(Eo)+"&val="+encodeURIComponent(Fo);

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/SetPreference",null,Go?Ho:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.StartService.TrackEvent=function(Jo)

{

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/TrackEvent?eventType=1&payload=''&uri="+encodeURIComponent(Jo));

r.execute();

};

Start.StartService.Search=function(Ko,Lo)

{

function Mo(No)

{

    var sr=Start.Parser.ParseStartResponse(No);

    Lo(No,sr);

}

var postData="queryXml=";

postData+="<r>";

for(var i=0;

i<Ko.length;

i++)

{

    postData+="<q engine=\""+Ko[i].engine+"\" count=\""+Ko[i].count+"\" q=\""+Start.Util.EncodeXml(Ko[i].query,true)+"\" first=\""+Ko[i].first+"\" />";

}

postData+="</r>";

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/Search",null,Lo?Mo:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.RemoveBookmarkFolder=function(Oo,Po)

{

function Qo(Ro)

{

    var sr=Start.Parser.ParseStartResponse(Ro);

    Po(Ro,sr);

}

var postData="bookmarkFolderIdStr="+Oo;

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/RemoveBookmarkFolder",null,Po?Qo:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.AddBookmarkFolder=function(So,To,Uo)

{

function Vo(Wo)

{

    var sr=Start.Parser.ParseStartResponse(Wo);

    var folder=null;

    if(!sr.error)folder=Start.Parser.ParseAddBookmarkFolderResponse(sr.data);

    Uo(Wo,sr,folder);

}

var postData="name="+encodeURIComponent(So)+"&parentFolderIdStr="+To;

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/AddBookmarkFolder",null,Uo?Vo:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.EnumBookmarks=function(Xo,Yo)

{

function Zo(ap)

{

    var sr=Start.Parser.ParseStartResponse(ap);

    var info=null;

    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

    Yo(ap,sr,info);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/EnumBookmarks?parentFolderIdStr="+Xo,null,Zo);

r.execute();

};

Start.BookmarkService.EnumBookmarksMostRecent=function(bp,cp,ep)

{

function gp(hp)

{

    var sr=Start.Parser.ParseStartResponse(hp);

    var info=null;

    if(!sr.error)info=Start.Parser.ParseEnumBookmarksResponse(sr.data);

    ep(hp,sr,info);

}

var r=Web.Network.createRequest(Web.Network.Type.XML,Start.Const.StartService+"/EnumBookmarksMostRecent?count="+cp+"&parentFolderIdStr="+bp,null,gp);

r.execute();

};

Start.BookmarkService.AddBookmark=function(jp,kp,lp,mp,np)

{

function op(pp)

{

    var sr=Start.Parser.ParseStartResponse(pp);

    var bookmark=null;

    if(!sr.error)bookmark=Start.Parser.ParseAddBookmarkResponse(sr.data);

    np(pp,sr,bookmark);

}

var postData="name="+encodeURIComponent(jp)+"&url="+(kp?encodeURIComponent(kp):"")+"&parentFolderIdStr="+lp+"&clientData="+(mp?encodeURIComponent(mp):"");

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/AddBookmark?rand="+Math.random(),null,np?op:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.RemoveBookmark=function(qp,rp)

{

function sp(tp)

{

    var sr=Start.Parser.ParseStartResponse(tp);

    rp(tp,sr);

}

var postData="bookmarkIdStr="+qp;

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/RemoveBookmark",null,rp?sp:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.UpdateBookmark=function(up,vp,wp,xp,yp,zp)

{

function Ap(Bp)

{

    var sr=Start.Parser.ParseStartResponse(Bp);

    zp(Bp,sr);

}

var postData="serializedBookmark=";

postData+="<Bookmark><Id>"+up+"</Id>";

postData+="<Name>"+vp+"</Name>";

postData+="<Url>"+(wp?encodeURI(wp):"")+"</Url>";

postData+="<ParentFolderId>"+xp+"</ParentFolderId>";

postData+="<ClientData>"+yp+"</ClientData></Bookmark>";

var r=Web.Network.createRequest(Web.Network.Type.XMLPost,Start.Const.StartService+"/UpdateBookmark",null,zp?Ap:null,null,postData,

{

    "Content-Type":"application/x-www-form-urlencoded"

}

);

r.execute();

};

Start.BookmarkService.BindingInfoFromClientData=function(Cp,Dp)

{

var data=Start.Util.GetArrayFromString(Cp);

var info=new Object();

info.type=null;

info.binding=null;

info.params=null;

if(data.type=="external")

{

    info.type=Start.Const.BindingType.External;

    info.binding=data.definitionUrl;

}

else

{

    info.type=Start.Const.BindingType.Internal;

    switch(data.binding)

    {

        default:info.binding=Start.RssReader;

        info.params=

        {

            "feedUrl":Dp,"numItems":data.numItems?data.numItems:5

        };

        break;

    }

}

return info;

};

registerNamespace("Start.Struct");

registerNamespace("Start.Struct.Bookmark");

registerNamespace("Start.Struct.Rss");

registerNamespace("Start.Struct.ModuleParams");

Start.Struct.StartResponse=function(Ep,Fp,Gp,Hp)

{

this.error=Ep;

this.code=Fp;

this.message=Gp;

this.data=Hp;

};

Start.Struct.Bookmark.Folder=function(Ip,Jp)

{

this.name=Ip;

this.id=Jp;

};

Start.Struct.Bookmark.Item=function(Kp,Lp,Mp,Np)

{

this.name=Kp;

this.id=Lp;

this.url=Mp;

this.data=Np;

};

Start.Struct.Bookmark.Collection=function(Op,Pp)

{

this.folders=Op;

this.bookmarks=Pp;

};

Start.Struct.Rss.Item=function(Qp,Rp,Sp,Tp,Up,Vp,Wp,Xp,Yp)

{

this.title=Qp;

this.description=Rp;

this.link=Sp;

this.pubDate=Tp;

this.guid=Up;

this.source=Vp;

this.imgLink=Wp;

this.other=Yp;

this.enclosure=Xp;

};

Start.Struct.Rss.Channel=function(Zp,aq,bq,cq,eq,gq,hq,jq)

{

this.title=Zp;

this.titleResourceID=aq;

this.link=bq;

this.description=cq;

this.attribs=eq;

this.items=gq;

this.image=hq;

this.binding=jq;

};

Start.Struct.Rss.Collection=function(kq)

{

this.channels=kq;

};

Start.Struct.ModuleParams.Rss=function(lq,mq)

{

this.feedUrl=lq;

this.numItems=mq;

};

registerNamespace("Start.Toolbar");

Start.Toolbar=function(nq,oq,pq)

{

Start.Toolbar.initializeBase(this,arguments);

var m_el=nq;

var m_this=this;

var m_dashboardControl=null;

var m_showDashboard=false;

var m_logoTag=null;

var m_styleNav=null;

var m_currentStyle="theme01";

var m_styles=new Array();

this.GetLogoTag=function()

{

    return m_logoTag;

};

this.initialize=function(qq)

{

    Start.Toolbar.getBaseMethod(this,"initialize","Web.Bindings.Base").call(this,qq);

    m_el.className="toolbar";

    var themeId=null;

    var temp=theApp.GetPreference(Start.Const.PrefPrefix+"themename");

    if(temp)

    {

        switch(temp)

        {

            case "ocean":themeId="theme01";

            break;

            case "granite":themeId="theme02";

            break;

            case "ice":themeId="theme03";

            break;

        }

        theApp.SetPreference(Start.Const.PrefPrefix+"themename","");

        theApp.SetPreference(Start.Const.PrefPrefix+"themeid",themeId);

    }

    var temp=theApp.GetPreference(Start.Const.PrefPrefix+"themeid");

    if(temp)

    {

        m_currentStyle=temp;

        links=document.getElementsByTagName("link");

        var numLinks=links.length;

        for(var i=0;

        i<numLinks;

        i++)

        {

            var link=links[i];

            if(link.getAttribute("rel").indexOf("stylesheet")!=-1&&link.getAttribute("title"))

            {

                link.disabled=true;

                if(link.getAttribute("title")==m_currentStyle)link.disabled=false;

            }

        }

    }

    var themeName=uq(m_currentStyle);

    m_styleNav=document.createElement("span");

    m_styleNav.innerText=themeName;

    m_styleNav.className="stylesheetNav";

    m_styleNav.title=themeName;

    m_el.appendChild(m_styleNav);

    m_el.appendChild(document.createTextNode(" "));

    m_styleArrow=document.createElement("span");

    m_styleArrow.className="styleControl";

    m_styleArrow.innerHTML="&raquo;    ";

    m_styleArrow.title=L_ChangeThemeText_Text;

    m_styleArrow.attachEvent("onmousedown",tq);

    m_el.appendChild(m_styleArrow);

    m_el.appendChild(document.createTextNode(" / "));

    m_el.appendChild(document.createTextNode(L_ColumnsText_Text));

    m_colCtrlMinus=document.createElement("span");

    m_colCtrlMinus.className="columnControl";

    m_colCtrlMinus.innerText="-";

    m_colCtrlMinus.title=L_RemoveColumn_Text;

    m_colCtrlMinus.attachEvent("onmousedown",zq);

    m_el.appendChild(m_colCtrlMinus);

    m_el.appendChild(document.createTextNode(" "));

    m_colCtrlPlus=document.createElement("span");

    m_colCtrlPlus.className="columnControl";

    m_colCtrlPlus.innerText="+";

    m_colCtrlPlus.title=L_AddColumn_Text;

    m_colCtrlPlus.attachEvent("onmousedown",yq);

    m_el.appendChild(m_colCtrlPlus);

    m_el.appendChild(document.createTextNode(" / "));

    m_dashboardControl=document.createElement("span");

    m_dashboardControl.className="showhideDashboard";

    m_dashboardControl.title=L_HideShowDash_Text;

    m_dashboardControl.attachEvent("onmousedown",xq);

    m_el.appendChild(m_dashboardControl);

    m_showDashboard=theApp.GetPreference(Start.Const.PrefPrefix+"hidedashboard")=="true"?false:true;

    wq();

    m_el.appendChild(document.createTextNode(" / "));

    m_languageBtn=document.createElement("span");

    m_languageBtn.className="languageBtn";

    m_languageBtn.title=L_SelectLanguage_Text;

    m_languageBtn.innerText=L_Language_Text;

    m_languageBtn.attachEvent("onmousedown",Aq);

    m_el.appendChild(m_languageBtn);

    m_el.appendChild(document.createTextNode(" / "));

    m_logoTag=document.createElement("a");

    m_logoTag.innerText=L_SignInText_Text;

    m_el.appendChild(m_logoTag);

    Start.StartService.GetPassportStatus();

};

this.dispose=function(rq)

{

    Start.Toolbar.getBaseMethod(this,"dispose","Web.Bindings.Base").call(this,rq);

    m_styleArrow.detachEvent("onmousedown",tq);

    m_colCtrlMinus.detachEvent("onmousedown",zq);

    m_colCtrlPlus.detachEvent("onmousedown",yq);

    m_dashboardControl.detachEvent("onmousedown",xq);

    m_styleArrow=m_colCtrlMinus=m_colCtrlPlus=m_dashboard=m_el=m_logoTag=null;

};

function sq()

{

    links=document.getElementsByTagName("link");

    var numLinks=links.length;

    for(var i=0;

    i<numLinks;

    i++)

    {

        m_styles.push(links[i].getAttribute("title"));

    }

}

function tq()

{

    var i=0;

    var link=null;

    var links=document.getElementsByTagName("link");

    var numLinks=links.length;

    var curIdx=-1;

    for(i=0;

    i<numLinks;

    i++)

    {

        link=links[i];

        if(link.getAttribute("rel").indexOf("stylesheet")!=-1&&link.getAttribute("title"))

        {

            link.disabled=true;

            if(link.getAttribute("title")==m_currentStyle)curIdx=i;

        }

    }

    var nextIdx=0;

    for(i=curIdx+1;

    i<numLinks;

    i++)

    {

        link=links[i];

        if(link.getAttribute("rel").indexOf("stylesheet")!=-1&&link.getAttribute("title"))

        {

            nextIdx=i;

            break;

        }

    }

    link=links[nextIdx];

    link.disabled=false;

    m_currentStyle=link.getAttribute("title");

    m_styleNav.innerText=uq(m_currentStyle);

    theApp.SetPreference(Start.Const.PrefPrefix+"themeid",m_currentStyle);

}

function uq(vq)

{

    switch(vq)

    {

        case "theme01":return L_Theme01Name_Text;

        case "theme02":return L_Theme02Name_Text;

        case "theme03":return L_Theme03Name_Text;

        default:return L_Theme01Name_Text;

    }

}

function wq()

{

    theApp.GetSheet().UpdateDashboardState(m_showDashboard);

    m_dashboardControl.innerText=m_showDashboard?L_HideText_Text:L_ShowText_Text;

}

function xq()

{

    m_showDashboard=!m_showDashboard;

    wq();

    theApp.SetPreference(Start.Const.PrefPrefix+"hidedashboard",!m_showDashboard);

}

function yq()

{

    var page=theApp.GetSheet().GetCurrentPage();

    if(page&&page.GetNumColumns()<4)page.SetColumns(page.GetNumColumns()+1);

}

function zq()

{

    var page=theApp.GetSheet().GetCurrentPage();

    if(page&&page.GetNumColumns()>1)page.SetColumns(page.GetNumColumns()-1);

}

function Aq()

{

    theApp.DisplayPopupModule("Language Preference",null,Start.Const.BindingType.External,"custom/language.xml",null);

}

};

Start.Toolbar.registerClass("Start.Toolbar","Web.Bindings.Base");

registerNamespace("Start.Util");

Start.Util.ProxyURL=function(Bq)

{

};

Start.Util.Point=function(x,y)

{

return{    "x":x,"y":y};

};

Start.Util.GetElementOffset=function(Cq)

{

var x=0;

var y=0;

while(Cq!=null)

{

    x+=Cq.offsetLeft;

    y+=Cq.offsetTop;

    Cq=Cq.offsetParent;

}

return new Start.Util.Point(x,y);

};

Array.prototype.reorderItem=function(Dq,Eq)

{

if(Dq>=0&&Dq<this.length&&Eq>=0&&Eq<this.length)

{

    var tmp=this.removeAt(Dq)[0];

    var arrEnd=this.splice(Eq,this.length-Eq);

    this[this.length]=tmp;

    this.addArray(arrEnd);

}

};

Array.prototype.isEqual=function(Fq)

{

if(this.length!=Fq.length)return false;

for(var i=0;

i<this.length;

i++)

{

    if(Fq[i]!=this[i])return false;

}

return true;

};

Array.prototype.insert=function(Gq,Hq)

{

if(Hq>=this.length)

{

    this.push(Gq);

    return;

}

if(Hq<0)Hq=0;

var arrEnd=this.splice(Hq,this.length-Hq);

this[this.length]=Gq;

this.addArray(arrEnd);

};

Start.Util.GetArrayFromString=function(Iq)

{

var result=new Object();

if(Iq!=null)

{

    var arrayItems=Iq.split(";");

    for(var i=0;

    i<arrayItems.length;

    i++)

    {

        var item=arrayItems[i].split("=");

        if(!item[1])item[1]="";

        result[unescape(item[0]).trim()]=unescape(item[1]).trim();

    }

}

return result;

};

Start.Util.GetStringFromArray=function(Jq)

{

var str="";

for(var i in Jq)

{

    if(str!="")str+=";";

    str+=escape(i)+"="+escape(Jq[i]);

}

return str;

};

Start.Util.ObjectToString=function(Kq)

{

var val="";

var output="";

if(Kq)

{

    output+="{";

    for(var i in Kq)

    {

        val=Kq[i];

        if(val==null)output+=i+":null"+",";

        else switch(typeof val)

        {

            case "object":if(val[0])output+=i+":"+Start.Util.ArrayToString(val)+",";

            else output+=i+":"+Start.Util.ObjectToString(val)+",";

            break;

            case "string":output+=i+":'"+val.replace(/\'/g,"\\'")+"',";

            break;

            default:output+=i+":"+val+",";

        }

    }

    output=output.substring(0,output.length-1)+"}";

}

return output;

};

Start.Util.ArrayToString=function(Lq)

{

var val="";

var output="";

if(Lq)

{

    output+="[";

    for(var i=0;

    i<Lq.length;

    i++)

    {

        val=Lq[i];

        switch(typeof val)

        {

            case "object":if(val&&val[0])output+=Start.Util.ArrayToString(val)+",";

            else output+="[],";

            break;

            case "string":output+="'"+val.replace(/\'/g,"\\'")+"',";

            break;

            default:output+=val+",";

        }

    }

    output=output.substring(0,output.length-1)+"]";

}

return output;

};

Start.Util.StringToArray=function(Mq)

{

var result=null;

try

{

    eval("result = "+Mq);

}

catch(e)

{

}

return result;

};

Start.Util.StringToObject=function(Nq)

{

var result=null;

try

{

    eval("result = "+Nq);

}

catch(e)

{

}

return result;

};

Start.Util.ReadAllQS=function()

{

var s=location.search.substring(1);

var search=new Object();

var searchArray=location.search.substring(1).split("&");

for(var i=0;

i<searchArray.length;

i++)

{

    var searchItem=searchArray[i].split("=");

    if(!searchItem[1])searchItem[1]="";

    search[searchItem[0].trim()]=unescape(searchItem[1].trim());

}

return search;

};

Start.Util.ReadQS=function(v)

{

return Start.Util.ReadAllQS()[v];

};

Start.Util.ModuleToString=function(Oq)

{

if(Web.Type.compare("Start.RssModule",Oq))return "Start.RssModule";

if(Web.Type.compare("Start.RssReader",Oq))return "Start.RssReader";

if(Web.Type.compare("Start.SearchModule",Oq))return "Start.SearchModule";

if(Web.Type.compare("Start.AddContentModule",Oq))return "Start.AddContentModule";

};

Start.Util.StringToModule=function(Pq)

{

switch(Pq)

{

    case "Start.RssModule":return Start.RssModule;

    case "Start.RssReader":return Start.RssReader;

    case "Start.SearchModule":return Start.SearchModule;

    case "Start.AddContentModule":return Start.AddContentModule;

}

return null;

};

Start.Util.HelperHoursAgo=function(Qq)

{

var str="";

var days=0;

var diff=new Date()-new Date(Qq);

var hours=Math.round(diff/3600000);

if(hours>=24)

{

    days=Math.round(hours/24);

    hours%=24;

}

if(days>0)str+=days+" "+(days==1?L_DaySingular_Text:L_DayPlural_Text)+(hours>0?", ":"");

if(hours>0)str+=hours+" "+(hours==1?L_HourSingular_Text:L_HourPlural_Text);

if(days>0||hours>0)str+=" "+L_AgoText_Text;

return str;

};

Start.Util.FormatNumber=function(Rq)

{

var str=new String(Rq);

if(Rq>=1000||Rq<=-1000)

{

    var beg=str.length;

    beg-=3;

    while(beg>=1)

    {

        str=str.substring(0,beg)+","+str.substring(beg,str.length);

        beg-=3;

    }

}

return str;

};

Start.Util.TruncateToSpace=function(Sq,Tq)

{

var ret=Sq;

if(Sq.length>Tq)

{

    var space=Sq.substring(Tq,Sq.length).indexOf(" ");

    if(space!=-1)ret=Sq.substring(0,Tq+space)+" ...";

    else ret=Sq.substring(0,Tq);

}

return ret;

};

Start.Util.EncodeXml=function(Uq,Vq)

{

var result=Uq.replace(/</g,"&lt;");

result=result.replace(/>/g,"&gt;");

result=result.replace(/\"/g,"&quot;");

result=result.replace(/\'/g,"&apos;");

if(Vq)result=result.replace(/&/g,"%26");

return result;

};

function s1(a)

{

    var y=document.getElementById("sy");

    if(y&&window.RegExp)

    {

        var re=/[\?&]srch_type=([^&]*)/i;

        m=re.exec(a.href);

        if(m&&m[1]!==null)

        {

            y.disabled=false;

            y.value=m[1];

        }

        else

        {

            y.disabled=true;

            y.value="";

        }

    }

    var l=document.getElementById("sl");

    if(l)l.innerHTML=a.title;

    var f=document.getElementById("sf");

    if(f)

    {

        var ht=document.getElementById(f.className);

        if(ht)ht.className="non";

        a.className="sel";

        f.action=a.href;

        f.className=a.id;

    }

    doFocus();

    return true;

}

function sc(a)

{

    var f=document.getElementById("sf");

    if(f&&f.className!=a.id)s(a);

    return false;

}

function doFocus()

{

    var e=document.activeElement;

    tgt=document.getElementById("sh");

    if(e&&tgt)

    {

        tgt.setAttribute("autocomplete","");

        tgt.setAttribute("VCARD_NAME","SearchText");

        if(!document.body.scrollTop)tgt.focus();

    }

}

function sf()

{

    var qf=document.getElementById("sf");

    if(qf.q.value!="")

    {

        var title=qf.q.value;

        var clientData="{type:1,binding:'Start.SearchModule',params:{query:'"+qf.q.value.replace(/\'/g,"\\'")+"',defaultTab:0    }    ,isExpanded:true}";

		Start.BookmarkService.AddBookmark(title,"",Start.Const.RecentSearchesFolderIdStr,clientData);

		var params=

		{

		    "query":qf.q.value

		};

		theApp.DisplayPopupModule(L_AddSearchPopup_Text+title,null,Start.Const.BindingType.Internal,Start.SearchModule,params);

		qf.q.select();

		var bookmark=new Start.Struct.Bookmark.Item(title,null,null,clientData);

		if(theApp.GetSidebar().GetRecentSearchesGroup()&&theApp.GetSidebar().GetRecentSearchesGroup().IsExpanded())theApp.GetSidebar().GetRecentSearchesGroup().AddItem(bookmark,true,true);

	}

	return false;

}

